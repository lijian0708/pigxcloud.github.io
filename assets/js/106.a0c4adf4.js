(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{575:function(t,e,a){"use strict";a.r(e);var i=a(29),s=Object(i.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"使用kubernetes部署minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用kubernetes部署minio"}},[t._v("#")]),t._v(" 使用Kubernetes部署Minio")]),t._v(" "),a("p",[t._v("Kubernetes的部署和状态集提供了在独立，分布式或共享模式下部署Minio服务器的完美平台。 在Kubernetes上部署Minio有多种选择，您可以选择最适合您的。")]),t._v(" "),a("ul",[a("li",[t._v("Minio "),a("a",{attrs:{href:"https://helm.sh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Helm"),a("OutboundLink")],1),t._v(" Chart通过一个简单的命令即可提供自定义而且简单的Minio部署。更多关于Minio Helm部署的资料，请访问"),a("a",{attrs:{href:"https://www.bookstack.cn/read/MinioCookbookZH/69.md#prerequisites",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("li",[t._v("你也可以浏览Kubernetes "),a("a",{attrs:{href:"https://github.com/minio/minio/blob/master/docs/orchestration/kubernetes-yaml/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Minio示例"),a("OutboundLink")],1),t._v(" ，通过.yaml文件来部署Minio。")]),t._v(" "),a("li",[t._v("如果您想在Kubernetes上开始使用Minio，而无需创建真正的容器集群，您也可以使用Minikube "),a("a",{attrs:{href:"https://raw.githubusercontent.com/minio/minio/master/docs/orchestration/minikube/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("deploy Minio locally"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_1-前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前提条件"}},[t._v("#")]),t._v(" 1. 前提条件")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("默认standaline模式下，需要开启Beta API的Kubernetes 1.4+。")])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.bookstack.cn/read/MinioCookbookZH/69.md#distributed-minio",target:"_blank",rel:"noopener noreferrer"}},[t._v("distributed 模式"),a("OutboundLink")],1),t._v("，需要开启Beta API的Kubernetes 1.5+。")])]),t._v(" "),a("li",[a("p",[t._v("底层支持PV provisioner。")])]),t._v(" "),a("li",[a("p",[t._v("你的K8s集群里需要有Helm package manager")])])]),t._v(" "),a("p",[t._v("installed")]),t._v(" "),a("p",[t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_2-使用helm-chart部署minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用helm-chart部署minio"}},[t._v("#")]),t._v(" 2. 使用Helm Chart部署Minio")]),t._v(" "),a("p",[t._v("安装 Minio chart")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install stable/minio\n")])])]),a("p",[t._v("以上命令以默认配置在Kubernetes群集上部署Minio。 以下部分列出了Minio图表的所有可配置参数及其默认值。")]),t._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("image")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Minio镜像名称")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("minio/minio")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("imageTag")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Minio镜像tag. 可选值在 "),a("a",{attrs:{href:"https://hub.docker.com/r/minio/minio/tags/",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("RELEASE.2017-08-05T00-00-53Z")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("imagePullPolicy")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Image pull policy")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Always")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("mode")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Minio server模式 ("),a("code",[t._v("standalone")]),t._v(", "),a("code",[t._v("shared")]),t._v("或者 "),a("code",[t._v("distributed")]),t._v(")")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("standalone")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("numberOfNodes")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("节点数 (仅对分布式模式生效). 可选值 4 <= x <= 16")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("4")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("accessKey")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("默认access key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("AKIAIOSFODNN7EXAMPLE")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("secretKey")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("默认secret key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("configPath")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("默认配置文件路径")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("~/.minio")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("mountPath")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("默认挂载路径")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("/export")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("serviceType")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Kubernetes service type")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LoadBalancer")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("servicePort")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Kubernetes端口")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("9000")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("persistence.enabled")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是否使用持久卷存储数据")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("true")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("persistence.size")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("持久卷大小")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("10Gi")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("persistence.storageClass")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("持久卷类型")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("generic")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("persistence.accessMode")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ReadWriteOnce 或者 ReadOnly")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("ReadWriteOnce")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("resources")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("CPU/Memory 资源需求/限制")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Memory: "),a("code",[t._v("256Mi")]),t._v(", CPU: "),a("code",[t._v("100m")])])])])]),t._v(" "),a("p",[t._v("你可以通过"),a("code",[t._v("—set key=value[,key=value]")]),t._v("给"),a("code",[t._v("helm install")]),t._v("。 比如,")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --name my-release \\  --set persistence.size=100Gi \\    stable/minio\n")])])]),a("p",[t._v("上述命令部署了一个带上100G持久卷的Minio服务。")]),t._v(" "),a("p",[t._v("或者，您可以提供一个YAML文件，用于在安装chart时指定参数值。 例如，")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --name my-release -f values.yaml stable/minio\n")])])]),a("h3",{attrs:{id:"分布式minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式minio"}},[t._v("#")]),t._v(" 分布式Minio")]),t._v(" "),a("p",[t._v("默认情况下，此图表以独立模式提供Minio服务器。 要在"),a("a",{attrs:{href:"https://docs.min.io/docs/distributed-minio-quickstart-guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("分布式模式"),a("OutboundLink")],1),t._v("中配置Minio服务器，请将"),a("code",[t._v("mode")]),t._v("字段设置为"),a("code",[t._v("distributed")]),t._v(",")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set mode=distributed stable/minio\n")])])]),a("p",[t._v("上述命令部署了个带有4个节点的分布式Minio服务器。 要更改分布式Minio服务器中的节点数，请设置"),a("code",[t._v("numberOfNodes")]),t._v("属性。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set mode=distributed,numberOfNodes=8 stable/minio\n")])])]),a("p",[t._v("上述命令部署了个带有8个节点的分布式Minio服务器。注意一下，"),a("code",[t._v("numberOfNodes")]),t._v("取值范围是[4,16]。")]),t._v(" "),a("h4",{attrs:{id:"statefulset-限制-适用于分布式minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#statefulset-限制-适用于分布式minio"}},[t._v("#")]),t._v(" StatefulSet 限制，适用于分布式Minio")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("StatefulSets需要持久化存储，所以如果 mode设成 distributed的话，persistence.enabled参数不生效。")])]),t._v(" "),a("li",[a("p",[t._v("卸载分布式Minio版本时，需要手动删除与StatefulSet关联的卷。")]),t._v(" "),a("h3",{attrs:{id:"shared-minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shared-minio"}},[t._v("#")]),t._v(" Shared Minio")])])]),t._v(" "),a("p",[t._v("如需采用"),a("a",{attrs:{href:"https://github.com/minio/minio/blob/master/docs/shared-backend/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("shared mode"),a("OutboundLink")],1),t._v("部署Minio, 将"),a("code",[t._v("mode")]),t._v(" 设为"),a("code",[t._v("shared")]),t._v(",")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set mode=shared stable/minio\n")])])]),a("p",[t._v("上述命令规定了4个Minio服务器节点，一个存储。 要更改共享的Minio部署中的节点数，请设置"),a("code",[t._v("numberOfNodes")]),t._v("字段，")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set mode=shared,numberOfNodes=8 stable/minio\n")])])]),a("p",[t._v("上述命令规定了Minio服务有8个节点，采用shared模式。")]),t._v(" "),a("h3",{attrs:{id:"持久化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持久化"}},[t._v("#")]),t._v(" 持久化")]),t._v(" "),a("p",[t._v("这里规定了PersistentVolumeClaim并将相应的持久卷挂载到默认位置"),a("code",[t._v("/export")]),t._v("。 您需要Kubernetes集群中的物理存储才能使其工作。 如果您宁愿使用"),a("code",[t._v("emptyDir")]),t._v("，请通过以下方式禁用PersistentVolumeClaim：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set persistence.enabled=false stable/minio\n")])])]),a("blockquote",[a("p",[a("em",[t._v('"当Pod分配给节点时，首先创建一个emptyDir卷，只要该节点上的Pod正在运行，它就会存在。 当某个Pod由于任何原因从节点中删除时，emptyDir中的数据将永久删除。"')])])]),t._v(" "),a("h2",{attrs:{id:"_3-使用helm更新minio版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用helm更新minio版本"}},[t._v("#")]),t._v(" 3. 使用Helm更新Minio版本")]),t._v(" "),a("p",[t._v("您可以更新现有的Minio Helm Release以使用较新的Minio Docker镜像。 为此，请使用"),a("code",[t._v("helm upgrade")]),t._v("命令：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm upgrade --set imageTag=<replace-with-minio-docker-image-tag> <helm-release-name> stable/minio\n")])])]),a("p",[t._v("如果更新成功，你可以看到下面的输出信息")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('Release "your-helm-release" has been upgraded. Happy Helming!\n')])])]),a("h2",{attrs:{id:"_4-卸载chart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-卸载chart"}},[t._v("#")]),t._v(" 4. 卸载Chart")]),t._v(" "),a("p",[t._v("假设你的版本被命名为"),a("code",[t._v("my-release")]),t._v("，使用下面的命令删除它：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm delete my-release\n")])])]),a("p",[t._v("该命令删除与chart关联的所有Kubernetes组件，并删除该release。")]),t._v(" "),a("h3",{attrs:{id:"提示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提示"}},[t._v("#")]),t._v(" 提示")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在Kubernetes群集中运行的chart的实例称为release。 安装chart后，Helm会自动分配唯一的release名称。 你也可以通过下面的命令设置你心仪的名称：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --name my-release stable/minio\n")])])])]),t._v(" "),a("li",[a("p",[t._v("为了覆盖默认的秘钥，可在运行helm install时将access key和secret key做为参数传进去。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ helm install --set accessKey=myaccesskey,secretKey=mysecretkey \\  stable/minio\n")])])])])])])}),[],!1,null,null,null);e.default=s.exports}}]);