(window.webpackJsonp=window.webpackJsonp||[]).push([[184],{653:function(s,a,t){"use strict";t.r(a);var e=t(29),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nfs-kubernetes-高可用方案-nfs-keepalived-sersync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nfs-kubernetes-高可用方案-nfs-keepalived-sersync"}},[s._v("#")]),s._v(" NFS (Kubernetes) 高可用方案（NFS+keepalived+Sersync)")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("NFS (Kubernetes) 高可用方案（NFS+keepalived+Sersync)")])]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#安装环境"}},[s._v("安装环境")])]),t("li",[t("a",{attrs:{href:"#准备工作"}},[s._v("准备工作")])]),t("li",[t("a",{attrs:{href:"#安装-nfs"}},[s._v("安装 NFS")])]),t("li",[t("a",{attrs:{href:"#测试-nfs"}},[s._v("测试 NFS")])]),t("li",[t("a",{attrs:{href:"#在-slave-进行同步-master-数据"}},[s._v("在 Slave 进行同步 Master 数据")])]),t("li",[t("a",{attrs:{href:"#在-master-进行同步-slave-数据"}},[s._v("在 Master 进行同步 Slave 数据")])]),t("li",[t("a",{attrs:{href:"#master安装-keepalived"}},[s._v("Master安装 Keepalived")])]),t("li",[t("a",{attrs:{href:"#slave安装-keepalived"}},[s._v("Slave安装 Keepalived")])]),t("li",[t("a",{attrs:{href:"#测试-nfs"}},[s._v("测试 NFS")])]),t("li",[t("a",{attrs:{href:"#k8s集群node节点挂在"}},[s._v("k8s集群node节点挂在")])]),t("li",[t("a",{attrs:{href:"#设置-keepalived-脚本"}},[s._v("设置 Keepalived 脚本")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"安装环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装环境"}},[s._v("#")]),s._v(" 安装环境")]),s._v(" "),t("p",[s._v("本方案是 NFS 的高可用方案，客户端为 k8s集群三台，文件服务器分别为 "),t("code",[s._v("Master")]),s._v(" 和 "),t("code",[s._v("Slave")]),s._v("，使用 "),t("code",[s._v("keepalived")]),s._v(" 生成一个虚拟 IP，使用 "),t("code",[s._v("Sersync")]),s._v(" 进行 Master 与 Slave 之间文件相互同步，确保高可用。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("角色")]),s._v(" "),t("th",[s._v("系统")]),s._v(" "),t("th",[s._v("IP")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("虚拟IP")]),s._v(" "),t("td"),s._v(" "),t("td",[s._v("192.168.100.110")])]),s._v(" "),t("tr",[t("td",[s._v("Client")]),s._v(" "),t("td",[s._v("k8s集群")]),s._v(" "),t("td",[s._v("192.168.100.116,192.168.100.117,192.168.100.118")])]),s._v(" "),t("tr",[t("td",[s._v("Master")]),s._v(" "),t("td",[s._v("centos 7.9")]),s._v(" "),t("td",[s._v("192.168.100.111")])]),s._v(" "),t("tr",[t("td",[s._v("Slave")]),s._v(" "),t("td",[s._v("centos 7.9")]),s._v(" "),t("td",[s._v("192.168.100.112")])])])]),s._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),t("p",[s._v("安装 "),t("code",[s._v("vim")]),s._v("，并且"),t("strong",[s._v("关闭防火墙")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" -y\nsystemctl stop firewalld "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable firewalld\n")])])]),t("p",[s._v("查看内核版本")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -smr")]),s._v("\nLinux "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1160.59.1.el7.x86_64 x86_64\n")])])]),t("blockquote",[t("p",[s._v("建议升级到最新的长期支持版本  "),t("a",{attrs:{href:"https://links.jianshu.com/go?to=https%3A%2F%2Fwww.hwholiday.com%2F2021%2Fcentos7%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("升级内核"),t("OutboundLink")],1)])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/redhat-release #查看系统版本")]),s._v("\nCentOS Linux release "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),s._v(".2009 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -r #查看系统内核版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.10")]),s._v(".0-1160.59.1.el7.x86_64\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -m #查看系统是否64位")]),s._v("\nx86_64\n")])])]),t("h2",{attrs:{id:"安装-nfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-nfs"}},[s._v("#")]),s._v(" 安装 NFS")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("master")]),s._v(" 和 "),t("code",[s._v("slave")]),s._v(" 上面创建共享目录，数据盘挂在到"),t("code",[s._v("/data")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 赋予写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" o+w /data/nfs-share\n")])])]),t("p",[s._v("在"),t("code",[s._v("master")]),s._v(" 和 "),t("code",[s._v("slave")]),s._v("上安装nfs服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils rpcbind\n")])])]),t("p",[s._v("设定分享的目录（配置要改动需要reload nfs 服务）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定具体k8s node节点IP地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/nfs-share 192.168.100.116,192.168.100.117,192.168.100.118(rw,sync,all_squash)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/exports\n")])])]),t("p",[s._v("分享目录的范围详解（给哪些客户端分享）")]),s._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("p",[s._v("(1).指定ip地址的主机：192.168.0.100")]),s._v(" "),t("p",[s._v("只允许IP地址为192.168.0.100的主机可以登录到此共享目录")]),s._v(" "),t("p",[s._v("(2).指定子网中的所有主机：192.168.0.0/24或者192.168.0.0/255.255.255.0")]),s._v(" "),t("p",[s._v("只允许192.168.0.1~192.168.0.254这个网段内的IP登录到此共享目录")]),s._v(" "),t("p",[s._v("(3).指定域名的主机：centosNameNode.pigxcloud.com")]),s._v(" "),t("p",[s._v("只允许主机名为centosNameNode.pigxcloud.com的可以登录到此共享目录")]),s._v(" "),t("p",[s._v("(4).指定域内的所有主机：*.pigxcloud.com")]),s._v(" "),t("p",[s._v("只允许域名为.pigxcloud.com的可以登录到此共享目录")]),s._v(" "),t("p",[s._v("(5).指定所有的主机：*")])]),s._v(" "),t("p",[s._v("分享目录的权限详解（客户端能对分享的目录进行哪些操作）")]),s._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("p",[s._v("(1).rw：可读可写的权限")]),s._v(" "),t("p",[s._v("(2).ro：只读的权限")]),s._v(" "),t("p",[s._v("(3).no_root_squash：登入分享目录的使用者如果是root的话，那么对于这个分享的目录来说，他就具有root的权限！这一项不安全，不建议使用！")]),s._v(" "),t("p",[s._v("(4).root_squash：登入分享目录的使用者如果是root的话，那么这个使用者的权限将被压缩成匿名使用者，通常他的UID与GID都会变成nobody那个系统账号的身份。")]),s._v(" "),t("p",[s._v("(5).all_squash：不论登入分享目录的使用者是什么身份，都会被压缩成匿名使用者。")]),s._v(" "),t("p",[s._v("(6).anonuid：可以自行设定使用者UID的值！也就是使用者登录到分享目录中，身份成为UID这个使用者，必须在/etc/passwd中存在这个UID。")]),s._v(" "),t("p",[s._v("(7).anongid：可以自行设定使用者GID的值！也就是使用者登录到分享目录中，身份成为GID这个使用者，必须在/etc/group中存在这个GID。")]),s._v(" "),t("p",[s._v("(8).sync：数据同步写入到内存与硬盘当中")]),s._v(" "),t("p",[s._v("(9).async：数据会先暂存于内存当中，而非直接写入硬盘")])]),s._v(" "),t("p",[s._v("开启服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start rpcbind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start nfs\n")])])]),t("p",[s._v("设置开机自启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rpcbind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs\n")])])]),t("h2",{attrs:{id:"测试-nfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-nfs"}},[s._v("#")]),s._v(" 测试 NFS")]),s._v(" "),t("p",[s._v("在k8s集群里面找个node 测试是否能链接上nfs服务")]),s._v(" "),t("p",[s._v("下载nfs")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils rpcbind\n")])])]),t("p",[s._v("挂载目录")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/nfs-data\n")])])]),t("p",[s._v("挂载nfs")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t nfs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.111:/data/nfs-share /data/nfs-data\n")])])]),t("p",[s._v("查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -TH")]),s._v("\nFilesystem                      Type      Size  Used Avail Use% Mounted on\ndevtmpfs                        devtmpfs  508M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  508M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                           tmpfs     520M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  520M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                           tmpfs     520M  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".1M  513M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("% /run\ntmpfs                           tmpfs     520M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  520M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/centos-root         xfs        54G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".7G   52G   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("% /\n/dev/mapper/centos-home         xfs       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1T   34M  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1T   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /home\n/dev/sda1                       xfs       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G  208M  856M  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("% /boot\ntmpfs                           tmpfs     104M     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  104M   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.111:/data/nfs-share nfs4       54G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8G   52G   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("% /data1/nfs-data\n")])])]),t("p",[s._v("卸载挂载")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /data1/nfs-data\n")])])]),t("p",[s._v("检查 nfs 服务器端是否有设置共享目录 showmount -e $(nfs服务器的IP)")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# showmount -e 192.168.100.111")]),s._v("\nExport list "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.111:\n/data/nfs-share "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.0/23\n")])])]),t("h2",{attrs:{id:"在-slave-进行同步-master-数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-slave-进行同步-master-数据"}},[s._v("#")]),s._v(" 在 Slave 进行同步 Master 数据")]),s._v(" "),t("p",[s._v("提到数据同步就必然会谈到rsync，一般简单的服务器数据传输会使用ftp/sftp等方式，但是这样的方式效率不高，不支持差异化增量同步也不支持实时传输。针对数据实时同步需求大多数人会选择rsync+inotify-tools的解决方案，但是这样的方案也存在一些缺陷，sersync是国人基于前两者开发的工具，不仅保留了优点同时还强化了实时监控，文件过滤，简化配置等功能，帮助用户提高运行效率，节省时间和网络资源。")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上编辑配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/rsyncd.conf\n")])])]),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync运行权限为root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("uid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync运行权限为root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("gid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("873")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid文件的存放位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("pid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("file = /var/rsyncd.pid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件位置，启动rsync后自动产生这个文件，无需提前创建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("file = /var/log/rsyncd.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为true，修改为no，增加对目录文件软连接的备份")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("use")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("chroot = no")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("max")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("connections = 200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync服务端文件为读写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("read")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("only = no")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不显示rsync服务端资源列表 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("list")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fake")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("super = yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("ignore")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("errors")]),s._v("\n[data]\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync服务端数据目录路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/data/nfs-share")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行数据同步的用户名，可以设置多个，用英文状态下逗号隔开")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("auth")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("users = root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户认证配置文件，里面保存用户名称和密码，后面会创建这个文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("secrets")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("file = /etc/rsync_slave.pass")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许进行数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("hosts")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("allow = 192.168.100.111")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#hosts deny = 192.168.0.1")]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上安装启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root:123456'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/rsync_slave.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/rsync_slave.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R root:root /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" --daemon --config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/rsyncd.conf\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Master")]),s._v(" 上测试下")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R root:root /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/rsync_slave.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/rsync_slave.pass\n// 创建测试文件,测试推送\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" slave.txt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -arv /data/nfs-share/ root@192.168.100.112::data --password-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/rsync_slave.pass\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在 slave 上测试")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /fs/nsf-data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 出现 slave.txt 即可")]),s._v("\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Master")]),s._v(" 上配置自动同步安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/orangle/sersync/master/release/sersync2.5.4_64bit_binary_stable_final.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf sersync2.5.4_64bit_binary_stable_final.tar.gz  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动目录到 /usr/local/sersync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" GNU-Linux-x86  /usr/local/sersync   \n")])])]),t("p",[s._v("在 "),t("code",[s._v("Master")]),s._v(" 上配置自动同步配置")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/sersync/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/sersync/confxml.xml\n")])])]),t("p",[s._v("修改配置文件里面节点数据")]),s._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("delete "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flase"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#源服务器同步目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("localpath "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("watch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/nfs-share/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#remote ip="172.12.17.167"  #目标服务器ip，每行一个 ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#name="data"   目标服务器rsync同步目录模块名称')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("remote "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.12.17.167"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rsync同步认证")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#start="true"   ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#users="root" 目标服务器rsync同步用户名')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#passwordfile="/etc/rsync_slave.pass" 目标服务器rsync同步用户的密码在源服务器的存放路径')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("auth "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("users")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwordfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsync_slave.pass"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync远程服务端口，远程非默认端口则需打开自定义")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("userDefinedPort "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"873"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("874")]),s._v(" --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#脚本运行失败日志记录")]),s._v("\nfailLog "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/rsync_fail_log.sh"')]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./sersync2 -r -d -o confxml.xml\n")])])]),t("p",[s._v("测试")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/nfs-share "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" slave.txt\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 里面 "),t("code",[s._v("/data/nfs-share")]),s._v(" 里面去看看数据是否存在")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost nfs-share"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -al ")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12512")]),s._v("\ndrwxr-xrwx. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("146")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":28 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndrwxr-xr-x. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":43 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n-rw-r--r--. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" Mar  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":56 slave.txt\n")])])]),t("h2",{attrs:{id:"在-master-进行同步-slave-数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-master-进行同步-slave-数据"}},[s._v("#")]),s._v(" 在 Master 进行同步 Slave 数据")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("如果"),t("code",[s._v("Master")]),s._v("挂掉后恢复不能同步数据到"),t("code",[s._v("Slave")]),s._v("，这里也同样配置"),t("code",[s._v("Master")]),s._v("到"),t("code",[s._v("Slave")]),s._v("的自动同步")])]),s._v(" "),t("p",[s._v("在Master上编辑配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/rsyncd.conf\n")])])]),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync运行权限为root")]),s._v("\nuid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync运行权限为root")]),s._v("\ngid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认端口")]),s._v("\nport "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("873")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid文件的存放位置")]),s._v("\npid "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/rsyncd.pid\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件位置，启动rsync后自动产生这个文件，无需提前创建")]),s._v("\nlog "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/rsyncd.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认为true，修改为no，增加对目录文件软连接的备份")]),s._v("\nuse "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数")]),s._v("\nmax connections "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync服务端文件为读写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" only "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不显示rsync服务端资源列表 ")]),s._v("\nlist "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nfake super "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nignore errors\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync服务端数据目录路径")]),s._v("\npath "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行数据同步的用户名，可以设置多个，用英文状态下逗号隔开")]),s._v("\nauth "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户认证配置文件，里面保存用户名称和密码，后面会创建这个文件")]),s._v("\nsecrets "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许进行数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开")]),s._v("\nhosts allow "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.112\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止数据同步的客户端IP地址，可以设置多个，用英文状态下逗号隔开")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#hosts deny = 192.168.0.1")]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("Master")]),s._v("上安装启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root:123456'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R root:root /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" --daemon --config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/rsyncd.conf\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上测试下")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R root:root /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建测试文件,测试推送")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" master.txt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -arv /data/nfs-share/ root@192.168.100.111::data --password-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/rsync_master.pass\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 Master 上测试")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 出现 master.txt 即可")]),s._v("\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上配置自动同步安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/orangle/sersync/master/release/sersync2.5.4_64bit_binary_stable_final.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf sersync2.5.4_64bit_binary_stable_final.tar.gz  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动目录到 /usr/local/sersync")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" GNU-Linux-x86  /usr/local/sersync   \n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上配置自动同步配置")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/sersync/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/sersync/confxml.xml\n")])])]),t("p",[s._v("修改配置文件里面节点数据")]),s._v(" "),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("delete "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flase"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#源服务器同步目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("localpath "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("watch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/nfs-share/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#remote ip="192.168.100.111"  #目标服务器ip，每行一个 ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#name="data"   目标服务器rsync同步目录模块名称')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("remote "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.111"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rsync同步认证")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#start="true"   ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#users="root" 目标服务器rsync同步用户名')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#passwordfile="/etc/rsync_master.pass" 目标服务器rsync同步用户的密码在源服务器的存放路径')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("auth "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("users")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("passwordfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsync_master.pass"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置rsync远程服务端口，远程非默认端口则需打开自定义")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("userDefinedPort "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"873"')]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("874")]),s._v(" --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#脚本运行失败日志记录")]),s._v("\nfailLog "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/tmp/rsync_fail_log.sh"')]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./sersync2 -r -d -o confxml.xml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/nfs-share\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" Master1.txt\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 Slave 里面 /data/nfs-share 里面去看看数据是否存在")]),s._v("\n")])])]),t("h2",{attrs:{id:"master安装-keepalived"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master安装-keepalived"}},[s._v("#")]),s._v(" Master安装 Keepalived")]),s._v(" "),t("p",[s._v("安装 keepalived")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" keepalived\n")])])]),t("p",[s._v("修改配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n")])])]),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中 enp0s3 为绑定网卡名称，可以使用 ip addr 命令查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中 192.168.100.123  为虚拟 ip ，注意不要和其它 ip 冲突")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\nglobal_defs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   router_id lb01\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface enp0s3\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟路由标识，这个标识是一个数字，同一个vrrp实例使用唯一的标识。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 即同一vrrp_instance下，MASTER和BACKUP必须是一致的")]),s._v("\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义优先级，数字越大，优先级越高（0-255）。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在同一个vrrp_instance下，MASTER 的优先级必须大于 BACKUP 的优先级")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定 MASTER 与 BACKUP 负载均衡器之间同步检查的时间间隔，单位是秒")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.123/23 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".101.255\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start keepalived.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" keepalived.service\n")])])]),t("h2",{attrs:{id:"slave安装-keepalived"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#slave安装-keepalived"}},[s._v("#")]),s._v(" Slave安装 Keepalived")]),s._v(" "),t("p",[s._v("安装 keepalived")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" keepalived\n")])])]),t("p",[s._v("修改配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/keepalived/keepalived.conf\n")])])]),t("details",{staticClass:"custom-block details"},[t("summary",[s._v("点击查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中 enp0s3 为绑定网卡名称，可以使用 ip addr 命令查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中 192.168.100.123  为虚拟 ip ，注意不要和其它 ip 冲突")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\nglobal_defs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   router_id lb02\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER\n    interface enp0s3\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟路由标识，这个标识是一个数字，同一个vrrp实例使用唯一的标识。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 即同一vrrp_instance下，MASTER和BACKUP必须是一致的")]),s._v("\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义优先级，数字越大，优先级越高（0-255）。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在同一个vrrp_instance下，MASTER 的优先级必须大于 BACKUP 的优先级")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设定 MASTER 与 BACKUP 负载均衡器之间同步检查的时间间隔，单位是秒")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.123/23 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".101.255\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])]),s._v(" "),t("p",[s._v("启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start keepalived.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" keepalived.service\n")])])]),t("h2",{attrs:{id:"测试-nfs-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-nfs-2"}},[s._v("#")]),s._v(" 测试 NFS")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("Master")]),s._v("上执行，有输出")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip a | grep  192.168.100.123")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.123/23 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".101.255 scope global secondary enp0s3\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v("上执行，无输出")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip a | grep  192.168.100.123")]),s._v("\n")])])]),t("p",[s._v("关闭 "),t("code",[s._v("Master")]),s._v(" 上keepalived测试IP是否更换")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("Master")]),s._v("上")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop keepalived\n")])])]),t("p",[s._v("在 "),t("code",[s._v("Slave")]),s._v(" 上,有输出表示"),t("strong",[s._v("自动切换成功")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip a | grep  192.168.100.123")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.123/23 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".101.255 scope global secondary enp0s3\n")])])]),t("h2",{attrs:{id:"k8s集群node节点挂在"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群node节点挂在"}},[s._v("#")]),s._v(" k8s集群node节点挂在")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/nfs-share-123\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载nfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -t nfs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.123:/data/nfs-share /data/nfs-share-123\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -TH\n输出里面含有  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.111:/data/nfs-share nfs4       54G  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8G   52G   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("% /data1/nfs-data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载挂载")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("umount")]),s._v(" /data/nfs-share-123\n")])])]),t("h2",{attrs:{id:"设置-keepalived-脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置-keepalived-脚本"}},[s._v("#")]),s._v(" 设置 Keepalived 脚本")]),s._v(" "),t("p",[s._v("在安装Keepalived的机器上设置 Keepalived 脚本")]),s._v(" "),t("blockquote",[t("p",[s._v("ip 的漂移是根据 Keepalived 的存活来判断的，所以在 nfs 挂之后需要停止 keepalived 服务")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'systemctl status nfs &>/dev/null\nif [ $? -ne 0 ]; then\n  systemctl start nfs\n  systemctl status nfs &>/dev/null\n  if [ $? -ne 0 ]; then\n    systemctl stop keepalived.service\n  fi\nfi'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /usr/local/sbin/task_nfs.sh\n")])])]),t("p",[s._v("加入定时任务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /usr/local/sbin/task_nfs.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加定时任务 5秒执行一次")]),s._v("\n* * * * * "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/usr/local/sbin/task_nfs.sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n")])])]),t("p",[s._v("完结。")])])}),[],!1,null,null,null);a.default=n.exports}}]);