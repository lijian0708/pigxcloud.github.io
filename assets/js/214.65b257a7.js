(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{683:function(t,s,a){"use strict";a.r(s);var e=a(29),_=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins常用构建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins常用构建触发器"}},[t._v("#")]),t._v(" Jenkins常用构建触发器")]),t._v(" "),a("h2",{attrs:{id:"jenkins内置建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins内置建触发器"}},[t._v("#")]),t._v(" Jenkins内置建触发器")]),t._v(" "),a("p",[t._v("Jenkins内置4种构建触发器:")]),t._v(" "),a("ul",[a("li",[t._v("触发远程构建")]),t._v(" "),a("li",[t._v("其他工程构建后触发(Build after other projects are build)")]),t._v(" "),a("li",[t._v("定时构建(Build periodically)")]),t._v(" "),a("li",[t._v("轮询SCM(Poll SCM)")])]),t._v(" "),a("h3",{attrs:{id:"触发远程构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发远程构建"}},[t._v("#")]),t._v(" 触发远程构建")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("身份验证令牌一般是"),a("strong",[t._v("加密字符串")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_131632.jpg",alt:"触发远程构建"}})]),t._v(" "),a("p",[t._v("触发构建url: http://192.168.50.102:8080/job/web-demo-pipeline02/build?token=123456")]),t._v(" "),a("h3",{attrs:{id:"其他工程构建后触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他工程构建后触发"}},[t._v("#")]),t._v(" 其他工程构建后触发")]),t._v(" "),a("p",[t._v("1)创建"),a("code",[t._v("pre_project")]),t._v("流水线工程")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("一般在多模块项目存在依赖关系时使用")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_132801.jpg",alt:"创建依赖项目"}})]),t._v(" "),a("p",[t._v("2)配置需要触发的工程")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("配置多个依赖项目时使用"),a("code",[t._v(",")]),t._v("分割")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_133004.jpg",alt:"创建依赖项目"}})]),t._v(" "),a("h3",{attrs:{id:"定时构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时构建"}},[t._v("#")]),t._v(" 定时构建")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_141835.jpg",alt:"定时构建"}})]),t._v(" "),a("p",[t._v("定时字符串从左往右分别为: 分 时 日 月 周")]),t._v(" "),a("p",[t._v("一些定时表达式的例子:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("每30分钟构建一次:H代表形参 H/30 * * * * 10:02 10:32\n每2个小时构建一次: H H/2 * * *\n每天的8点，12点，22点，一天构建3次: (多个时间点中间用逗号隔开) 0 8,12,22 * * * \n每天中午12点定时构建一次 H 12 * * *\n每天下午18点定时构建一次 H 18 * * * \n在每个小时的前半个小时内的每10分钟 H(0-29)/10 * * * *\n每两小时一次，每个工作日上午9点到下午5点(也许是上午10:38，下午12:38，下午2:38，下午 4:38) H H(9-16)/2 * * 1-5\n")])])]),a("h3",{attrs:{id:"轮询scm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轮询scm"}},[t._v("#")]),t._v(" 轮询SCM")]),t._v(" "),a("p",[t._v("轮询SCM，是指定时扫描本地代码仓库的代码是否有变更，如果代码有变更就触发项目构建。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_142201.jpg",alt:"轮询SCM"}})]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("轮询SCM，是指定时扫描本地代码仓库的代码是否有变更，如果代码有变更就触发项目构建。")])]),t._v(" "),a("h2",{attrs:{id:"git-hook自动触发构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git-hook自动触发构建"}},[t._v("#")]),t._v(" Git hook自动触发构建"),a("Badge",{attrs:{text:"推荐",type:"success"}})],1),t._v(" "),a("p",[t._v("刚才我们看到在Jenkins的内置构建触发器中，轮询SCM可以实现Gitlab代码更新，项目自动构建，但是该方案的性能不佳。那有没有更好的方案呢? 有的。就是利用Gitlab的webhook实现代码push到仓库，立即触发项目自动构建。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_143345.jpg",alt:"Git hook自动触发构建"}})]),t._v(" "),a("h3",{attrs:{id:"安装gitlab-hook插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab-hook插件"}},[t._v("#")]),t._v(" 安装Gitlab Hook插件")]),t._v(" "),a("p",[t._v("需要安装两个插件: "),a("code",[t._v("GitLab")]),t._v(" 和 "),a("code",[t._v("Gitlab Hook")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_160640.jpg",alt:"安装Gitlab Hook插件"}})]),t._v(" "),a("h3",{attrs:{id:"jenkins设置自动构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins设置自动构建"}},[t._v("#")]),t._v(" Jenkins设置自动构建")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_180147.jpg",alt:"安装Gitlab Hook插件"}})]),t._v(" "),a("p",[t._v("GitLab webhook URL:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("http://192.168.50.102:8080/project/web-demo-pipeline02\n")])])]),a("p",[t._v('Secret token: 点击"Generate"')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("726808fb71ce6d9c7ac2610ce718d5a2\n")])])]),a("p",[t._v("等会需要把生成的"),a("code",[t._v("GitLab webhook URL")]),t._v(" 和 "),a("code",[t._v("Secret token")]),t._v("配置到Gitlab中。")]),t._v(" "),a("h3",{attrs:{id:"gitlab配置webhook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab配置webhook"}},[t._v("#")]),t._v(" Gitlab配置webhook")]),t._v(" "),a("p",[t._v("1)开启webhook功能")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("开启webhook功能需要使用Gitlab的root用户操作")])]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("root")]),t._v("账户登录到后台，点击"),a("code",[t._v("Admin Area")]),t._v(" -> "),a("code",[t._v("Settings")]),t._v(" -> "),a("code",[t._v("Network")]),t._v(' 勾选"Allow requests to the local network from web hooks and services"')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_181532.jpg",alt:"开启webhook"}})]),t._v(" "),a("p",[t._v("2)在项目添加webhook")]),t._v(" "),a("p",[t._v("点击项目->Settings->Integrations")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("项目添加webhook，如果项目使用普通用户创建（例如：jack）需要使用普通用户进行操作")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_212448.jpg",alt:"Integrations"}})]),t._v(" "),a("p",[t._v("3)创建访问令牌")]),t._v(" "),a("p",[a("code",[t._v("Edit profile")]),t._v(" -> "),a("code",[t._v("Access Tokens")]),t._v(' 点击"Create personal access token"')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_213154.jpg",alt:"Integrations"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("注意保存"),a("code",[t._v("access token")]),t._v(",只显示一次，刷新后不再显示。（可以重新创建）")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_213808.jpg",alt:"Integrations"}})]),t._v(" "),a("p",[t._v("Your new personal access token")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("QszazrfXTedjnk-Zw56e\n")])])]),a("h3",{attrs:{id:"jenkins添加凭证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins添加凭证"}},[t._v("#")]),t._v(" Jenkins添加凭证")]),t._v(" "),a("p",[t._v("返回Jenkins，添加类型"),a("code",[t._v("Gitlab API token")]),t._v(" , "),a("code",[t._v("API token")]),t._v("填写上一步Gitlab创建的"),a("code",[t._v("personal access token")]),t._v("：QszazrfXTedjnk-Zw56e")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_214627.jpg",alt:"添加凭据"}})]),t._v(" "),a("p",[t._v("系统管理 -> 系统配置 -> Gitlab")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_171723.jpg",alt:"添加凭据"}})]),t._v(" "),a("h3",{attrs:{id:"测试webhooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试webhooks"}},[t._v("#")]),t._v(" 测试Webhooks")]),t._v(" "),a("p",[t._v("返回Gitlab，打开"),a("code",[t._v("web-demo")]),t._v("项目 -> Settings -> Webhooks -> Test -> Push events")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_220103.jpg",alt:"测试Webhooks"}})]),t._v(" "),a("p",[t._v("提示如下内容表示调用成功，返回Jenkins，项目已经开始构建。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Hook executed successfully: HTTP 200\n")])])])])}),[],!1,null,null,null);s.default=_.exports}}]);