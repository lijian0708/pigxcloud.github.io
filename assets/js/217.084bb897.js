(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{686:function(s,a,t){"use strict";t.r(a);var e=t(29),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"sonarqube自动代码审查工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sonarqube自动代码审查工具"}},[s._v("#")]),s._v(" SonarQube自动代码审查工具"),t("Badge",{attrs:{text:"8.9.1 LTS",type:"success"}})],1),s._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[s._v("Sonar（SonarQube）是一个开源平台，用于管理源代码的质量。Sonar 不只是一个质量数据报告工具，更是代码质量管理平台。支持的语言包括：Java、PHP、C#、C、Cobol、PL/SQL、Flex 等。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/dev-cycle.png",alt:"dev-cycle"}})]),s._v(" "),t("h2",{attrs:{id:"硬件要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#硬件要求"}},[s._v("#")]),s._v(" 硬件要求")]),s._v(" "),t("p",[s._v("下表列出了部署SonarQube的最低和建议的硬件配置。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("资源")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("最小配置")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("推荐配置")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CPU")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("2 CPU")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("8 CPU")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("Mem")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("4 GB")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("16 GB")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("Disk")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("40 GB")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("160 GB")])])])]),s._v(" "),t("h2",{attrs:{id:"软件版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#软件版本"}},[s._v("#")]),s._v(" 软件版本")]),s._v(" "),t("p",[s._v("下表列出了部署SonarQube的依赖软件版本要求。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("软件")]),s._v(" "),t("th",[s._v("版本")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Java")]),s._v(" "),t("td",[s._v("Oracle JRE 11 或 OpenJDK 11")])]),s._v(" "),t("tr",[t("td",[s._v("Database")]),s._v(" "),t("td",[s._v("PostgreSQL 12")])]),s._v(" "),t("tr",[t("td",[s._v("OS")]),s._v(" "),t("td",[s._v("Ubuntu 20.04 Server LTS")])]),s._v(" "),t("tr",[t("td",[s._v("SonarQube")]),s._v(" "),t("td",[s._v("Community 8.9.1 LTS")])])])]),s._v(" "),t("h2",{attrs:{id:"安装postgresql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装postgresql"}},[s._v("#")]),s._v(" 安装PostgreSQL")]),s._v(" "),t("p",[s._v("PostgreSQL 或者 Postgres 是一个开源的，多用途的关系型数据库管理系统。它有很多高级特性，可以允许你构建容错的环境或者复杂的应用。")]),s._v(" "),t("p",[s._v("在写这篇文章的时候，PostgreSQL 在 Ubuntu 官方软件源中的最新可用版本为 "),t("code",[s._v("12.7")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"安装postgresql-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装postgresql-2"}},[s._v("#")]),s._v(" 安装PostgreSQL:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" postgresql postgresql-contrib\n")])])]),t("p",[s._v("我们同时安装 PostgreSQL contrib 软件包，它可以提供 PostgreSQL 数据库系统的一些额外特性。")]),s._v(" "),t("p",[s._v("一旦安装完成， PostgreSQL 服务将会自动启动。使用"),t("code",[s._v("psql")]),s._v("工具通过连接 PostgreSQL 数据库并且打印它的版本来验证安装：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" -u postgres psql -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SELECT version();"')]),s._v("\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PostgreSQL 12.7 (Ubuntu 12.7-0ubuntu0.20.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0, 64-bit\n")])])]),t("p",[s._v("就这样。PostgreSQL 已经安装好了，你可以开始使用它了。")]),s._v(" "),t("h3",{attrs:{id:"postgresql角色和身份认证方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#postgresql角色和身份认证方式"}},[s._v("#")]),s._v(" PostgreSQL角色和身份认证方式")]),s._v(" "),t("p",[s._v("PostgreSQL 数据库访问权限是通过角色来处理的。一个角色代表一个数据库用户或者一个数据库用户组。")]),s._v(" "),t("p",[s._v("PostgreSQL 支持多种身份认证方式。最常用的方法如下：")]),s._v(" "),t("ul",[t("li",[s._v("Trust - 只要满足"),t("code",[s._v("pg_hba.conf")]),s._v("定义的条件，一个角色就可以不使用密码就能连接服务器")]),s._v(" "),t("li",[s._v("Password - 通过密码，一个角色可以连接服务器。密码可以被存储为 scram-sha-256, md5, 和 password(明文)。")]),s._v(" "),t("li",[s._v("Ident - 仅仅支持 TCP/IP 连接。它通常通过一个可选的用户名映射表，获取客户端操作系统用户名。")]),s._v(" "),t("li",[s._v("Peer - 和 Ident 一样，仅仅支持本地连接。")])]),s._v(" "),t("p",[s._v("PostgreSQL 客户端身份验证通常被定义在"),t("code",[s._v("pg_hba.conf")]),s._v("文件中。默认情况下，对于本地连接，PostgreSQL 被设置成身份认证防范 peer。")]),s._v(" "),t("p",[s._v("为了以"),t("code",[s._v("postgres")]),s._v("用户身份登录 PostgreSQL 服务器，首先切换用户，然后使用"),t("code",[s._v("psql")]),s._v("工具访问 PostgreSQL。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - postgres\npsql\n")])])]),t("p",[s._v("从这里开始，你可以与 PostgreSQL 实例交互。退出 PostgreSQL Shell，输入：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("q\n")])])]),t("p",[s._v("你也可以不切换用户，而使用"),t("code",[s._v("sudo")]),s._v("命令访问 PostgreSQL：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" -u postgres psql\n")])])]),t("p",[s._v("通常，"),t("code",[s._v("postgres")]),s._v("用户仅仅在本地被使用。")]),s._v(" "),t("h3",{attrs:{id:"创建-postgresql-角色和数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-postgresql-角色和数据库"}},[s._v("#")]),s._v(" 创建 PostgreSQL 角色和数据库")]),s._v(" "),t("p",[s._v("仅仅超级用户和拥有"),t("code",[s._v("CREATEROLE")]),s._v("权限的角色可以创建新角色。")]),s._v(" "),t("p",[s._v("在下面的例子中，我们创建一个名称为"),t("code",[s._v("sonarqube")]),s._v("的角色，一个名称为"),t("code",[s._v("sonarqube")]),s._v("的数据库，并且授予数据库上的权限：")]),s._v(" "),t("p",[s._v("1)创建一个新的 PostgreSQL 角色：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - postgres -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"createuser sonarqube"')]),s._v("\n")])])]),t("p",[s._v("2)创建一个新的 PostgreSQL 数据库：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - postgres -c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"createdb sonarqube"')]),s._v("\n")])])]),t("p",[s._v("想要授权用户操作数据库，连接到 PostgreSQL shell:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" -u postgres psql\n")])])]),t("p",[s._v("并且运行下面的 query:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grant all privileges on database sonarqube to sonarqube;")]),s._v("\nGRANT\n")])])]),t("h3",{attrs:{id:"启用远程访问postgresql服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用远程访问postgresql服务器"}},[s._v("#")]),s._v(" 启用远程访问PostgreSQL服务器")]),s._v(" "),t("p",[s._v("默认情况下，PostgreSQL 服务器仅仅监听本地网络接口："),t("code",[s._v("127.0.0.1")]),s._v("。")]),s._v(" "),t("p",[s._v("为了允许远程访问你的 PostgreSQL 服务器，打开配置文件"),t("code",[s._v("postgresql.conf")]),s._v("并且在"),t("code",[s._v("CONNECTIONS AND AUTHENTICATION")]),s._v("一节添加"),t("code",[s._v("listen_addresses = '*'")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/postgresql/12/main/postgresql.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#------------------------------------------------------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONNECTIONS AND AUTHENTICATION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#------------------------------------------------------------------------------")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - Connection Settings -")]),s._v("\n\nlisten_addresses "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# what IP address(es) to listen on;")]),s._v("\n")])])]),t("p",[s._v("保存文件并且重启 PostgreSQL 服务：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart postgresql\n")])])]),t("p",[s._v("使用"),t("code",[s._v("ss")]),s._v("工具验证修改：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ss -nlt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("\n")])])]),t("p",[s._v("输出显示 PostgreSQL 服务器正在监听所有的网络接口("),t("code",[s._v("0.0.0.0")]),s._v("):")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("LISTEN  0        244              0.0.0.0:5432           0.0.0.0:*              \nLISTEN  0        244                 [::]:5432              [::]:*\n")])])]),t("p",[s._v("下一步就是配置服务器接受远程连接，编辑"),t("code",[s._v("/etc/postgresql/12/main/pg_hba.conf")]),s._v("文件。")]),s._v(" "),t("p",[s._v("下面是一些例子，显示不同的用户场景：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# TYPE  DATABASE        USER            ADDRESS                 METHOD\n\n# The user jane can access all databases from all locations using md5 password\nhost    all             sonarqube       0.0.0.0/0                md5\n\n# The user jane can access only the janedb from all locations using md5 password\nhost    sonarqube       sonarqube       0.0.0.0/0                md5\n\n# The user jane can access all databases from a trusted location (192.168.1.134) without a password\nhost    all             sonarqube       192.168.50.100             trust\n")])])]),t("p",[s._v("重启PostgreSQL服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart postgresql\n")])])]),t("p",[s._v("最后一步（可选）就是在你的防火墙上打开端口"),t("code",[s._v("5432")]),s._v("端口。")]),s._v(" "),t("p",[s._v("假设你正在使用"),t("code",[s._v("UFW")]),s._v("来管理你的防火墙，并且你想允许从"),t("code",[s._v("10.17.10.0/24")]),s._v("子网过来的访问，你应该运行下面的命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ufw allow proto tcp from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.17")]),s._v(".10.0/24 to any port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("\n")])])]),t("p",[s._v("确保你的防火墙被配置好，并仅仅接受来自受信任 IP 范围的连接。")]),s._v(" "),t("h3",{attrs:{id:"将sonarqube用户密码设置为sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将sonarqube用户密码设置为sonarqube"}},[s._v("#")]),s._v(" 将sonarqube用户密码设置为sonarqube")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - postgres\npsql\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# \\password sonarqube")]),s._v("\nEnter new password: \nEnter it again: \n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("postgres")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELECT rolname,rolpassword FROM pg_authid;")]),s._v("\n          rolname          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("             rolpassword             \n---------------------------+-------------------------------------\n postgres                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_monitor                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_read_all_settings      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_read_all_stats         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_stat_scan_tables       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_read_server_files      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_write_server_files     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_execute_server_program "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n pg_signal_backend         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n sonarqube                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" md5699b64e757e1f31984196747c316e4e3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" rows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"安装jdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk"}},[s._v("#")]),s._v(" 安装JDK")]),s._v(" "),t("p",[s._v("下载 jdk-11.0.11_linux-x64_bin.tar.gz")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/lib/jvm\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf jdk-11.0.11_linux-x64_bin.tar.gz -C /usr/lib/jvm\n")])])]),t("p",[s._v("配置环境变量，编辑"),t("code",[s._v("sudo vi /etc/profile")]),s._v("文件，文档最后追加如下内容：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib/jvm/jdk-11.0.11\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ES_JAVA_HOME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/lib\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ES_JAVA_HOME}")]),s._v("/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])])]),t("p",[s._v("更新")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])])]),t("p",[s._v("验证")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ubuntu@sonarqueb:~$ java -version\njava version "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11.0.11"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-04-20 LTS\nJava"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SE Runtime Environment "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".11+9-LTS-194"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJava HotSpot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".11+9-LTS-194, mixed mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"安装sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装sonarqube"}},[s._v("#")]),s._v(" 安装SonarQube")]),s._v(" "),t("p",[s._v("准备工作")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" sysctl -w vm.max_map_count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" sysctl -w fs.file-max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -u "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n")])])]),t("p",[s._v("官网下载并解压 下载地址: "),t("a",{attrs:{href:"http://www.sonarqube.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.sonarqube.org/downloads/"),t("OutboundLink")],1),s._v(" 下载"),t("code",[s._v("SonarQube 8.9.1")]),s._v("版本")]),s._v(" "),t("p",[s._v("切换到普通用户")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/ubuntu\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.9.1.44547.zip\n")])])]),t("p",[s._v("安装zip")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n")])])]),t("p",[s._v("解压安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" sonarqube-8.9.1.44547.zip \n")])])]),t("p",[s._v("配置 SonarQube")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /home/ubuntu/sonarqube-8.9.1.44547/conf/sonar.properties\n")])])]),t("p",[s._v("修改如下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 数据库账户\nsonar.jdbc.username=sonarqube\nsonar.jdbc.password=sonarqube\n# 数据库连接\nsonar.jdbc.url=jdbc:postgresql://localhost/sonarqube?currentSchema=public\nsonar.web.host=0.0.0.0\nsonar.web.port=9000\n")])])]),t("p",[s._v("启动测试")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /home/ubuntu/sonarqube-8.9.1.44547/bin/linux-x86-64\n./sonar.sh console\n")])])]),t("p",[s._v("浏览器访问：http://Server_IP:9000，默认管理员账号：admin，密码：admin。首次登录后修改密码。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2021-07-04_203600.png",alt:"SonarQube"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);