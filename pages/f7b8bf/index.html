<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud Gateway ä¸­æ–‡å®˜ç½‘æ–‡æ¡£ | Javaå…¨æ ˆ</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ğŸš€æœ‰é“æ— æœ¯ï¼Œæœ¯å°šå¯æ±‚ï¼Œæœ‰æœ¯æ— é“ï¼Œæ­¢äºæœ¯">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.9b63dc7f.css" as="style"><link rel="preload" href="/assets/js/app.31569fb0.js" as="script"><link rel="preload" href="/assets/js/2.df69d635.js" as="script"><link rel="preload" href="/assets/js/120.b2f1f2eb.js" as="script"><link rel="prefetch" href="/assets/js/10.788e911f.js"><link rel="prefetch" href="/assets/js/100.5869e407.js"><link rel="prefetch" href="/assets/js/101.4735f8c8.js"><link rel="prefetch" href="/assets/js/102.0afc9257.js"><link rel="prefetch" href="/assets/js/103.deaaedc9.js"><link rel="prefetch" href="/assets/js/104.e5de9bfa.js"><link rel="prefetch" href="/assets/js/105.04f52d11.js"><link rel="prefetch" href="/assets/js/106.a0c4adf4.js"><link rel="prefetch" href="/assets/js/107.72cf41ff.js"><link rel="prefetch" href="/assets/js/108.2185b4f1.js"><link rel="prefetch" href="/assets/js/109.a1966f5b.js"><link rel="prefetch" href="/assets/js/11.76e4b896.js"><link rel="prefetch" href="/assets/js/110.f0666616.js"><link rel="prefetch" href="/assets/js/111.2d52e7dc.js"><link rel="prefetch" href="/assets/js/112.7705a466.js"><link rel="prefetch" href="/assets/js/113.2f1ab226.js"><link rel="prefetch" href="/assets/js/114.4aa4d6ae.js"><link rel="prefetch" href="/assets/js/115.4a9765c7.js"><link rel="prefetch" href="/assets/js/116.31d2b63f.js"><link rel="prefetch" href="/assets/js/117.d2af2299.js"><link rel="prefetch" href="/assets/js/118.70b7c00b.js"><link rel="prefetch" href="/assets/js/119.50227395.js"><link rel="prefetch" href="/assets/js/12.88aeacb8.js"><link rel="prefetch" href="/assets/js/121.e9e3e5bf.js"><link rel="prefetch" href="/assets/js/122.8821ca4c.js"><link rel="prefetch" href="/assets/js/123.5c481679.js"><link rel="prefetch" href="/assets/js/124.90aefb34.js"><link rel="prefetch" href="/assets/js/125.3c2d8a2e.js"><link rel="prefetch" href="/assets/js/126.ca38566c.js"><link rel="prefetch" href="/assets/js/127.74131025.js"><link rel="prefetch" href="/assets/js/128.da48cef5.js"><link rel="prefetch" href="/assets/js/129.3122af0d.js"><link rel="prefetch" href="/assets/js/13.ef864632.js"><link rel="prefetch" href="/assets/js/130.1e22d289.js"><link rel="prefetch" href="/assets/js/131.706af342.js"><link rel="prefetch" href="/assets/js/132.50c671ee.js"><link rel="prefetch" href="/assets/js/133.db98fa8a.js"><link rel="prefetch" href="/assets/js/134.7fe8cf44.js"><link rel="prefetch" href="/assets/js/135.6219a109.js"><link rel="prefetch" href="/assets/js/136.27f3f774.js"><link rel="prefetch" href="/assets/js/137.b4e57291.js"><link rel="prefetch" href="/assets/js/138.82aaf97d.js"><link rel="prefetch" href="/assets/js/139.cab10f5a.js"><link rel="prefetch" href="/assets/js/14.ddfa3e6b.js"><link rel="prefetch" href="/assets/js/140.4b42a53f.js"><link rel="prefetch" href="/assets/js/141.ba14455a.js"><link rel="prefetch" href="/assets/js/142.4acedada.js"><link rel="prefetch" href="/assets/js/143.e89a5e92.js"><link rel="prefetch" href="/assets/js/144.27ae0dda.js"><link rel="prefetch" href="/assets/js/145.6bbfb61f.js"><link rel="prefetch" href="/assets/js/146.55df497b.js"><link rel="prefetch" href="/assets/js/147.40936f4a.js"><link rel="prefetch" href="/assets/js/148.4be699c3.js"><link rel="prefetch" href="/assets/js/149.fc77592a.js"><link rel="prefetch" href="/assets/js/15.68f8ce44.js"><link rel="prefetch" href="/assets/js/150.e7fb1666.js"><link rel="prefetch" href="/assets/js/151.40ff52a0.js"><link rel="prefetch" href="/assets/js/152.fda432cf.js"><link rel="prefetch" href="/assets/js/153.1b165d6b.js"><link rel="prefetch" href="/assets/js/154.3bb5bcb3.js"><link rel="prefetch" href="/assets/js/155.6cd504f2.js"><link rel="prefetch" href="/assets/js/156.b1ff07fd.js"><link rel="prefetch" href="/assets/js/157.57a6101a.js"><link rel="prefetch" href="/assets/js/158.0a18c4db.js"><link rel="prefetch" href="/assets/js/159.89815b25.js"><link rel="prefetch" href="/assets/js/16.aff0328f.js"><link rel="prefetch" href="/assets/js/160.9a45fd99.js"><link rel="prefetch" href="/assets/js/161.82e463d5.js"><link rel="prefetch" href="/assets/js/162.5a06785b.js"><link rel="prefetch" href="/assets/js/163.08555c19.js"><link rel="prefetch" href="/assets/js/164.9f890f94.js"><link rel="prefetch" href="/assets/js/165.2e875427.js"><link rel="prefetch" href="/assets/js/166.3f418177.js"><link rel="prefetch" href="/assets/js/167.06c2cc48.js"><link rel="prefetch" href="/assets/js/168.3e5efe52.js"><link rel="prefetch" href="/assets/js/169.637e7376.js"><link rel="prefetch" href="/assets/js/17.125748af.js"><link rel="prefetch" href="/assets/js/170.319e96c6.js"><link rel="prefetch" href="/assets/js/171.a09af050.js"><link rel="prefetch" href="/assets/js/172.23d78708.js"><link rel="prefetch" href="/assets/js/173.c057313f.js"><link rel="prefetch" href="/assets/js/174.8d168208.js"><link rel="prefetch" href="/assets/js/175.d81d3c21.js"><link rel="prefetch" href="/assets/js/176.8ba38854.js"><link rel="prefetch" href="/assets/js/177.620927ce.js"><link rel="prefetch" href="/assets/js/178.3c001e58.js"><link rel="prefetch" href="/assets/js/179.0acd475a.js"><link rel="prefetch" href="/assets/js/18.fa6cd919.js"><link rel="prefetch" href="/assets/js/180.e910d853.js"><link rel="prefetch" href="/assets/js/181.7798460e.js"><link rel="prefetch" href="/assets/js/182.3c1fc210.js"><link rel="prefetch" href="/assets/js/183.8cc80600.js"><link rel="prefetch" href="/assets/js/184.fff56765.js"><link rel="prefetch" href="/assets/js/185.c63f91e5.js"><link rel="prefetch" href="/assets/js/186.7870decd.js"><link rel="prefetch" href="/assets/js/187.3cb205f3.js"><link rel="prefetch" href="/assets/js/188.3215c6b1.js"><link rel="prefetch" href="/assets/js/189.5e324d91.js"><link rel="prefetch" href="/assets/js/19.4bac67a7.js"><link rel="prefetch" href="/assets/js/190.71194c3e.js"><link rel="prefetch" href="/assets/js/191.3d513d7f.js"><link rel="prefetch" href="/assets/js/192.66f1b9c4.js"><link rel="prefetch" href="/assets/js/193.cfe9beef.js"><link rel="prefetch" href="/assets/js/194.d54494f6.js"><link rel="prefetch" href="/assets/js/195.91f8acc9.js"><link rel="prefetch" href="/assets/js/196.a727b0fb.js"><link rel="prefetch" href="/assets/js/197.dcd6487d.js"><link rel="prefetch" href="/assets/js/198.4734520f.js"><link rel="prefetch" href="/assets/js/199.4946dc06.js"><link rel="prefetch" href="/assets/js/20.c78801f0.js"><link rel="prefetch" href="/assets/js/200.72242046.js"><link rel="prefetch" href="/assets/js/201.87f62686.js"><link rel="prefetch" href="/assets/js/202.38ace3e6.js"><link rel="prefetch" href="/assets/js/203.2827a086.js"><link rel="prefetch" href="/assets/js/204.4c8342e0.js"><link rel="prefetch" href="/assets/js/205.e1de7f41.js"><link rel="prefetch" href="/assets/js/206.94f84999.js"><link rel="prefetch" href="/assets/js/207.95ca2dd7.js"><link rel="prefetch" href="/assets/js/208.f293b55a.js"><link rel="prefetch" href="/assets/js/209.056b496b.js"><link rel="prefetch" href="/assets/js/21.64cc6926.js"><link rel="prefetch" href="/assets/js/210.7f232344.js"><link rel="prefetch" href="/assets/js/211.748e6034.js"><link rel="prefetch" href="/assets/js/212.06e705a7.js"><link rel="prefetch" href="/assets/js/213.a9f317f4.js"><link rel="prefetch" href="/assets/js/214.65b257a7.js"><link rel="prefetch" href="/assets/js/215.1260a609.js"><link rel="prefetch" href="/assets/js/216.c1b39ca2.js"><link rel="prefetch" href="/assets/js/217.084bb897.js"><link rel="prefetch" href="/assets/js/218.02aa4cd9.js"><link rel="prefetch" href="/assets/js/219.35339213.js"><link rel="prefetch" href="/assets/js/22.cacbe2f9.js"><link rel="prefetch" href="/assets/js/220.1c043025.js"><link rel="prefetch" href="/assets/js/221.af0028af.js"><link rel="prefetch" href="/assets/js/222.43ea3237.js"><link rel="prefetch" href="/assets/js/223.8c59c2c8.js"><link rel="prefetch" href="/assets/js/224.ceff003f.js"><link rel="prefetch" href="/assets/js/225.d7aa9f36.js"><link rel="prefetch" href="/assets/js/226.7d7574e8.js"><link rel="prefetch" href="/assets/js/227.3786dac4.js"><link rel="prefetch" href="/assets/js/228.67433714.js"><link rel="prefetch" href="/assets/js/229.874cf521.js"><link rel="prefetch" href="/assets/js/23.70f001e8.js"><link rel="prefetch" href="/assets/js/230.63255993.js"><link rel="prefetch" href="/assets/js/231.2771635e.js"><link rel="prefetch" href="/assets/js/232.1a846631.js"><link rel="prefetch" href="/assets/js/233.7950c15f.js"><link rel="prefetch" href="/assets/js/234.9c9d2947.js"><link rel="prefetch" href="/assets/js/235.3423e660.js"><link rel="prefetch" href="/assets/js/236.2d15acb2.js"><link rel="prefetch" href="/assets/js/237.5e3e145a.js"><link rel="prefetch" href="/assets/js/238.ffb20d88.js"><link rel="prefetch" href="/assets/js/239.2d0bd5a9.js"><link rel="prefetch" href="/assets/js/24.e4a1dc80.js"><link rel="prefetch" href="/assets/js/240.987df996.js"><link rel="prefetch" href="/assets/js/241.9e67aa11.js"><link rel="prefetch" href="/assets/js/242.20c57ba1.js"><link rel="prefetch" href="/assets/js/243.b3b4e01f.js"><link rel="prefetch" href="/assets/js/25.607f30bb.js"><link rel="prefetch" href="/assets/js/26.60c54e7d.js"><link rel="prefetch" href="/assets/js/27.48c44b2e.js"><link rel="prefetch" href="/assets/js/28.eb44c0ba.js"><link rel="prefetch" href="/assets/js/29.3f35baff.js"><link rel="prefetch" href="/assets/js/3.c76bdb66.js"><link rel="prefetch" href="/assets/js/30.5ceb6f39.js"><link rel="prefetch" href="/assets/js/31.df68a33c.js"><link rel="prefetch" href="/assets/js/32.0870e048.js"><link rel="prefetch" href="/assets/js/33.3b446daa.js"><link rel="prefetch" href="/assets/js/34.fd564325.js"><link rel="prefetch" href="/assets/js/35.0e1dceb3.js"><link rel="prefetch" href="/assets/js/36.6ea040e9.js"><link rel="prefetch" href="/assets/js/37.d0f64292.js"><link rel="prefetch" href="/assets/js/38.da592564.js"><link rel="prefetch" href="/assets/js/39.f2413731.js"><link rel="prefetch" href="/assets/js/4.ce850d9b.js"><link rel="prefetch" href="/assets/js/40.7c003d2a.js"><link rel="prefetch" href="/assets/js/41.61dee31e.js"><link rel="prefetch" href="/assets/js/42.dc1cfeb4.js"><link rel="prefetch" href="/assets/js/43.3fe14024.js"><link rel="prefetch" href="/assets/js/44.b66c9969.js"><link rel="prefetch" href="/assets/js/45.281f7712.js"><link rel="prefetch" href="/assets/js/46.fb40bb01.js"><link rel="prefetch" href="/assets/js/47.311785d3.js"><link rel="prefetch" href="/assets/js/48.0070f89f.js"><link rel="prefetch" href="/assets/js/49.0a752342.js"><link rel="prefetch" href="/assets/js/5.1faa936b.js"><link rel="prefetch" href="/assets/js/50.d46282a9.js"><link rel="prefetch" href="/assets/js/51.5a52f209.js"><link rel="prefetch" href="/assets/js/52.1ec82ee7.js"><link rel="prefetch" href="/assets/js/53.01e08d71.js"><link rel="prefetch" href="/assets/js/54.0ef033a3.js"><link rel="prefetch" href="/assets/js/55.602b8614.js"><link rel="prefetch" href="/assets/js/56.3a886341.js"><link rel="prefetch" href="/assets/js/57.feae1a28.js"><link rel="prefetch" href="/assets/js/58.6d2f12be.js"><link rel="prefetch" href="/assets/js/59.9325c1da.js"><link rel="prefetch" href="/assets/js/6.5a088ba5.js"><link rel="prefetch" href="/assets/js/60.a265bf7c.js"><link rel="prefetch" href="/assets/js/61.30146ded.js"><link rel="prefetch" href="/assets/js/62.662b760a.js"><link rel="prefetch" href="/assets/js/63.5d59c7f0.js"><link rel="prefetch" href="/assets/js/64.faabd330.js"><link rel="prefetch" href="/assets/js/65.9ced9383.js"><link rel="prefetch" href="/assets/js/66.2ff8ca8d.js"><link rel="prefetch" href="/assets/js/67.9000451e.js"><link rel="prefetch" href="/assets/js/68.c63a2ef0.js"><link rel="prefetch" href="/assets/js/69.8c8e119e.js"><link rel="prefetch" href="/assets/js/7.8f4bed74.js"><link rel="prefetch" href="/assets/js/70.de3ec280.js"><link rel="prefetch" href="/assets/js/71.0009b157.js"><link rel="prefetch" href="/assets/js/72.31a06f9d.js"><link rel="prefetch" href="/assets/js/73.e84721d3.js"><link rel="prefetch" href="/assets/js/74.8da44d3d.js"><link rel="prefetch" href="/assets/js/75.0c64e4b0.js"><link rel="prefetch" href="/assets/js/76.3db2aba9.js"><link rel="prefetch" href="/assets/js/77.b00b1560.js"><link rel="prefetch" href="/assets/js/78.53a1c343.js"><link rel="prefetch" href="/assets/js/79.1218161f.js"><link rel="prefetch" href="/assets/js/8.b1937d38.js"><link rel="prefetch" href="/assets/js/80.b85cb7a2.js"><link rel="prefetch" href="/assets/js/81.d4f058f7.js"><link rel="prefetch" href="/assets/js/82.bd0f843c.js"><link rel="prefetch" href="/assets/js/83.b6f1d5c6.js"><link rel="prefetch" href="/assets/js/84.e3469377.js"><link rel="prefetch" href="/assets/js/85.1f3e7bd0.js"><link rel="prefetch" href="/assets/js/86.179e9bc8.js"><link rel="prefetch" href="/assets/js/87.9c3f44b4.js"><link rel="prefetch" href="/assets/js/88.79659ee4.js"><link rel="prefetch" href="/assets/js/89.bea5895d.js"><link rel="prefetch" href="/assets/js/9.ebe72a00.js"><link rel="prefetch" href="/assets/js/90.a7bf2270.js"><link rel="prefetch" href="/assets/js/91.82f3a339.js"><link rel="prefetch" href="/assets/js/92.89864afc.js"><link rel="prefetch" href="/assets/js/93.6a775a5a.js"><link rel="prefetch" href="/assets/js/94.dede140a.js"><link rel="prefetch" href="/assets/js/95.e182e5da.js"><link rel="prefetch" href="/assets/js/96.bca74f0c.js"><link rel="prefetch" href="/assets/js/97.0b7a1a08.js"><link rel="prefetch" href="/assets/js/98.33ae82c8.js"><link rel="prefetch" href="/assets/js/99.4f690b51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b63dc7f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Javaå…¨æ ˆ" class="logo"> <span class="site-name can-hide">Javaå…¨æ ˆ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŒ‡å—" class="dropdown-title"><!----> <span class="title" style="display:;">æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åŸºç¡€</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/250f21/" class="nav-link">åŸºç¡€è®¾æ–½å³æœåŠ¡</a></li><li class="dropdown-subitem"><a href="/pages/f04654/" class="nav-link">å¹³å°å³æœåŠ¡</a></li><li class="dropdown-subitem"><a href="/pages/58bcba/" class="nav-link">å¾®æœåŠ¡è§£å†³å¤æ‚é—®é¢˜</a></li><li class="dropdown-subitem"><a href="/pages/b05793/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/1946f3/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li><li class="dropdown-item"><h4>é«˜çº§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/aeaf26/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/059418/" class="nav-link">Kubernetes</a></li></ul></li><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fbef9a/" class="nav-link">Spring Security OAuth2</a></li><li class="dropdown-subitem"><a href="/pages/72ccd6/" class="nav-link">ä¼ä¸šçº§ DevOps CI/CDå®è·µ</a></li><li class="dropdown-subitem"><a href="/pages/d49c54/" class="nav-link">Simplify Docs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨çº¿æ–‡æ¡£" class="dropdown-title"><!----> <span class="title" style="display:;">åœ¨çº¿æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å‰ç«¯æ–‡æ¡£</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Element - ç½‘ç«™å¿«é€Ÿæˆå‹å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://lodash.com/docs/#defaultsDeep" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lodash Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://zh.nuxtjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js - Vue.js é€šç”¨åº”ç”¨æ¡†æ¶
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuex.vuejs.org/zh/api/#vuex-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.vuepress.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress ä¸­æ–‡æ–‡æ¡£
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>åç«¯æ–‡æ¡£</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ifeve.com/google-guava/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google Guavaå®˜æ–¹æ•™ç¨‹
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨çº¿å·¥å…·" class="dropdown-title"><!----> <span class="title" style="display:;">åœ¨çº¿å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åœ¨çº¿ç¼–è¾‘</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://excalidraw.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿ç™½æ¿
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON ç¼–è¾‘å™¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD è¡¨æ ¼ç”Ÿæˆ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON è¡¨è¾¾å¼
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä»£ç æ ¼å¼åŒ–
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  äºŒç»´ç ç”Ÿæˆå™¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿ç¼–ç è½¬æ¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>åœ¨çº¿æœåŠ¡</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.processon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æµç¨‹å›¾æ€ç»´å¯¼å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://excalidraw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç”»å›¾å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>å¼€æºé•œåƒ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSXé•œåƒç«™
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZUREé•œåƒç«™
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Hub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">ğŸ’–æ”¯æŒ</a></div><div class="nav-item"><a href="https://www.pigcs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è¿”å›æ—§ç‰ˆ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŒ‡å—" class="dropdown-title"><!----> <span class="title" style="display:;">æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åŸºç¡€</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/250f21/" class="nav-link">åŸºç¡€è®¾æ–½å³æœåŠ¡</a></li><li class="dropdown-subitem"><a href="/pages/f04654/" class="nav-link">å¹³å°å³æœåŠ¡</a></li><li class="dropdown-subitem"><a href="/pages/58bcba/" class="nav-link">å¾®æœåŠ¡è§£å†³å¤æ‚é—®é¢˜</a></li><li class="dropdown-subitem"><a href="/pages/b05793/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/1946f3/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li><li class="dropdown-item"><h4>é«˜çº§</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/aeaf26/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/059418/" class="nav-link">Kubernetes</a></li></ul></li><li class="dropdown-item"><h4>ä¸“é¢˜</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fbef9a/" class="nav-link">Spring Security OAuth2</a></li><li class="dropdown-subitem"><a href="/pages/72ccd6/" class="nav-link">ä¼ä¸šçº§ DevOps CI/CDå®è·µ</a></li><li class="dropdown-subitem"><a href="/pages/d49c54/" class="nav-link">Simplify Docs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨çº¿æ–‡æ¡£" class="dropdown-title"><!----> <span class="title" style="display:;">åœ¨çº¿æ–‡æ¡£</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å‰ç«¯æ–‡æ¡£</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Element - ç½‘ç«™å¿«é€Ÿæˆå‹å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://lodash.com/docs/#defaultsDeep" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lodash Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://zh.nuxtjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js - Vue.js é€šç”¨åº”ç”¨æ¡†æ¶
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuex.vuejs.org/zh/api/#vuex-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.vuepress.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress ä¸­æ–‡æ–‡æ¡£
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>åç«¯æ–‡æ¡£</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ifeve.com/google-guava/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google Guavaå®˜æ–¹æ•™ç¨‹
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨çº¿å·¥å…·" class="dropdown-title"><!----> <span class="title" style="display:;">åœ¨çº¿å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>åœ¨çº¿ç¼–è¾‘</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://excalidraw.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿ç™½æ¿
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON ç¼–è¾‘å™¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD è¡¨æ ¼ç”Ÿæˆ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON è¡¨è¾¾å¼
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä»£ç æ ¼å¼åŒ–
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  äºŒç»´ç ç”Ÿæˆå™¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åœ¨çº¿ç¼–ç è½¬æ¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>åœ¨çº¿æœåŠ¡</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.processon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æµç¨‹å›¾æ€ç»´å¯¼å›¾
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://excalidraw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç”»å›¾å·¥å…·
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>å¼€æºé•œåƒ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSXé•œåƒç«™
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZUREé•œåƒç«™
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Hub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">ğŸ’–æ”¯æŒ</a></div><div class="nav-item"><a href="https://www.pigcs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è¿”å›æ—§ç‰ˆ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Cloud Gateway</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/aa8849/" class="sidebar-link">Spring Cloud ä¹‹ Gateway</a></li><li><a href="/pages/f0610e/" class="sidebar-link">Spring Cloud Gateway é…ç½®å¤§å…¨</a></li><li><a href="/pages/f7b8bf/" aria-current="page" class="active sidebar-link">Spring Cloud Gateway ä¸­æ–‡å®˜ç½‘æ–‡æ¡£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#æ–‡æ¡£ç‰ˆæœ¬-2-1-0" class="sidebar-link">æ–‡æ¡£ç‰ˆæœ¬ 2.1.0</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_1-å¦‚ä½•åœ¨å·¥ç¨‹ä¸­å¼•ç”¨spring-cloud-gateway" class="sidebar-link">1. å¦‚ä½•åœ¨å·¥ç¨‹ä¸­å¼•ç”¨Spring Cloud Gateway</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_2-è¯æ±‡è¡¨" class="sidebar-link">2. è¯æ±‡è¡¨</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_3-å¦‚ä½•å·¥ä½œçš„" class="sidebar-link">3. å¦‚ä½•å·¥ä½œçš„</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-è·¯ç”±æ–­è¨€factories" class="sidebar-link">4. è·¯ç”±æ–­è¨€Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-1-after-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.1 After è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-2-before-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.2 Before è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-3-between-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.3 Between è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-4-cookie-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.4 Cookie è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-5-header-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.5 Header  è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-6-host-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.6 Host è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-7-method-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.7 Method è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-8-path-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.8 Path è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-9-query-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.9 Query è·¯ç”±æ–­è¨€ Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-10-remoteaddr-è·¯ç”±æ–­è¨€-factory" class="sidebar-link">4.10 RemoteAddr è·¯ç”±æ–­è¨€ Factory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-10-1-ä¿®æ”¹è¿œç¨‹åœ°å€çš„è§£ææ–¹å¼" class="sidebar-link">4.10.1 ä¿®æ”¹è¿œç¨‹åœ°å€çš„è§£ææ–¹å¼</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-1-addrequestheader-gatewayfilter-factory" class="sidebar-link">5.1 AddRequestHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-2-addrequestparameter-gatewayfilter-factory" class="sidebar-link">5.2 AddRequestParameter GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-3-addresponseheader-gatewayfilter-factory" class="sidebar-link">5.3 AddResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-4-hystrix-gatewayfilter-factory" class="sidebar-link">5.4 Hystrix GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-5-fallbackheaders-gatewayfilter-factory" class="sidebar-link">5.5 FallbackHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-6-prefixpath-gatewayfilter-factory" class="sidebar-link">5.6 PrefixPath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-7-preservehostheader-gatewayfilter-factory" class="sidebar-link">5.7 PreserveHostHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-8-requestratelimiter-gatewayfilter-factory" class="sidebar-link">5.8 RequestRateLimiter GatewayFilter Factory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-8-1-redis-ratelimiter" class="sidebar-link">5.8.1 Redis RateLimiter</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-9-redirectto-gatewayfilter-factory" class="sidebar-link">5.9 RedirectTo GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-10-removenonproxyheaders-gatewayfilter-factory" class="sidebar-link">5.10 RemoveNonProxyHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-11-removerequestheader-gatewayfilter-factory" class="sidebar-link">5.11 RemoveRequestHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-12-removeresponseheader-gatewayfilter-factory" class="sidebar-link">5.12 RemoveResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-13-rewritepath-gatewayfilter-factory" class="sidebar-link">5.13 RewritePath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-14-rewriteresponseheader-gatewayfilter-factory" class="sidebar-link">5.14 RewriteResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-15-savesession-gatewayfilter-factory" class="sidebar-link">5.15 SaveSession GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-16-secureheaders-gatewayfilter-factory" class="sidebar-link">5.16 SecureHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-17-setpath-gatewayfilter-factory" class="sidebar-link">5.17 SetPath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-18-setresponseheader-gatewayfilter-factory" class="sidebar-link">5.18 SetResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-19-setstatus-gatewayfilter-factory" class="sidebar-link">5.19 SetStatus GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-20-stripprefix-gatewayfilter-factory" class="sidebar-link">5.20 StripPrefix GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-21-retry-gatewayfilter-factory" class="sidebar-link">5.21 Retry GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-22-requestsize-gatewayfilter-factory" class="sidebar-link">5.22 RequestSize GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-23-modify-request-body-gatewayfilter-factory" class="sidebar-link">5.23 Modify Request Body GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-24-modify-response-body-gatewayfilter-factory" class="sidebar-link">5.24 Modify Response Body GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-1-å…¨å±€filterå’Œgatewayfilterç»„åˆæ’åº" class="sidebar-link">6.1 å…¨å±€Filterå’ŒGatewayFilterç»„åˆæ’åº</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-2-forward-routing-filter" class="sidebar-link">6.2 Forward Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-3-loadbalancerclient-filter" class="sidebar-link">6.3 LoadBalancerClient Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-4-netty-routing-filter" class="sidebar-link">6.4 Netty Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-5-netty-write-response-filter" class="sidebar-link">6.5 Netty Write Response Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-6-routetorequesturl-filter" class="sidebar-link">6.6 RouteToRequestUrl Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-7-websocket-routing-filter" class="sidebar-link">6.7 Websocket Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-8-gateway-metrics-filter" class="sidebar-link">6.8 Gateway Metrics Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-9-making-an-exchange-as-routed" class="sidebar-link">6.9 Making An Exchange As Routed</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_7-1-tls-æ¡æ‰‹" class="sidebar-link">7.1 TLS æ¡æ‰‹</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-1-fluent-java-routes-api" class="sidebar-link">8.1 Fluent Java Routes API</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-2-discoveryclient-route-definition-locator" class="sidebar-link">8.2 DiscoveryClient Route Definition Locator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes" class="sidebar-link">8.2.1 Configuring Predicates and Filters For DiscoveryClient Routes</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-retrieving-route-filters" class="sidebar-link">11.1 Retrieving route filters</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-1-global-filters" class="sidebar-link">11.1.1 Global Filters</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-2-route-filters" class="sidebar-link">11.1.2 Route Filters</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-2-refreshing-the-route-cache" class="sidebar-link">11.2 Refreshing the route cache</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-3-retrieving-the-routes-defined-in-the-gateway" class="sidebar-link">11.3 Retrieving the routes defined in the gateway</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-4-retrieving-information-about-a-particular-route" class="sidebar-link">11.4 Retrieving information about a particular route</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-5-creating-and-deleting-a-particular-route" class="sidebar-link">11.5 Creating and deleting a particular route</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-6-recap-list-of-all-endpoints" class="sidebar-link">11.6 Recap: list of all endpoints</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-1-writing-custom-route-predicate-factories" class="sidebar-link">12.1 Writing Custom Route Predicate Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-2-writing-custom-gatewayfilter-factories" class="sidebar-link">12.2 Writing Custom GatewayFilter Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-3-writing-custom-global-filters" class="sidebar-link">12.3 Writing Custom Global Filters</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-4-writing-custom-route-locators-and-writers" class="sidebar-link">12.4 Writing Custom Route Locators and Writers</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><span data-v-0c557b5e>Spring Cloud Gateway</span></li><li data-v-0c557b5e><span data-v-0c557b5e>Spring Cloud Gateway</span></li></ul> <div class="info" data-v-0c557b5e><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/heyuqiang" target="_blank" title="ä½œè€…" class="beLink" data-v-0c557b5e>heyuqiang</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-02-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Spring Cloud Gateway ä¸­æ–‡å®˜ç½‘æ–‡æ¡£<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="spring-cloud-gateway-ä¸­æ–‡å®˜ç½‘æ–‡æ¡£"><a href="#spring-cloud-gateway-ä¸­æ–‡å®˜ç½‘æ–‡æ¡£" class="header-anchor">#</a> Spring Cloud Gateway ä¸­æ–‡å®˜ç½‘æ–‡æ¡£</h1> <h2 id="æ–‡æ¡£ç‰ˆæœ¬-2-1-0"><a href="#æ–‡æ¡£ç‰ˆæœ¬-2-1-0" class="header-anchor">#</a> æ–‡æ¡£ç‰ˆæœ¬ 2.1.0</h2> <p><strong>ç›®å½•</strong></p> <div class="language- extra-class"><pre class="language-text"><code>1. How to Include Spring Cloud Gateway
2. Glossary
3. How It Works
4. Route Predicate Factories
5. GatewayFilter Factories
6. Global Filters
7. TLS / SSL
8. Configuration
9. Reactor Netty Access Logs
10. CORS Configuration
11. Actuator API
12. Developer Guide
</code></pre></div><p>è¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªå»ºç«‹åœ¨Spring Ecosystemä¹‹ä¸Šçš„<a href="https://cloud.tencent.com/product/apigateway?from=10680" target="_blank" rel="noopener noreferrer">APIç½‘å…³<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼ŒåŒ…æ‹¬ï¼šSpring 5ï¼ŒSpring Boot 2å’ŒProject Reactorã€‚Spring Cloud Gatewayæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œå¹¶ä¸ºä»–ä»¬æä¾›åˆ‡é¢ï¼Œä¾‹å¦‚ï¼šå®‰å…¨æ€§ï¼Œç›‘æ§/æŒ‡æ ‡ å’Œå¼¹æ€§ç­‰ã€‚</p> <h2 id="_1-å¦‚ä½•åœ¨å·¥ç¨‹ä¸­å¼•ç”¨spring-cloud-gateway"><a href="#_1-å¦‚ä½•åœ¨å·¥ç¨‹ä¸­å¼•ç”¨spring-cloud-gateway" class="header-anchor">#</a> 1. å¦‚ä½•åœ¨å·¥ç¨‹ä¸­å¼•ç”¨Spring Cloud Gateway</h2> <p>è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥Spring Cloud Gatewayï¼Œéœ€è¦å¼•ç”¨ group  <code>org.springframework.cloud</code> å’Œ artifact idä¸º<code>spring-cloud-starter-gateway</code> starterã€‚æœ€æ–°çš„Spring Cloud Release æ„å»ºä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud Project page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>å¦‚æœåº”ç”¨äº†è¯¥starterï¼Œä½†ç”±äºæŸç§åŸå› ä¸å¸Œæœ›å¯ç”¨ç½‘å…³ï¼Œè¯·è¿›è¡Œè®¾ç½®<code>spring.cloud.gateway.enabled=false</code>ã€‚</p> <blockquote><p>é‡è¦ Spring Cloud Gatewayä¾èµ–Spring Bootå’ŒSpring Webfluxæä¾›çš„Netty runtimeã€‚å®ƒä¸èƒ½åœ¨ä¼ ç»Ÿçš„Servletå®¹å™¨ä¸­å·¥ä½œæˆ–æ„å»ºä¸ºWAR</p></blockquote> <h2 id="_2-è¯æ±‡è¡¨"><a href="#_2-è¯æ±‡è¡¨" class="header-anchor">#</a> 2. è¯æ±‡è¡¨</h2> <ul><li><strong>Route è·¯ç”±</strong>ï¼šgatewayçš„åŸºæœ¬æ„å»ºæ¨¡å—ã€‚å®ƒç”±IDã€ç›®æ ‡URIã€æ–­è¨€é›†åˆå’Œè¿‡æ»¤å™¨é›†åˆç»„æˆã€‚å¦‚æœèšåˆæ–­è¨€ç»“æœä¸ºçœŸï¼Œåˆ™åŒ¹é…åˆ°è¯¥è·¯ç”±ã€‚</li> <li><strong>Predicate æ–­è¨€</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html" target="_blank" rel="noopener noreferrer">Java 8 Function Predicate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚è¾“å…¥ç±»å‹æ˜¯<a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html" target="_blank" rel="noopener noreferrer"> Spring Framework <code>ServerWebExchange</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚è¿™å…è®¸å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…æ¥è‡ªHTTPè¯·æ±‚çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚Headeræˆ–å‚æ•°ã€‚</li> <li><strong>Filter è¿‡æ»¤å™¨</strong>ï¼šè¿™äº›æ˜¯ä½¿ç”¨ç‰¹å®šå·¥å‚æ„å»ºçš„<a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html" target="_blank" rel="noopener noreferrer"> Spring Framework<code>GatewayFilter</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å®ä¾‹ã€‚æ‰€ä»¥å¯ä»¥åœ¨è¿”å›è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”çš„å†…å®¹ã€‚</li></ul> <h2 id="_3-å¦‚ä½•å·¥ä½œçš„"><a href="#_3-å¦‚ä½•å·¥ä½œçš„" class="header-anchor">#</a> 3. å¦‚ä½•å·¥ä½œçš„</h2> <p><img src="/img/spring_cloud_gateway_diagram.png" alt="img"></p> <p>Spring Cloud Gateway Diagram</p> <p>å®¢æˆ·ç«¯å‘Spring Cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚å¦‚æœGateway Handler Mappingç¡®å®šè¯·æ±‚ä¸è·¯ç”±åŒ¹é…ï¼Œåˆ™å°†å…¶å‘é€åˆ°Gateway Web Handlerã€‚æ­¤handleré€šè¿‡ç‰¹å®šäºè¯¥è¯·æ±‚çš„è¿‡æ»¤å™¨é“¾å¤„ç†è¯·æ±‚ã€‚å›¾ä¸­filtersè¢«è™šçº¿åˆ’åˆ†çš„åŸå› æ˜¯filterså¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œé€»è¾‘ã€‚å…ˆæ‰§è¡Œæ‰€æœ‰â€œpre filterâ€é€»è¾‘ï¼Œç„¶åè¿›è¡Œè¯·æ±‚ä»£ç†ã€‚åœ¨è¯·æ±‚ä»£ç†æ‰§è¡Œå®Œåï¼Œæ‰§è¡Œâ€œpost filterâ€é€»è¾‘ã€‚</p> <blockquote><p>æ³¨æ„ HTTPå’ŒHTTPS URIé»˜è®¤ç«¯å£è®¾ç½®æ˜¯80å’Œ443ã€‚</p></blockquote> <h2 id="_4-è·¯ç”±æ–­è¨€factories"><a href="#_4-è·¯ç”±æ–­è¨€factories" class="header-anchor">#</a> 4. è·¯ç”±æ–­è¨€Factories</h2> <p>Spring Cloud Gatewayå°†è·¯ç”±ä½œä¸ºSpring WebFlux <code>HandlerMapping</code>åŸºç¡€ç»“æ„çš„ä¸€éƒ¨åˆ†è¿›è¡ŒåŒ¹é…ã€‚Spring Cloud GatewayåŒ…å«è®¸å¤šå†…ç½®çš„è·¯ç”±æ–­è¨€Factoriesã€‚è¿™äº›æ–­è¨€éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šä¸ªè·¯ç”±æ–­è¨€Factorieså¯ä»¥é€šè¿‡ <code>and</code> ç»„åˆä½¿ç”¨ã€‚</p> <h2 id="_4-1-after-è·¯ç”±æ–­è¨€-factory"><a href="#_4-1-after-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.1 After è·¯ç”±æ–­è¨€ Factory</h2> <p>After Route Predicate Factoryé‡‡ç”¨ä¸€ä¸ªå‚æ•°â€”â€”æ—¥æœŸæ—¶é—´ã€‚åœ¨è¯¥æ—¥æœŸæ—¶é—´ä¹‹åå‘ç”Ÿçš„è¯·æ±‚éƒ½å°†è¢«åŒ¹é…ã€‚</p> <p><strong>application.yml</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> After=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-2-before-è·¯ç”±æ–­è¨€-factory"><a href="#_4-2-before-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.2 Before è·¯ç”±æ–­è¨€ Factory</h2> <p>Before Route Predicate Factoryé‡‡ç”¨ä¸€ä¸ªå‚æ•°â€”â€”æ—¥æœŸæ—¶é—´ã€‚åœ¨è¯¥æ—¥æœŸæ—¶é—´ä¹‹å‰å‘ç”Ÿçš„è¯·æ±‚éƒ½å°†è¢«åŒ¹é…ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> before_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Before=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-3-between-è·¯ç”±æ–­è¨€-factory"><a href="#_4-3-between-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.3 Between è·¯ç”±æ–­è¨€ Factory</h2> <p>Between è·¯ç”±æ–­è¨€ Factoryæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œdatetime1å’Œdatetime2ã€‚åœ¨datetime1å’Œdatetime2ä¹‹é—´çš„è¯·æ±‚å°†è¢«åŒ¹é…ã€‚datetime2å‚æ•°çš„å®é™…æ—¶é—´å¿…é¡»åœ¨datetime1ä¹‹åã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> between_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Between=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span><span class="token punctuation">,</span> 2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>21T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-4-cookie-è·¯ç”±æ–­è¨€-factory"><a href="#_4-4-cookie-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.4 Cookie è·¯ç”±æ–­è¨€ Factory</h2> <p>Cookie è·¯ç”±æ–­è¨€ Factoryæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œcookieåç§°å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚è¯·æ±‚åŒ…å«æ¬¡cookieåç§°ä¸”æ­£åˆ™è¡¨è¾¾å¼ä¸ºçœŸçš„å°†ä¼šè¢«åŒ¹é…ã€‚</p> <p><strong>application.yml</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cookie_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Cookie=chocolate<span class="token punctuation">,</span> ch.p
</code></pre></div><h2 id="_4-5-header-è·¯ç”±æ–­è¨€-factory"><a href="#_4-5-header-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.5 Header  è·¯ç”±æ–­è¨€ Factory</h2> <p>Header è·¯ç”±æ–­è¨€ Factoryæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œheaderåç§°å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚è¯·æ±‚åŒ…å«æ¬¡headeråç§°ä¸”æ­£åˆ™è¡¨è¾¾å¼ä¸ºçœŸçš„å°†ä¼šè¢«åŒ¹é…ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> header_route
       <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
       <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+
</code></pre></div><h2 id="_4-6-host-è·¯ç”±æ–­è¨€-factory"><a href="#_4-6-host-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.6 Host è·¯ç”±æ–­è¨€ Factory</h2> <p>Host è·¯ç”±æ–­è¨€ FactoryåŒ…æ‹¬ä¸€ä¸ªå‚æ•°ï¼šhost nameåˆ—è¡¨ã€‚ä½¿ç”¨Antè·¯å¾„åŒ¹é…è§„åˆ™ï¼Œ<code>.</code>ä½œä¸ºåˆ†éš”ç¬¦ã€‚ <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Host=<span class="token important">**.somehost.org</span><span class="token punctuation">,</span><span class="token important">**.anotherhost.org</span>
</code></pre></div><h2 id="_4-7-method-è·¯ç”±æ–­è¨€-factory"><a href="#_4-7-method-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.7 Method è·¯ç”±æ–­è¨€ Factory</h2> <p>Method è·¯ç”±æ–­è¨€ FactoryåªåŒ…å«ä¸€ä¸ªå‚æ•°: éœ€è¦åŒ¹é…çš„HTTPè¯·æ±‚æ–¹å¼</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> method_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Method=GET
</code></pre></div><p>æ‰€æœ‰GETè¯·æ±‚éƒ½å°†è¢«è·¯ç”±</p> <h2 id="_4-8-path-è·¯ç”±æ–­è¨€-factory"><a href="#_4-8-path-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.8 Path è·¯ç”±æ–­è¨€ Factory</h2> <p>Path è·¯ç”±æ–­è¨€ Factory æœ‰2ä¸ªå‚æ•°: ä¸€ä¸ªSpring <code>PathMatcher</code>è¡¨è¾¾å¼åˆ—è¡¨å’Œå¯é€‰<code>matchOptionalTrailingSeparator</code>æ ‡è¯† .</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span><span class="token punctuation">,</span>/bar/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>ä¾‹å¦‚: <code>/foo/1</code> or <code>/foo/bar</code> or <code>/bar/baz</code>çš„è¯·æ±‚éƒ½å°†è¢«åŒ¹é…</p> <p>URI æ¨¡æ¿å˜é‡ (å¦‚ä¸Šä¾‹ä¸­çš„ <code>segment</code> ) å°†ä»¥Mapçš„æ–¹å¼ä¿å­˜äº<code>ServerWebExchange.getAttributes()</code> keyä¸º<code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>. è¿™äº›å€¼å°†åœ¨<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#gateway-route-filters" target="_blank" rel="noopener noreferrer">GatewayFilter Factories<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä½¿ç”¨</p> <p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥æ›´æ–¹ä¾¿åœ°è®¿é—®è¿™äº›å˜é‡ã€‚</p> <div class="language-yml extra-class"><pre class="language-yml"><code>Map&lt;String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span> uriVariables = ServerWebExchangeUtils.getPathPredicateVariables(exchange);

String segment = uriVariables.get(&quot;segment&quot;);
</code></pre></div><h2 id="_4-9-query-è·¯ç”±æ–­è¨€-factory"><a href="#_4-9-query-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.9 Query è·¯ç”±æ–­è¨€ Factory</h2> <p>Query è·¯ç”±æ–­è¨€ Factory æœ‰2ä¸ªå‚æ•°: å¿…é€‰é¡¹ <code>param</code> å’Œå¯é€‰é¡¹ <code>regexp</code>.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Query=baz
</code></pre></div><p>åˆ™åŒ…å«äº†è¯·æ±‚å‚æ•° <code>baz</code>çš„éƒ½å°†è¢«åŒ¹é…ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Query=foo<span class="token punctuation">,</span> ba.
</code></pre></div><p>å¦‚æœè¯·æ±‚å‚æ•°é‡ŒåŒ…å«<code>foo</code>å‚æ•°ï¼Œå¹¶ä¸”å€¼åŒ¹é…ä¸º<code>ba.</code> è¡¨è¾¾å¼ï¼Œåˆ™å°†ä¼šè¢«è·¯ç”±ï¼Œå¦‚ï¼š<code>bar</code> and <code>baz</code></p> <h2 id="_4-10-remoteaddr-è·¯ç”±æ–­è¨€-factory"><a href="#_4-10-remoteaddr-è·¯ç”±æ–­è¨€-factory" class="header-anchor">#</a> 4.10 RemoteAddr è·¯ç”±æ–­è¨€ Factory</h2> <p>RemoteAddr è·¯ç”±æ–­è¨€ Factoryçš„å‚æ•°ä¸º ä¸€ä¸ªCIDRç¬¦å·ï¼ˆIPv4æˆ–IPv6ï¼‰å­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼Œæœ€å°å€¼ä¸º1ï¼Œä¾‹å¦‚192.168.0.1/16ï¼ˆå…¶ä¸­192.168.0.1æ˜¯IPåœ°å€å¹¶ä¸”16æ˜¯å­ç½‘æ©ç ï¼‰ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> remoteaddr_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoteAddr=192.168.1.1/24
</code></pre></div><p>å¦‚æœè¯·æ±‚çš„remote address ä¸º <code>192.168.1.10</code>åˆ™å°†è¢«è·¯ç”±</p> <h3 id="_4-10-1-ä¿®æ”¹è¿œç¨‹åœ°å€çš„è§£ææ–¹å¼"><a href="#_4-10-1-ä¿®æ”¹è¿œç¨‹åœ°å€çš„è§£ææ–¹å¼" class="header-anchor">#</a> 4.10.1 ä¿®æ”¹è¿œç¨‹åœ°å€çš„è§£ææ–¹å¼</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRemoteAddr è·¯ç”±æ–­è¨€ Factoryä½¿ç”¨ä¼ å…¥è¯·æ±‚ä¸­çš„remote addressã€‚å¦‚æœSpring Cloud Gatewayä½äºä»£ç†å±‚åé¢ï¼Œåˆ™å¯èƒ½ä¸å®é™…å®¢æˆ·ç«¯IPåœ°å€ä¸åŒ¹é…ã€‚</p> <p>å¯ä»¥é€šè¿‡è®¾ç½®è‡ªå®šä¹‰<code>RemoteAddressResolver</code>æ¥è‡ªå®šä¹‰è§£æè¿œç¨‹åœ°å€çš„æ–¹å¼ã€‚Spring Cloud Gatewayç½‘å…³é™„å¸¦ä¸€ä¸ªéé»˜è®¤è¿œç¨‹åœ°å€è§£æç¨‹åºï¼Œå®ƒåŸºäº<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" target="_blank" rel="noopener noreferrer">X-Forwarded-For header<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <code>XForwardedRemoteAddressResolver</code>.</p> <p><code>XForwardedRemoteAddressResolver</code> æœ‰ä¸¤ä¸ªé™æ€æ„é€ å‡½æ•°æ–¹æ³•ï¼Œé‡‡ç”¨ä¸åŒçš„å®‰å…¨æ–¹æ³•ï¼š</p> <ol><li><code>XForwardedRemoteAddressResolver:ï¼šTrustAll</code>è¿”å›ä¸€ä¸ª<code>RemoteAddressResolver</code>ï¼Œå®ƒå§‹ç»ˆé‡‡ç”¨<code>X-Forwarded-for</code>å¤´ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªIPåœ°å€ã€‚è¿™ç§æ–¹æ³•å®¹æ˜“å—åˆ°æ¬ºéª—ï¼Œå› ä¸ºæ¶æ„å®¢æˆ·ç«¯å¯èƒ½ä¼šä¸ºè§£æç¨‹åºæ¥å—çš„â€œx-forwarded-forâ€è®¾ç½®åˆå§‹å€¼ã€‚</li> <li><code>XForwardedRemoteAddressResolver:ï¼šMaxTrustedIndex</code>è·å–ä¸€ä¸ªç´¢å¼•ï¼Œè¯¥ç´¢å¼•ä¸åœ¨Spring Cloudç½‘å…³å‰è¿è¡Œçš„å—ä¿¡ä»»åŸºç¡€è®¾æ–½æ•°é‡ç›¸å…³ã€‚ä¾‹å¦‚ï¼Œå¦‚æœSpringCloudGatewayåªèƒ½é€šè¿‡haproxyè®¿é—®ï¼Œåˆ™åº”ä½¿ç”¨å€¼1ã€‚å¦‚æœåœ¨è®¿é—®Spring Cloud Gatewayä¹‹å‰éœ€è¦ä¸¤ä¸ªå—ä¿¡ä»»çš„åŸºç¡€æ¶æ„è·ƒç‚¹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨2ã€‚</li></ol> <p>ç»™å®šä»¥ä¸‹çš„headerå€¼ï¼š</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">X-Forwarded-For</span><span class="token punctuation">:</span> 0.0.0.1<span class="token punctuation">,</span> 0.0.0.2<span class="token punctuation">,</span> 0.0.0.3
</code></pre></div><p>ä¸‹é¢çš„` maxTrustedIndexå€¼å°†ç”Ÿæˆä»¥ä¸‹è¿œç¨‹åœ°å€:</p> <table><thead><tr><th style="text-align:left;"><code>maxTrustedIndex</code></th> <th style="text-align:left;">result</th></tr></thead> <tbody><tr><td style="text-align:left;">[<code>Integer.MIN_VALUE</code>,0]</td> <td style="text-align:left;">(invalid, <code>IllegalArgumentException</code> during initialization)</td></tr> <tr><td style="text-align:left;">1</td> <td style="text-align:left;">0.0.0.3</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">0.0.0.2</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">0.0.0.1</td></tr> <tr><td style="text-align:left;">[4, <code>Integer.MAX_VALUE</code>]</td> <td style="text-align:left;">0.0.0.1</td></tr></tbody></table> <p>Java é…ç½®æ–¹å¼:</p> <p><strong>GatewayConfig.java</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RemoteAddressResolver</span> resolver <span class="token operator">=</span> <span class="token class-name">XForwardedRemoteAddressResolver</span>
    <span class="token punctuation">.</span><span class="token function">maxTrustedIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;direct-route&quot;</span><span class="token punctuation">,</span>
    r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span><span class="token string">&quot;10.1.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;proxied-route&quot;</span><span class="token punctuation">,</span>
    r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span>resolver<span class="token punctuation">,</span>  <span class="token string">&quot;10.10.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream2&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h1 id="_5-gatewayfilter-factories"><a href="#_5-gatewayfilter-factories" class="header-anchor">#</a> 5. GatewayFilter Factories</h1> <p>è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„HTTPè¯·æ±‚æˆ–è¿”å›çš„HTTPå“åº”ã€‚è¿‡æ»¤å™¨çš„ä½œç”¨åŸŸæ˜¯æŸäº›ç‰¹å®šè·¯ç”±ã€‚Spring Cloud GatewayåŒ…æ‹¬è®¸å¤šå†…ç½®çš„ Filterå·¥å‚ã€‚</p> <p>æ³¨æ„ï¼šæœ‰å…³å¦‚ä½•ä½¿ç”¨ä»¥ä¸‹ä»»ä½•è¿‡æ»¤å™¨çš„æ›´è¯¦ç»†ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/master/spring-cloud-gateway-core/src/test/java/org/springframework/cloud/gateway/filter/factory" target="_blank" rel="noopener noreferrer">unit tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.ã€‚</p> <h2 id="_5-1-addrequestheader-gatewayfilter-factory"><a href="#_5-1-addrequestheader-gatewayfilter-factory" class="header-anchor">#</a> 5.1 AddRequestHeader GatewayFilter Factory</h2> <p>é‡‡ç”¨ä¸€å¯¹åç§°å’Œå€¼ä½œä¸ºå‚æ•° <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>å¯¹äºæ‰€æœ‰åŒ¹é…çš„è¯·æ±‚ï¼Œè¿™å°†å‘ä¸‹æ¸¸è¯·æ±‚çš„å¤´ä¸­æ·»åŠ  <code>x-request-foo:bar</code> header</p> <h2 id="_5-2-addrequestparameter-gatewayfilter-factory"><a href="#_5-2-addrequestparameter-gatewayfilter-factory" class="header-anchor">#</a> 5.2 AddRequestParameter GatewayFilter Factory</h2> <p>é‡‡ç”¨ä¸€å¯¹åç§°å’Œå€¼ä½œä¸ºå‚æ•° <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_parameter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestParameter=foo<span class="token punctuation">,</span> bar
</code></pre></div><p>å¯¹äºæ‰€æœ‰åŒ¹é…çš„è¯·æ±‚ï¼Œè¿™å°†å‘ä¸‹æ¸¸è¯·æ±‚æ·»åŠ <code>foo=bar</code>æŸ¥è¯¢å­—ç¬¦ä¸²</p> <h2 id="_5-3-addresponseheader-gatewayfilter-factory"><a href="#_5-3-addresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.3 AddResponseHeader GatewayFilter Factory</h2> <p>é‡‡ç”¨ä¸€å¯¹åç§°å’Œå€¼ä½œä¸ºå‚æ•°</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>å¯¹äºæ‰€æœ‰åŒ¹é…çš„è¯·æ±‚ï¼Œè¿™ä¼šå°†<code>x-response-foo:bar</code>å¤´æ·»åŠ åˆ°ä¸‹æ¸¸å“åº”çš„headerä¸­</p> <h2 id="_5-4-hystrix-gatewayfilter-factory"><a href="#_5-4-hystrix-gatewayfilter-factory" class="header-anchor">#</a> 5.4 Hystrix GatewayFilter Factory</h2> <p><a href="https://github.com/Netflix/Hystrix" target="_blank" rel="noopener noreferrer">Hystrix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ˜¯Netflixå¼€æºçš„æ–­è·¯å™¨ç»„ä»¶ã€‚Hystrix GatewayFilterå…è®¸ä½ å‘ç½‘å…³è·¯ç”±å¼•å…¥æ–­è·¯å™¨ï¼Œä¿æŠ¤ä½ çš„æœåŠ¡ä¸å—çº§è”æ•…éšœçš„å½±å“ï¼Œå¹¶å…è®¸ä½ åœ¨ä¸‹æ¸¸æ•…éšœæ—¶æä¾›fallbackå“åº”ã€‚</p> <p>è¦åœ¨é¡¹ç›®ä¸­å¯ç”¨Hystrixç½‘å…³è¿‡æ»¤å™¨ï¼Œéœ€è¦æ·»åŠ å¯¹ <code>spring-cloud-starter-netflix-hystrix</code>çš„ä¾èµ– <a href="https://cloud.spring.io/spring-cloud-netflix/" target="_blank" rel="noopener noreferrer">Spring Cloud Netflix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Hystrix GatewayFilter Factory éœ€è¦ä¸€ä¸ªnameå‚æ•°ï¼Œå³<code>HystrixCommand</code>çš„åç§°ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> hystrix_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Hystrix=myCommandName
</code></pre></div><p>è¿™å°†å‰©ä½™çš„è¿‡æ»¤å™¨åŒ…è£…åœ¨å‘½ä»¤åä¸ºâ€œmyCommandNameâ€çš„<code>HystrixCommand</code>ä¸­ã€‚</p> <p>hystrixè¿‡æ»¤å™¨è¿˜å¯ä»¥æ¥å—å¯é€‰çš„<code>fallbackUri</code> å‚æ•°ã€‚ç›®å‰ï¼Œä»…æ”¯æŒ<code>forward:</code> é¢„è®¾çš„URIï¼Œå¦‚æœè°ƒç”¨fallbackï¼Œåˆ™è¯·æ±‚å°†è½¬å‘åˆ°ä¸URIåŒ¹é…çš„æ§åˆ¶å™¨ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> hystrix_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//backing<span class="token punctuation">-</span>service<span class="token punctuation">:</span><span class="token number">8088</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/consumingserviceendpoint
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fallbackcmd
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/incaseoffailureusethis
        <span class="token punctuation">-</span> RewritePath=/consumingserviceendpoint<span class="token punctuation">,</span> /backingserviceendpoint
</code></pre></div><p>å½“è°ƒç”¨hystrix fallbackæ—¶ï¼Œè¿™å°†è½¬å‘åˆ°<code>/incaseoffailureusethis</code> uriã€‚æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹è¿˜æ¼”ç¤ºäº†ï¼ˆå¯é€‰ï¼‰é€šè¿‡ç›®æ ‡URIä¸Šçš„'lb`å‰ç¼€,ä½¿ç”¨Spring Cloud Netflix Ribbon å®¢æˆ·ç«¯<a href="https://cloud.tencent.com/product/clb?from=10680" target="_blank" rel="noopener noreferrer">è´Ÿè½½å‡è¡¡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>ä¸»è¦åœºæ™¯æ˜¯ä½¿ç”¨<code>fallbackUri</code> åˆ°ç½‘å…³åº”ç”¨ç¨‹åºä¸­çš„å†…éƒ¨æ§åˆ¶å™¨æˆ–å¤„ç†ç¨‹åºã€‚ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥å°†è¯·æ±‚é‡æ–°è·¯ç”±åˆ°å¤–éƒ¨åº”ç”¨ç¨‹åºä¸­çš„æ§åˆ¶å™¨æˆ–å¤„ç†ç¨‹åºï¼Œå¦‚ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ingredients
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=//ingredients/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/fallback
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9994</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/fallback
</code></pre></div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œgatewayåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰ <code>fallback</code> å®ç°ï¼Œä½†æ˜¯å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰ä¸€ä¸ªæ¥å£å®ç°ï¼Œæ³¨å†Œä¸ºâ€œ<a href="http://localhost:9994/" target="_blank" rel="noopener noreferrer">http://localhost:9994<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>â€ã€‚</p> <p>åœ¨å°†è¯·æ±‚è½¬å‘åˆ°fallbackçš„æƒ…å†µä¸‹ï¼ŒHystrix Gatewayè¿‡æ»¤è¿˜æ”¯æŒç›´æ¥æŠ›å‡º<code>Throwable</code> ã€‚å®ƒè¢«ä½œä¸º<code>ServerWebExchangeUtils.HYSTRIX_EXECUTION_EXCEPTION_ATTR</code>å±æ€§æ·»åŠ åˆ°<code>ServerWebExchange</code>ä¸­ï¼Œå¯ä»¥åœ¨å¤„ç†ç½‘å…³åº”ç”¨ç¨‹åºä¸­çš„fallbackæ—¶ä½¿ç”¨ã€‚</p> <p>å¯¹äºå¤–éƒ¨æ§åˆ¶å™¨/å¤„ç†ç¨‹åºæ–¹æ¡ˆï¼Œå¯ä»¥æ·»åŠ å¸¦æœ‰å¼‚å¸¸è¯¦ç»†ä¿¡æ¯çš„headerã€‚å¯ä»¥åœ¨ <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#fallback-headers" target="_blank" rel="noopener noreferrer">FallbackHeaders GatewayFilter Factory section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.ä¸­æ‰¾åˆ°æœ‰å…³å®ƒçš„æ›´å¤šä¿¡æ¯ã€‚</p> <p>hystrixé…ç½®å‚æ•°ï¼ˆå¦‚ timeoutsï¼‰å¯ä»¥ä½¿ç”¨å…¨å±€é»˜è®¤å€¼é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://github.com/Netflix/Hystrix/wiki/Configuration" target="_blank" rel="noopener noreferrer">Hystrix wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­æ‰€è¿°å±æ€§è¿›è¡Œé…ç½®ã€‚</p> <p>è¦ä¸ºä¸Šé¢çš„ç¤ºä¾‹è·¯ç”±è®¾ç½®5ç§’è¶…æ—¶ï¼Œå°†ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">hystrix.command.fallbackcmd.execution.isolation.thread.timeoutInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre></div><h2 id="_5-5-fallbackheaders-gatewayfilter-factory"><a href="#_5-5-fallbackheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.5 FallbackHeaders GatewayFilter Factory</h2> <p><code>FallbackHeaders</code>å…è®¸åœ¨è½¬å‘åˆ°å¤–éƒ¨åº”ç”¨ç¨‹åºä¸­çš„<code>FallbackUri</code>çš„è¯·æ±‚çš„headerä¸­æ·»åŠ Hystrixå¼‚å¸¸è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ingredients
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=//ingredients/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/fallback
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9994</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/fallback
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FallbackHeaders
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">executionExceptionTypeHeaderName</span><span class="token punctuation">:</span> Test<span class="token punctuation">-</span>Header
</code></pre></div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œåœ¨è¿è¡Œ<code>HystrixCommand</code>å‘ç”Ÿæ‰§è¡Œå¼‚å¸¸åï¼Œè¯·æ±‚å°†è¢«è½¬å‘åˆ° <code>localhost:9994</code>åº”ç”¨ç¨‹åºä¸­çš„ <code>fallback</code>ç»ˆç«¯æˆ–ç¨‹åºã€‚å¼‚å¸¸ç±»å‹ã€æ¶ˆæ¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰cause exceptionç±»å‹å’Œæ¶ˆæ¯çš„å¤´ï¼Œå°†ç”±<code>FallbackHeaders</code> filteræ·»åŠ åˆ°è¯¥è¯·æ±‚ä¸­ã€‚</p> <p>é€šè¿‡è®¾ç½®ä¸‹é¢åˆ—å‡ºçš„å‚æ•°å€¼åŠå…¶é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­è¦†ç›–headersçš„åç§°ï¼š</p> <ul><li><code>executionExceptionTypeHeaderName</code> (<code>&quot;Execution-Exception-Type&quot;</code>)</li> <li><code>executionExceptionMessageHeaderName</code> (<code>&quot;Execution-Exception-Message&quot;</code>)</li> <li><code>rootCauseExceptionTypeHeaderName</code> (<code>&quot;Root-Cause-Exception-Type&quot;</code>)</li> <li><code>rootCauseExceptionMessageHeaderName</code> (<code>&quot;Root-Cause-Exception-Message&quot;</code>)</li></ul> <p>Hystrix å¦‚ä½•å®ç°çš„æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#hystrix" target="_blank" rel="noopener noreferrer">Hystrix GatewayFilter Factory section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="_5-6-prefixpath-gatewayfilter-factory"><a href="#_5-6-prefixpath-gatewayfilter-factory" class="header-anchor">#</a> 5.6 PrefixPath GatewayFilter Factory</h2> <p>PrefixPath GatewayFilter åªæœ‰ä¸€ä¸ª <code>prefix</code> å‚æ•°.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> PrefixPath=/mypath
</code></pre></div><p>è¿™å°†ç»™æ‰€æœ‰åŒ¹é…è¯·æ±‚çš„è·¯å¾„åŠ å‰ç¼€<code>/mypath</code>ã€‚å› æ­¤ï¼Œå‘<code>/hello</code>å‘é€çš„è¯·æ±‚å°†å‘é€åˆ°<code>/mypath/hello</code>ã€‚</p> <h2 id="_5-7-preservehostheader-gatewayfilter-factory"><a href="#_5-7-preservehostheader-gatewayfilter-factory" class="header-anchor">#</a> 5.7 PreserveHostHeader GatewayFilter Factory</h2> <p>è¯¥filteræ²¡æœ‰å‚æ•°ã€‚è®¾ç½®äº†è¯¥Filteråï¼ŒGatewayFilterå°†ä¸ä½¿ç”¨ç”±HTTPå®¢æˆ·ç«¯ç¡®å®šçš„host header ï¼Œè€Œæ˜¯å‘é€åŸå§‹host header ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> preserve_host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> PreserveHostHeader
</code></pre></div><h2 id="_5-8-requestratelimiter-gatewayfilter-factory"><a href="#_5-8-requestratelimiter-gatewayfilter-factory" class="header-anchor">#</a> 5.8 RequestRateLimiter GatewayFilter Factory</h2> <p>RequestRateLimiterä½¿ç”¨<code>RateLimiter</code>å®ç°æ˜¯å¦å…è®¸ç»§ç»­æ‰§è¡Œå½“å‰è¯·æ±‚ã€‚å¦‚æœä¸å…è®¸ç»§ç»­æ‰§è¡Œï¼Œåˆ™è¿”å›<code>HTTP 429 - Too Many Requests</code> ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚</p> <p>è¿™ä¸ªè¿‡æ»¤å™¨å¯ä»¥é…ç½®ä¸€ä¸ªå¯é€‰çš„<code>keyResolver</code> å‚æ•°å’Œrate limiterå‚æ•°ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚</p> <p><code>keyResolver</code> æ˜¯ <code>KeyResolver</code> æ¥å£çš„å®ç°ç±».åœ¨é…ç½®ä¸­ï¼ŒæŒ‰åç§°ä½¿ç”¨SpELå¼•ç”¨beanã€‚<code>#{@myKeyResolver}</code> æ˜¯å¼•ç”¨åä¸º'myKeyResolver'çš„beançš„SpELè¡¨è¾¾å¼ã€‚</p> <p><strong>KeyResolver.java.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code>public interface KeyResolver <span class="token punctuation">{</span>
    Mono&lt;String<span class="token punctuation">&gt;</span> resolve(ServerWebExchange exchange);
<span class="token punctuation">}</span>
</code></pre></div><p><code>KeyResolver</code>æ¥å£å…è®¸ä½¿ç”¨å¯æ’æ‹”ç­–ç•¥æ¥æ´¾ç”Ÿé™åˆ¶è¯·æ±‚çš„keyã€‚åœ¨æœªæ¥çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ä¸­ï¼Œå°†æœ‰ä¸€äº›<code>KeyResolver</code>å®ç°ã€‚</p> <p><code>KeyResolver</code>çš„é»˜è®¤å®ç°æ˜¯<code>PrincipalNameKeyResolver</code>ï¼Œå®ƒä»<code>ServerWebExchange</code>æ£€ç´¢<code>Principal</code>å¹¶è°ƒç”¨<code>Principal.getName()</code>ã€‚</p> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ<code>KeyResolver</code> æ²¡æœ‰è·å–åˆ°keyï¼Œè¯·æ±‚å°†è¢«æ‹’ç»ã€‚æ­¤è¡Œä¸ºå¯ä»¥ä½¿ç”¨ <code>spring.cloud.gateway.filter.request-rate-limiter.deny-empty-key</code> (true or false) å’Œ <code>spring.cloud.gateway.filter.request-rate-limiter.empty-key-status-code</code>å±æ€§è¿›è¡Œè°ƒæ•´ã€‚</p> <blockquote><p>è¯´æ˜ æ— æ³•é€šè¿‡&quot;shortcut&quot; é…ç½®RequestRateLimiterã€‚ä»¥ä¸‹ç¤ºä¾‹<em>æ— æ•ˆ</em></p></blockquote> <p><strong>application.properties.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># INVALID SHORTCUT CONFIGURATION</span>
spring.cloud.gateway.routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=RequestRateLimiter=2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">#{@userkeyresolver}</span>
</code></pre></div><h3 id="_5-8-1-redis-ratelimiter"><a href="#_5-8-1-redis-ratelimiter" class="header-anchor">#</a> 5.8.1 Redis RateLimiter</h3> <p>Redisçš„å®ç°åŸºäº <a href="https://stripe.com/blog/rate-limiters" target="_blank" rel="noopener noreferrer">Stripe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å®ç°ã€‚å®ƒéœ€è¦ä½¿ç”¨ <code>spring-boot-starter-data-redis-reactive</code> Spring Boot starterã€‚</p> <p>ä½¿ç”¨çš„ç®—æ³•æ˜¯<a href="https://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="noopener noreferrer">Token Bucket Algorithm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.ã€‚</p> <p><code>redis-rate-limiter.replenishRate</code>æ˜¯ä½ å…è®¸ç”¨æˆ·æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚ï¼Œè€Œä¸¢å¼ƒä»»ä½•è¯·æ±‚ã€‚è¿™æ˜¯ä»¤ç‰Œæ¡¶çš„å¡«å……é€Ÿç‡ã€‚</p> <p>``redis-rate-limiter.burstCapacity`æ˜¯å…è®¸ç”¨æˆ·åœ¨ä¸€ç§’é’Ÿå†…æ‰§è¡Œçš„æœ€å¤§è¯·æ±‚æ•°ã€‚è¿™æ˜¯ä»¤ç‰Œæ¡¶å¯ä»¥ä¿å­˜çš„ä»¤ç‰Œæ•°ã€‚å°†æ­¤å€¼è®¾ç½®ä¸ºé›¶å°†é˜»æ­¢æ‰€æœ‰è¯·æ±‚ã€‚</p> <p>ç¨³å®šé€Ÿç‡æ˜¯é€šè¿‡åœ¨<code>replenishRate</code> å’Œ <code>burstCapacity</code>ä¸­è®¾ç½®ç›¸åŒçš„å€¼æ¥å®ç°çš„ã€‚å¯é€šè¿‡è®¾ç½®<code>burstCapacity</code>é«˜äº<code>replenishRate</code>æ¥å…è®¸ä¸´æ—¶çªå‘æµæµªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™æµå™¨éœ€è¦åœ¨ä¸¤æ¬¡çªå‘ä¹‹é—´ç•™å‡ºä¸€æ®µæ—¶é—´ï¼ˆæ ¹æ®<code>replenishRate</code>ï¼‰ï¼Œå› ä¸ºè¿ç»­ä¸¤æ¬¡çªå‘å°†å¯¼è‡´è¯·æ±‚ä¸¢å¤± (<code>HTTP 429 - Too Many Requests</code>).ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">20</span>
</code></pre></div><p><strong>Config.java.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
KeyResolver userKeyResolver() <span class="token punctuation">{</span>
    return exchange <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;));
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™å®šä¹‰äº†æ¯ä¸ªç”¨æˆ·10ä¸ªè¯·æ±‚çš„é™åˆ¶ã€‚å…è®¸20ä¸ªçªå‘ï¼Œä½†ä¸‹ä¸€ç§’åªæœ‰10ä¸ªè¯·æ±‚å¯ç”¨ã€‚<code>KeyResolver</code>æ˜¯ä¸€ä¸ªç®€å•çš„è·å–<code>user</code>è¯·æ±‚å‚æ•°çš„å·¥å…·ï¼ˆæ³¨æ„ï¼šä¸å»ºè®®ç”¨äºç”Ÿäº§ï¼‰ã€‚</p> <p>é™æµå™¨ä¹Ÿå¯ä»¥å®šä¹‰ä¸º<code>RateLimiter</code>æ¥å£çš„å®ç° beanã€‚åœ¨é…ç½®ä¸­ï¼ŒæŒ‰åç§°ä½¿ç”¨SpELå¼•ç”¨beanã€‚<code>#{@myRateLimiter}</code>æ˜¯å¼•ç”¨åä¸º'myRateLimiter'çš„beançš„SpELè¡¨è¾¾å¼ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">rate-limiter</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@myRateLimiter}&quot;</span>
            <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@userKeyResolver}&quot;</span>
</code></pre></div><h2 id="_5-9-redirectto-gatewayfilter-factory"><a href="#_5-9-redirectto-gatewayfilter-factory" class="header-anchor">#</a> 5.9 RedirectTo GatewayFilter Factory</h2> <p>è¯¥è¿‡æ»¤å™¨æœ‰ä¸€ä¸ª <code>status</code> å’Œä¸€ä¸ª <code>url</code>å‚æ•°ã€‚statusæ˜¯300ç±»é‡å®šå‘HTTPä»£ç ï¼Œå¦‚301ã€‚è¯¥URLåº”ä¸ºæœ‰æ•ˆçš„URLï¼Œè¿™å°†æ˜¯ <code>Location</code> headerçš„å€¼ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//acme.org
</code></pre></div><p>è¿™å°†å‘é€ä¸€ä¸ª302çŠ¶æ€ç å’Œä¸€ä¸ª<code>Location:http://acme.org</code> headeræ¥æ‰§è¡Œé‡å®šå‘ã€‚</p> <h2 id="_5-10-removenonproxyheaders-gatewayfilter-factory"><a href="#_5-10-removenonproxyheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.10 RemoveNonProxyHeaders GatewayFilter Factory</h2> <p>RemoveNonProxyHeaders GatewayFilter Factory ä»è½¬å‘è¯·æ±‚ä¸­åˆ é™¤headersã€‚åˆ é™¤çš„é»˜è®¤å¤´åˆ—è¡¨æ¥è‡ª <a href="https://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14#section-7.1.3" target="_blank" rel="noopener noreferrer">IETF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>The default removed headers are:</strong></p> <ul><li>Connection</li> <li>Keep-Alive</li> <li>Proxy-Authenticate</li> <li>Proxy-Authorization</li> <li>TE</li> <li>Trailer</li> <li>Transfer-Encoding</li> <li>Upgrade è¦æ›´æ”¹æ­¤è®¾ç½®ï¼Œè¯·å°† <code>spring.cloud.gateway.filter.remove-non-proxy-headers.headers</code>å±æ€§è®¾ç½®ä¸ºè¦åˆ é™¤çš„headeråç§°ã€‚</li></ul> <h2 id="_5-11-removerequestheader-gatewayfilter-factory"><a href="#_5-11-removerequestheader-gatewayfilter-factory" class="header-anchor">#</a> 5.11 RemoveRequestHeader GatewayFilter Factory</h2> <p>æœ‰ä¸€ä¸ª<code>name</code>å‚æ•°. è¿™æ˜¯è¦åˆ é™¤çš„headerçš„åç§°ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoveRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo
</code></pre></div><p>è¿™å°†åœ¨<code>X-Request-Foo</code> headerè¢«å‘é€åˆ°ä¸‹æ¸¸ä¹‹å‰åˆ é™¤å®ƒã€‚</p> <h2 id="_5-12-removeresponseheader-gatewayfilter-factory"><a href="#_5-12-removeresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.12 RemoveResponseHeader GatewayFilter Factory</h2> <p>æœ‰ä¸€ä¸ª<code>name</code>å‚æ•°. è¿™æ˜¯è¦åˆ é™¤çš„headerçš„åç§°ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removeresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoveResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo
</code></pre></div><p>è¿™å°†åœ¨è¿”å›åˆ°ç½‘å…³clientä¹‹å‰ä»å“åº”ä¸­åˆ é™¤<code>x-response-foo</code>å¤´ã€‚</p> <h2 id="_5-13-rewritepath-gatewayfilter-factory"><a href="#_5-13-rewritepath-gatewayfilter-factory" class="header-anchor">#</a> 5.13 RewritePath GatewayFilter Factory</h2> <p>åŒ…å«ä¸€ä¸ª <code>regexp</code>æ­£åˆ™è¡¨è¾¾å¼å‚æ•°å’Œä¸€ä¸ª <code>replacement</code> å‚æ•°. é€šè¿‡ä½¿ç”¨Javaæ­£åˆ™è¡¨è¾¾å¼çµæ´»åœ°é‡å†™è¯·æ±‚è·¯å¾„ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RewritePath=/foo/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /$\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹äºè¯·æ±‚è·¯å¾„<code>/foo/bar</code>ï¼Œå°†åœ¨å‘å‡ºä¸‹æ¸¸è¯·æ±‚ä¹‹å‰å°†è·¯å¾„è®¾ç½®ä¸º<code>/bar</code>ã€‚æ³¨æ„,ç”±äºYAMLè§„èŒƒï¼Œè¯·ä½¿ç”¨ <code>$\</code>æ›¿æ¢ <code>$</code>ã€‚</p> <h2 id="_5-14-rewriteresponseheader-gatewayfilter-factory"><a href="#_5-14-rewriteresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.14 RewriteResponseHeader GatewayFilter Factory</h2> <p>åŒ…å« <code>name</code>, <code>regexp</code>å’Œ <code>replacement</code> å‚æ•°.ã€‚é€šè¿‡ä½¿ç”¨Javaæ­£åˆ™è¡¨è¾¾å¼çµæ´»åœ°é‡å†™å“åº”å¤´çš„å€¼ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewriteresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RewriteResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> <span class="token punctuation">,</span> password=<span class="token punctuation">[</span>^&amp;<span class="token punctuation">]</span>+<span class="token punctuation">,</span> password=<span class="token important">***</span>
</code></pre></div><p>å¯¹äºä¸€ä¸ª<code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>çš„headerå€¼ï¼Œåœ¨åšä¸‹æ¸¸è¯·æ±‚æ—¶å°†è¢«è®¾ç½®ä¸º<code>/42?user=ford&amp;password=***&amp;flag=true</code>ï¼Œç”±äºYAMLè§„èŒƒï¼Œè¯·ä½¿ç”¨ <code>$\</code>æ›¿æ¢ <code>$</code>ã€‚</p> <h2 id="_5-15-savesession-gatewayfilter-factory"><a href="#_5-15-savesession-gatewayfilter-factory" class="header-anchor">#</a> 5.15 SaveSession GatewayFilter Factory</h2> <p>SaveSession GatewayFilter Factoryå°†è°ƒç”¨è½¬å‘åˆ°ä¸‹æ¸¸ä¹‹<strong>å‰</strong>å¼ºåˆ¶æ‰§è¡Œ<code>WebSession::save</code> æ“ä½œã€‚è¿™åœ¨ä½¿ç”¨ <a href="https://projects.spring.io/spring-session/" target="_blank" rel="noopener noreferrer">Spring Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¹‹ç±»æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œéœ€è¦ç¡®ä¿ä¼šè¯çŠ¶æ€åœ¨è¿›è¡Œè½¬å‘è°ƒç”¨ä¹‹å‰å·²ä¿å­˜ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> save_session
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SaveSession
</code></pre></div><p>å¦‚æœä½ å¸Œæœ›è¦å°†[Spring Security]ï¼ˆhttps://projects.spring.io/Spring Security/ï¼‰ä¸Spring Sessioné›†æˆ,å¹¶ç¡®ä¿å®‰å…¨è¯¦ç»†ä¿¡æ¯å·²è½¬å‘åˆ°è¿œç¨‹çš„è¿›ç¨‹ï¼Œè¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚</p> <h2 id="_5-16-secureheaders-gatewayfilter-factory"><a href="#_5-16-secureheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.16 SecureHeaders GatewayFilter Factory</h2> <p>SecureHeaders GatewayFilter Factory å°†è®¸å¤šheadersæ·»åŠ åˆ°reccomedationå¤„çš„å“åº”ä¸­ï¼Œä»<a href="https://blog.appcanary.com/2017/http-security-headers.html" target="_blank" rel="noopener noreferrer">this blog post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>æ·»åŠ ä»¥ä¸‹æ ‡é¢˜ï¼ˆä½¿ç”¨é»˜è®¤å€¼åˆ†é…ï¼‰:</strong></p> <ul><li><code>X-Xss-Protection:1; mode=block</code></li> <li><code>Strict-Transport-Security:max-age=631138519</code></li> <li><code>X-Frame-Options:DENY</code></li> <li><code>X-Content-Type-Options:nosniff</code></li> <li><code>Referrer-Policy:no-referrer</code></li> <li><code>Content-Security-Policy:default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline'</code></li> <li><code>X-Download-Options:noopen</code></li> <li><code>X-Permitted-Cross-Domain-Policies:none</code></li></ul> <p>è¦æ›´æ”¹é»˜è®¤å€¼ï¼Œè¯·åœ¨<code>spring.cloud.gateway.filter.secure-headers</code> å‘½åç©ºé—´ä¸­è®¾ç½®ç›¸åº”çš„å±æ€§ï¼š</p> <p><strong>Property to change:</strong></p> <ul><li><code>xss-protection-header</code></li> <li><code>strict-transport-security</code></li> <li><code>frame-options</code></li> <li><code>content-type-options</code></li> <li><code>referrer-policy</code></li> <li><code>content-security-policy</code></li> <li><code>download-options</code></li> <li><code>permitted-cross-domain-policies</code></li></ul> <h2 id="_5-17-setpath-gatewayfilter-factory"><a href="#_5-17-setpath-gatewayfilter-factory" class="header-anchor">#</a> 5.17 SetPath GatewayFilter Factory</h2> <p>SetPath GatewayFilter Factory é‡‡ç”¨ <code>template</code>è·¯å¾„å‚æ•°ã€‚å®ƒæä¾›äº†ä¸€ç§é€šè¿‡å…è®¸è·¯å¾„çš„æ¨¡æ¿åŒ–segmentsæ¥æ“ä½œè¯·æ±‚è·¯å¾„çš„ç®€å•æ–¹æ³•ã€‚ä½¿ç”¨Spring Frameworkä¸­çš„URIæ¨¡æ¿ï¼Œå…è®¸å¤šä¸ªåŒ¹é…segmentsã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetPath=/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>å¯¹äºä¸€ä¸ª <code>/foo/bar</code>è¯·æ±‚ï¼Œåœ¨åšä¸‹æ¸¸è¯·æ±‚å‰ï¼Œè·¯å¾„å°†è¢«è®¾ç½®ä¸º<code>/bar</code></p> <h2 id="_5-18-setresponseheader-gatewayfilter-factory"><a href="#_5-18-setresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.18 SetResponseHeader GatewayFilter Factory</h2> <p>SetResponseHeader GatewayFilter Factory åŒ…æ‹¬ <code>name</code> å’Œ <code>value</code> å‚æ•°.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>æ­¤GatewayFilterä½¿ç”¨ç»™å®šçš„åç§°æ›¿æ¢æ‰€æœ‰headerï¼Œè€Œä¸æ˜¯æ·»åŠ ã€‚å› æ­¤ï¼Œå¦‚æœä¸‹æ¸¸æœåŠ¡å™¨å“åº”ä¸º<code>X-Response-Foo:1234</code>ï¼Œåˆ™ä¼šå°†å…¶æ›¿æ¢ä¸º<code>X-Response-Foo:Bar</code>,è¿™æ˜¯ç½‘å…³å®¢æˆ·ç«¯å°†æ¥æ”¶çš„å†…å®¹ã€‚</p> <h2 id="_5-19-setstatus-gatewayfilter-factory"><a href="#_5-19-setstatus-gatewayfilter-factory" class="header-anchor">#</a> 5.19 SetStatus GatewayFilter Factory</h2> <p>SetStatus GatewayFilter Factory åŒ…æ‹¬å”¯ä¸€çš„ <code>status</code>å‚æ•°.å¿…é¡»æ˜¯ä¸€ä¸ªå¯ç”¨çš„Spring <code>HttpStatus</code>ã€‚å®ƒå¯ä»¥æ˜¯æ•´æ•°å€¼<code>404</code>æˆ–å­—ç¬¦ä¸²æšä¸¾<code>NOT_FOUND</code>ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusstring_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=BAD_REQUEST
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusint_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=401
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒHTTPè¿”å›ç å°†è®¾ç½®ä¸º401.</p> <h2 id="_5-20-stripprefix-gatewayfilter-factory"><a href="#_5-20-stripprefix-gatewayfilter-factory" class="header-anchor">#</a> 5.20 StripPrefix GatewayFilter Factory</h2> <p>StripPrefix GatewayFilter Factory åŒ…æ‹¬ä¸€ä¸ª<code>parts</code>å‚æ•°ã€‚ <code>parts</code>å‚æ•°æŒ‡ç¤ºåœ¨å°†è¯·æ±‚å‘é€åˆ°ä¸‹æ¸¸ä¹‹å‰ï¼Œè¦ä»è¯·æ±‚ä¸­å»é™¤çš„è·¯å¾„ä¸­çš„èŠ‚æ•°ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nameRoot
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nameservice
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/name/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> StripPrefix=2
</code></pre></div><p>å½“é€šè¿‡ç½‘å…³å‘å‡º<code>/name/bar/foo</code>è¯·æ±‚æ—¶ï¼Œå‘<code>nameservice</code>å‘å‡ºçš„è¯·æ±‚å°†æ˜¯<code>http://nameservice/foo</code>ã€‚</p> <h2 id="_5-21-retry-gatewayfilter-factory"><a href="#_5-21-retry-gatewayfilter-factory" class="header-anchor">#</a> 5.21 Retry GatewayFilter Factory</h2> <p>Retry GatewayFilter FactoryåŒ…æ‹¬ <code>retries</code>, <code>statuses</code>, <code>methods</code>å’Œ <code>series</code> å‚æ•°.</p> <ul><li><code>retries</code>: åº”å°è¯•çš„é‡è¯•æ¬¡æ•°</li> <li><code>statuses</code>: åº”è¯¥é‡è¯•çš„HTTPçŠ¶æ€ä»£ç ï¼Œç”¨<code>org.springframework.http.HttpStatus</code>æ ‡è¯†</li> <li><code>methods</code>: åº”è¯¥é‡è¯•çš„HTTPæ–¹æ³•ï¼Œç”¨ <code>org.springframework.http.HttpMethod</code>æ ‡è¯†</li> <li><code>series</code>: è¦é‡è¯•çš„ä¸€ç³»åˆ—çŠ¶æ€ç ï¼Œç”¨ <code>org.springframework.http.HttpStatus.Series</code>æ ‡è¯†</li></ul> <p><strong>application.yml.</strong></p> <p>spring: cloud: gateway: routes: - id: retry_test uri: http://localhost:8080/flakey predicates: - Host=*.retry.com filters: - name: Retry args: retries: 3 statuses: BAD_GATEWAY</p> <blockquote><p>æ³¨æ„ retry filter ä¸æ”¯æŒbodyè¯·æ±‚çš„é‡è¯•ï¼Œå¦‚é€šè¿‡bodyçš„POST æˆ– PUTè¯·æ±‚</p> <p>æ³¨æ„ åœ¨ä½¿ç”¨å¸¦æœ‰å‰ç¼€ä¸º <code>forward:</code> çš„<code>retry filter</code>æ—¶ï¼Œåº”ä»”ç»†ç¼–å†™ç›®æ ‡ç«¯ç‚¹ï¼Œä»¥ä¾¿åœ¨å‡ºç°é”™è¯¯æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•å¯èƒ½å¯¼è‡´å°†å“åº”å‘é€åˆ°å®¢æˆ·ç«¯å¹¶æäº¤çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›®æ ‡ç«¯ç‚¹æ˜¯å¸¦æ³¨è§£çš„controllerï¼Œåˆ™ç›®æ ‡controlleræ–¹æ³•ä¸åº”è¿”å›å¸¦æœ‰é”™è¯¯çŠ¶æ€ä»£ç çš„<code>ResponseEntity</code>ã€‚ç›¸åï¼Œå®ƒåº”è¯¥æŠ›å‡ºä¸€ä¸ª<code>Exception</code>ï¼Œæˆ–è€…å‘å‡ºä¸€ä¸ªé”™è¯¯ä¿¡å·ï¼Œä¾‹å¦‚é€šè¿‡<code>Mono.error(ex)</code> è¿”å›å€¼ï¼Œé‡è¯•è¿‡æ»¤å™¨å¯ä»¥é…ç½®ä¸ºé€šè¿‡é‡è¯•æ¥å¤„ç†ã€‚</p></blockquote> <h2 id="_5-22-requestsize-gatewayfilter-factory"><a href="#_5-22-requestsize-gatewayfilter-factory" class="header-anchor">#</a> 5.22 RequestSize GatewayFilter Factory</h2> <p>å½“è¯·æ±‚å¤§å°å¤§äºå…è®¸çš„é™åˆ¶æ—¶ï¼ŒRequestSize GatewayFilter Factoryå¯ä»¥é™åˆ¶è¯·æ±‚ä¸åˆ°è¾¾ä¸‹æ¸¸æœåŠ¡ã€‚è¿‡æ»¤å™¨ä»¥<code>RequestSize</code>ä½œä¸ºå‚æ•°ï¼Œè¿™æ˜¯å®šä¹‰è¯·æ±‚çš„å…è®¸å¤§å°é™åˆ¶(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> request_size_route
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/upload
      <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> Path=/upload
      <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestSize
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
          <span class="token key atrule">maxSize</span><span class="token punctuation">:</span> <span class="token number">5000000</span>
</code></pre></div><p>å½“è¯·æ±‚å› å¤§å°è€Œè¢«æ‹’ç»æ—¶ï¼Œ RequestSize GatewayFilter Factory å°†å“åº”çŠ¶æ€è®¾ç½®ä¸º<code>413 Payload Too Large</code>ï¼Œå¹¶å¸¦æœ‰é¢å¤–çš„header <code>errorMessage</code> ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª <code>errorMessage</code>çš„ä¾‹å­ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>errorMessage` : `Request size is larger than permissible limit. Request size is 6.0 MB where permissible limit is 5.0 MB
</code></pre></div><blockquote><p>æ³¨æ„ å¦‚æœæœªåœ¨è·¯ç”±å®šä¹‰ä¸­ä½œä¸ºfilterå‚æ•°æä¾›ï¼Œåˆ™é»˜è®¤è¯·æ±‚å¤§å°å°†è®¾ç½®ä¸º5 MBã€‚</p></blockquote> <h2 id="_5-23-modify-request-body-gatewayfilter-factory"><a href="#_5-23-modify-request-body-gatewayfilter-factory" class="header-anchor">#</a> 5.23 Modify Request Body GatewayFilter Factory</h2> <p>è¿™ä¸ªè¿‡æ»¤å™¨è¢«å®šä¹‰ä¸ºbetaç‰ˆæœ¬ï¼Œå°†æ¥APIå¯èƒ½ä¼šæ”¹å˜ã€‚</p> <p>æ­¤è¿‡æ»¤å™¨å¯ç”¨äºåœ¨è¯·æ±‚ä¸»ä½“è¢«ç½‘å…³å‘é€åˆ°ä¸‹æ¸¸ä¹‹å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p> <blockquote><p>æ³¨æ„ åªèƒ½ä½¿ç”¨Java DSLé…ç½®æ­¤è¿‡æ»¤å™¨</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
public RouteLocator routes(RouteLocatorBuilder builder) <span class="token punctuation">{</span>
    return builder.routes()
        .route(&quot;rewrite_request_obj&quot;<span class="token punctuation">,</span> r <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> r.host(&quot;<span class="token important">*.rewriterequestobj.org&quot;)</span>
            .filters(f <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> f.prefixPath(&quot;/httpbin&quot;)
                .modifyRequestBody(String.class<span class="token punctuation">,</span> Hello.class<span class="token punctuation">,</span> MediaType.APPLICATION_JSON_VALUE<span class="token punctuation">,</span>
                    (exchange<span class="token punctuation">,</span> s) <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> return Mono.just(new Hello(s.toUpperCase())))).uri(uri))
        .build();
<span class="token punctuation">}</span>

static class Hello <span class="token punctuation">{</span>
    String message;

    public Hello() <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    public Hello(String message) <span class="token punctuation">{</span>
        this.message = message;
    <span class="token punctuation">}</span>

    public String getMessage() <span class="token punctuation">{</span>
        return message;
    <span class="token punctuation">}</span>

    public void setMessage(String message) <span class="token punctuation">{</span>
        this.message = message;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-24-modify-response-body-gatewayfilter-factory"><a href="#_5-24-modify-response-body-gatewayfilter-factory" class="header-anchor">#</a> 5.24 Modify Response Body GatewayFilter Factory</h2> <p>è¿™ä¸ªè¿‡æ»¤å™¨è¢«å®šä¹‰ä¸ºbetaç‰ˆæœ¬ï¼Œå°†æ¥APIå¯èƒ½ä¼šæ”¹å˜ã€‚ æ­¤è¿‡æ»¤å™¨å¯ç”¨äºåœ¨å°†å“åº”æ­£æ–‡å‘é€å›å®¢æˆ·ç«¯ä¹‹å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p> <blockquote><p>æ³¨æ„ åªèƒ½ä½¿ç”¨Java DSLé…ç½®æ­¤è¿‡æ»¤å™¨</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
public RouteLocator routes(RouteLocatorBuilder builder) <span class="token punctuation">{</span>
    return builder.routes()
        .route(&quot;rewrite_response_upper&quot;<span class="token punctuation">,</span> r <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> r.host(&quot;<span class="token important">*.rewriteresponseupper.org&quot;)</span>
            .filters(f <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> f.prefixPath(&quot;/httpbin&quot;)
                .modifyResponseBody(String.class<span class="token punctuation">,</span> String.class<span class="token punctuation">,</span>
                    (exchange<span class="token punctuation">,</span> s) <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Mono.just(s.toUpperCase()))).uri(uri)
        .build();
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_6-global-filters"><a href="#_6-global-filters" class="header-anchor">#</a> 6. Global Filters</h1> <p><code>GlobalFilter</code>æ¥å£ä¸<code>GatewayFilter</code>å…·æœ‰ç›¸åŒçš„ç­¾åã€‚æ˜¯æœ‰æ¡ä»¶åœ°åº”ç”¨äºæ‰€æœ‰è·¯ç”±çš„ç‰¹æ®Šè¿‡æ»¤å™¨ã€‚ï¼ˆæ­¤æ¥å£å’Œç”¨æ³•å¯èƒ½åœ¨å°†æ¥çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ä¸­å‘ç”Ÿæ›´æ”¹ï¼‰ã€‚</p> <h2 id="_6-1-å…¨å±€filterå’Œgatewayfilterç»„åˆæ’åº"><a href="#_6-1-å…¨å±€filterå’Œgatewayfilterç»„åˆæ’åº" class="header-anchor">#</a> 6.1 å…¨å±€Filterå’ŒGatewayFilterç»„åˆæ’åº</h2> <p>å½“è¯·æ±‚è¿›å…¥ï¼ˆå¹¶ä¸è·¯ç”±åŒ¹é…ï¼‰æ—¶ï¼Œç­›é€‰Web Handler ä¼šå°†<code>GlobalFilter</code>çš„æ‰€æœ‰å®ä¾‹å’Œæ‰€æœ‰çš„<code>GatewayFilter</code>è·¯ç”±ç‰¹å®šå®ä¾‹æ·»åŠ åˆ° filter chainã€‚filterç»„åˆçš„æ’åºç”±<code>org.springframework.core.Ordered</code>æ¥å£å†³å®šï¼Œå¯ä»¥é€šè¿‡å®ç°<code>getOrde()</code>æ–¹æ³•æˆ–ä½¿ç”¨<code>@Order</code>æ³¨é‡Šæ¥è®¾ç½®ã€‚</p> <p>ç”±äºSpring Cloud Gatewayå°†ç”¨äºæ‰§è¡Œè¿‡æ»¤å™¨é€»è¾‘åŒºåˆ†ä¸ºâ€œå‰ç½®â€å’Œâ€œåç½®â€é˜¶æ®µï¼Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿‡æ»¤å™¨å°†æ˜¯â€œå‰ç½®â€é˜¶æ®µçš„ç¬¬ä¸€ä¸ªï¼Œè€Œâ€œåç½®â€é˜¶æ®µçš„æœ€åä¸€ä¸ªã€‚</p> <p><strong>ExampleConfiguration.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;first pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;third post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;second pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;second post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;third pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;first post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-2-forward-routing-filter"><a href="#_6-2-forward-routing-filter" class="header-anchor">#</a> 6.2 Forward Routing Filter</h2> <p><code>ForwardRoutingFilter</code>åœ¨exchangeå±æ€§<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>ä¸­æŸ¥æ‰¾URIã€‚å¦‚æœURLæœ‰ä¸€ä¸ª<code>forward</code>scheme (å¦‚ <code>forward:///localendpoint</code>)ï¼Œå®ƒå°†ä½¿ç”¨Spring <code>DispatcherHandler</code> æ¥å¤„ç†è¯·æ±‚ã€‚è¯·æ±‚URLçš„è·¯å¾„éƒ¨åˆ†å°†è¢«è½¬å‘URLä¸­çš„è·¯å¾„è¦†ç›–ã€‚æœªä¿®æ”¹çš„åŸå§‹URLå°†é™„åŠ åˆ° <code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR</code>å±æ€§ä¸­çš„åˆ—è¡¨ä¸­ã€‚</p> <h2 id="_6-3-loadbalancerclient-filter"><a href="#_6-3-loadbalancerclient-filter" class="header-anchor">#</a> 6.3 LoadBalancerClient Filter</h2> <p><code>LoadBalancerClientFilter</code>åœ¨exchangeå±æ€§<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>ä¸­æŸ¥æ‰¾URIã€‚å¦‚æœURLæœ‰ä¸€ä¸ª<code>lb</code>scheme (å¦‚ <code>lb://myservice</code>ï¼‰ï¼Œå®ƒå°†ä½¿ç”¨Spring Cloud <code>LoadBalancerClient</code> å°†åç§°ï¼ˆåœ¨å‰ä¸€ä¸ªç¤ºä¾‹ä¸­ä¸º'myservice<code>ï¼‰è§£æä¸ºå®é™…ä¸»æœºå’Œç«¯å£ï¼Œå¹¶æ›¿æ¢URIã€‚æœªä¿®æ”¹çš„åŸå§‹URLå°†é™„åŠ åˆ°</code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR<code>å±æ€§ä¸­çš„åˆ—è¡¨ä¸­ã€‚è¿‡æ»¤å™¨è¿˜å°†æŸ¥çœ‹</code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR<code>å±æ€§ï¼ŒæŸ¥çœ‹å®ƒæ˜¯å¦ç­‰äº</code>lb`ï¼Œç„¶ååº”ç”¨ç›¸åŒçš„è§„åˆ™ã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myRoute
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//service
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/service/<span class="token important">**</span>
</code></pre></div><blockquote><p>æ³¨æ„ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡å®ä¾‹åœ¨<code>LoadBalancer</code> ä¸­æ²¡æœ‰å‘ç°ï¼Œåˆ™è¿”å›503ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>spring.cloud.gateway.loadbalancer.use404=true</code>æ¥è®©ç½‘ç®¡è¿”å›404.</p> <p>æ³¨æ„</p></blockquote> <p>ä»<code>LoadBalancer</code>è¿”å›çš„<code>ServiceInstance</code>çš„<code>isSecure</code> å€¼å°†è¦†ç›–åœ¨å¯¹ç½‘å…³å‘å‡ºçš„è¯·æ±‚ä¸­æŒ‡å®šçš„schemeã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯·æ±‚é€šè¿‡<code>HTTPS</code>è¿›å…¥ç½‘å…³ï¼Œä½†<code>ServiceInstance</code>è¡¨ç¤ºå®ƒä¸å®‰å…¨ï¼Œåˆ™ä¸‹æ¸¸è¯·æ±‚å°†é€šè¿‡<code>HTTP</code>åè®®ã€‚ç›¸åçš„æƒ…å†µä¹Ÿé€‚ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç½‘å…³é…ç½®ä¸­ä¸ºè·¯ç”±æŒ‡å®šäº†<code>GATEWAY_SCHEME_PREFIX_ATTR</code>ï¼Œåˆ™å‰ç¼€å°†è¢«åˆ é™¤ï¼Œå¹¶ä¸”è·¯ç”±URLç”Ÿæˆçš„schemeå°†è¦†ç›–<code>ServiceInstance</code>é…ç½®ã€‚</p> <h2 id="_6-4-netty-routing-filter"><a href="#_6-4-netty-routing-filter" class="header-anchor">#</a> 6.4 Netty Routing Filter</h2> <p>å¦‚æœä½äº <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>å±æ€§ä¸­çš„URLå…·æœ‰<code>http</code> æˆ–<code>https</code> æ¨¡å¼ï¼Œåˆ™ä¼šè¿è¡ŒNetty Routing Filterã€‚å®ƒä½¿ç”¨Netty <code>HttpClient</code> å‘å‡ºä¸‹æ¸¸ä»£ç†è¯·æ±‚ã€‚å“åº”æ”¾åœ¨ <code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchangeå±æ€§ä¸­ï¼Œä»¥ä¾¿åœ¨ä»¥åçš„è¿‡æ»¤å™¨ä¸­ä½¿ç”¨ã€‚ï¼ˆæœ‰ä¸€ä¸ªå®éªŒé˜¶æ®µä¸éœ€è¦Nettyçš„ç›¸åŒçš„åŠŸèƒ½çš„Filterï¼Œ<code>WebClientHttpRoutingFilter</code>ï¼‰</p> <h2 id="_6-5-netty-write-response-filter"><a href="#_6-5-netty-write-response-filter" class="header-anchor">#</a> 6.5 Netty Write Response Filter</h2> <p>å¦‚æœ<code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchangeå±æ€§ä¸­å­˜åœ¨ Netty <code>HttpClientResponse</code>ï¼Œåˆ™è¿è¡Œ <code>NettyWriteResponseFilter</code> ã€‚å®ƒåœ¨å…¶ä»–æ‰€æœ‰è¿‡æ»¤å™¨å®Œæˆåå°†ä»£ç†å“åº”å†™å›ç½‘å…³å®¢æˆ·ç«¯å“åº”ä¹‹åè¿è¡Œã€‚ï¼ˆæœ‰ä¸€ä¸ªä¸éœ€è¦nettyçš„å®éªŒæ€§çš„<code>WebClientWriteResponseFilter</code>æ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ï¼‰</p> <h2 id="_6-6-routetorequesturl-filter"><a href="#_6-6-routetorequesturl-filter" class="header-anchor">#</a> 6.6 RouteToRequestUrl Filter</h2> <p>å¦‚æœ<code>ServerWebExchangeUtils.GATEWAY_ROUTE_ATTR</code> exchangeå±æ€§ä¸­å­˜åœ¨<code>Route</code>å¯¹è±¡ï¼Œ<code>RouteToRequestUrlFilter</code>å°†è¿è¡Œã€‚å®ƒåŸºäºè¯·æ±‚URIåˆ›å»ºä¸€ä¸ªæ–°çš„URIï¼Œä½¿ç”¨<code>Route</code>å¯¹è±¡çš„uriå±æ€§è¿›è¡Œæ›´æ–°ã€‚æ–°çš„URIè¢«æ”¾ç½®åœ¨<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code> exchangeå±æ€§ä¸­ã€‚</p> <p>å¦‚æœè¯¥URIæœ‰ä¸€ä¸ªå‰ç¼€schemeï¼Œä¾‹å¦‚<code>lb:ws://serviceid</code>ï¼Œåˆ™ä¼šä»è¯¥URIä¸­å‰¥ç¦»è¯¥ <code>lb</code> schemeï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨<code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR</code>ä¸­ï¼Œä»¥ä¾¿ç¨ååœ¨è¿‡æ»¤å™¨é“¾ä¸­ä½¿ç”¨ã€‚</p> <h2 id="_6-7-websocket-routing-filter"><a href="#_6-7-websocket-routing-filter" class="header-anchor">#</a> 6.7 Websocket Routing Filter</h2> <p>å¦‚æœ<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>exchangeå±æ€§ä¸­æœ‰ <code>ws</code> ã€ <code>wss</code>schemeï¼Œåˆ™Websocket Routing Filterå°†è¢«è¿è¡Œã€‚å®ƒä½¿ç”¨Spring Web SocketåŸºç¡€æ¨¡å—å°†Websocketè½¬å‘åˆ°ä¸‹æ¸¸ã€‚</p> <p>URIå‰ç¼€ä¸º<code>lb</code>çš„Websocketså¯ä»¥è¢«è´Ÿè½½å‡è¡¡ï¼Œå¦‚ <code>lb:ws://serviceid</code>.</p> <blockquote><p>æ³¨æ„ å¦‚æœä½¿ç”¨ <a href="https://github.com/sockjs" target="_blank" rel="noopener noreferrer">SockJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä½œä¸ºæ™®é€šHTTPçš„fallbackï¼Œåˆ™åº”é…ç½®æ™®é€šHTTPè·¯ç”±ä»¥åŠWebSocketè·¯ç”±ã€‚</p></blockquote> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token comment"># SockJS route</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_sockjs_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/websocket/info/<span class="token important">**</span>
      <span class="token comment"># Normwal Websocket route</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/websocket/<span class="token important">**</span>
</code></pre></div><h2 id="_6-8-gateway-metrics-filter"><a href="#_6-8-gateway-metrics-filter" class="header-anchor">#</a> 6.8 Gateway Metrics Filter</h2> <p>è¦å¯ç”¨ç½‘å…³æŒ‡æ ‡ï¼Œè¯·å°†spring-boot-starter-actuatoræ·»åŠ ä¸ºé¡¹ç›®ä¾èµ–é¡¹ã€‚ç„¶åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦å±æ€§<code>spring.cloud.gateway.metrics.enabled</code>æœªè®¾ç½®ä¸º<code>false</code>ï¼Œç½‘å…³æŒ‡æ ‡è¿‡æ»¤å™¨å°±ä¼šè¿è¡Œã€‚æ­¤è¿‡æ»¤å™¨æ·»åŠ åä¸ºâ€œgateway.requestsâ€çš„è®¡æ—¶å™¨æŒ‡æ ‡ï¼Œå¹¶å¸¦æœ‰ä»¥ä¸‹æ ‡è®°ï¼š</p> <ul><li><code>routeId</code>: The route id</li> <li><code>routeUri</code>:  API å°†è¢«è½¬å‘çš„URI</li> <li><code>outcome</code>: ç»“æœåˆ†ç±»ä¾æ® <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.Series.html" target="_blank" rel="noopener noreferrer">HttpStatus.Series<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>status</code>: è¿”å›clientçš„è¯·æ±‚çš„Http Status</li></ul> <p>è¿™äº›æŒ‡æ ‡å¯ä»¥ä»<code>/actuator/metrics/gateway.requests</code>ä¸­è·å–ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸Prometheusé›†æˆä»¥åˆ›å»º<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/images/gateway-grafana-dashboard.jpeg" target="_blank" rel="noopener noreferrer">Grafana<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/gateway-grafana-dashboard.json" target="_blank" rel="noopener noreferrer">dashboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>æ³¨æ„ è¦å°†pometheuså¯ç”¨ï¼Œéœ€è¦æ·»åŠ  micrometer-registry-prometheusä¸ºé¡¹ç›®ä¾èµ–ã€‚</p></blockquote> <h2 id="_6-9-making-an-exchange-as-routed"><a href="#_6-9-making-an-exchange-as-routed" class="header-anchor">#</a> 6.9 Making An Exchange As Routed</h2> <p>ç½‘å…³è·¯ç”±<code>ServerWebExchange</code>ä¹‹åï¼Œå®ƒå°†é€šè¿‡å‘Exchangeå±æ€§æ·»åŠ <code>gatewayAlreadyRouted</code>ï¼Œå°†è¯¥exchangeæ ‡è®°ä¸ºâ€œroutedâ€ã€‚ä¸€æ—¦ä¸€ä¸ªè¯·æ±‚è¢«æ ‡è®°ä¸ºroutedï¼Œå…¶ä»–è·¯ç”±è¿‡æ»¤å™¨å°†ä¸ä¼šå†æ¬¡è·¯ç”±è¯¥è¯·æ±‚ï¼Œå°†è·³è¿‡è¯¥è¿‡æ»¤å™¨ã€‚æœ‰ä¸€äº›æ–¹ä¾¿çš„æ–¹æ³•å¯ä»¥ç”¨æ¥å°†exchangeæ ‡è®°ä¸ºroutedï¼Œæˆ–è€…æ£€æŸ¥exchangeæ˜¯å¦å·²ç»routedã€‚</p> <ul><li><code>ServerWebExchangeUtils.isAlreadyRouted</code> æœ‰ä¸€ä¸ª <code>ServerWebExchange</code>å¯¹è±¡å¹¶æ£€æŸ¥å®ƒæ˜¯å¦å·²&quot;routed&quot;</li> <li><code>ServerWebExchangeUtils.setAlreadyRouted</code> æœ‰ä¸€ä¸ª <code>ServerWebExchange</code> å¯¹è±¡å¹¶å°†å…¶æ ‡è®°ä¸º&quot;routed&quot;</li></ul> <h1 id="_7-tls-ssl"><a href="#_7-tls-ssl" class="header-anchor">#</a> 7. TLS / SSL</h1> <p>ç½‘å…³å¯ä»¥é€šè¿‡å¸¸è§„çš„ Spring server configuration æ¥ä¾¦å¬HTTPSä¸Šçš„è¯·æ±‚ã€‚ä¾‹å­ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">key-alias</span><span class="token punctuation">:</span> scg
    <span class="token key atrule">key-store-password</span><span class="token punctuation">:</span> scg1234
    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>scg<span class="token punctuation">-</span>keystore.p12
    <span class="token key atrule">key-store-type</span><span class="token punctuation">:</span> PKCS12
</code></pre></div><p>ç½‘å…³è·¯ç”±å¯ä»¥è·¯ç”±åˆ°HTTPå’ŒHTTPSåç«¯ã€‚å¦‚æœè·¯ç”±åˆ°HTTPSåç«¯ï¼Œåˆ™å¯ä»¥å°†ç½‘å…³é…ç½®ä¸ºä¿¡ä»»æ‰€æœ‰å…·æœ‰è¯ä¹¦çš„ä¸‹æ¸¸æœåŠ¡ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">useInsecureTrustManager</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸å®‰å…¨çš„ä¿¡ä»»ç®¡ç†å™¨ã€‚å¯¹äºç”Ÿäº§éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç»„å·²çŸ¥è¯ä¹¦é…ç½®ç½‘å…³ï¼Œè¿™äº›è¯ä¹¦å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">trustedX509Certificates</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> cert1.pem
          <span class="token punctuation">-</span> cert2.pem
</code></pre></div><p>å¦‚æœSpring Cloud Gatewayæœªé…ç½®å—ä¿¡ä»»è¯ä¹¦ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ä¿¡ä»»åº“ï¼ˆå¯ä»¥ä½¿ç”¨ç³»ç»Ÿå±æ€§javax.net.ssl.trustStoreè¦†ç›–ï¼‰ã€‚</p> <h2 id="_7-1-tls-æ¡æ‰‹"><a href="#_7-1-tls-æ¡æ‰‹" class="header-anchor">#</a> 7.1 TLS æ¡æ‰‹</h2> <p>ç½‘å…³ç»´æŠ¤ä¸€ä¸ªç”¨äºè·¯ç”±åˆ°åç«¯çš„clientæ± ã€‚å½“é€šè¿‡HTTPSé€šä¿¡æ—¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨ä¸€ä¸ªTLSæ¡æ‰‹ï¼Œå…¶ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šè¶…æ—¶ã€‚è¿™äº›è¶…æ—¶å¯ä»¥è¿™æ ·é…ç½®ï¼ˆæ˜¾ç¤ºé»˜è®¤å€¼ï¼‰ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">handshake-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">10000</span>
          <span class="token key atrule">close-notify-flush-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">3000</span>
          <span class="token key atrule">close-notify-read-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre></div><h1 id="_8-configuration"><a href="#_8-configuration" class="header-anchor">#</a> 8. Configuration</h1> <p>Spring Cloud Gatewayçš„é…ç½®ç”±<code>RouteDefinitionLocator</code>çš„é›†åˆé©±åŠ¨ã€‚</p> <p><strong>RouteDefinitionLocator.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RouteDefinitionLocator</span> <span class="token punctuation">{</span>
    <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RouteDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRouteDefinitions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>PropertiesRouteDefinitionLocator</code>ä½¿ç”¨Spring Bootçš„<code>@ConfigurationProperties</code>æœºåˆ¶åŠ è½½å±æ€§ã€‚</p> <p>ä»¥ä¸‹ä¸¤ä¸ªç¤ºä¾‹æ˜¯ç­‰æ•ˆçš„ï¼š</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatus_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SetStatus
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token number">401</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusshortcut_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=401
</code></pre></div><p>å¯¹äºç½‘å…³çš„å¤§éƒ¨åˆ†ç”¨æ³•ï¼Œé…ç½®æ–‡ä»¶æ–¹å¼æ˜¯å¤Ÿç”¨çš„ï¼Œä½†ä¸€äº›ç”Ÿäº§ç”¨ä¾‹æ›´å»ºè®®ä»å¤–éƒ¨æºï¼ˆå¦‚æ•°æ®åº“ï¼‰åŠ è½½é…ç½®ã€‚æœªæ¥çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬å°†æœ‰åŸºäºSpring Data Repositories ï¼ˆå¦‚Redisã€<a href="https://cloud.tencent.com/product/mongodb?from=10680" target="_blank" rel="noopener noreferrer">MongoDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å’ŒCassandraï¼‰çš„<code>RouteDefinitionLocator</code>å®ç°ã€‚</p> <h2 id="_8-1-fluent-java-routes-api"><a href="#_8-1-fluent-java-routes-api" class="header-anchor">#</a> 8.1 Fluent Java Routes API</h2> <p>ä¸ºäº†å¯ä»¥æ›´ç®€å•åœ¨Javaä¸­é…ç½®ï¼Œåœ¨<code>RouteLocatorBuilder</code> beanä¸­å®šä¹‰äº†ä¸€ä¸ªfluent APIã€‚</p> <p><strong>GatewaySampleApplication.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// static imports from GatewayFilters and RoutePredicates</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">,</span> <span class="token class-name">ThrottleGatewayFilterFactory</span> throttle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.abc.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/png&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span>
                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-TestHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/webp&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span>
                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-AnotherHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.throttle.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>throttle<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token number">10</span><span class="token punctuation">,</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ç§æ ·å¼è¿˜å…è®¸ä½¿ç”¨æ›´å¤šçš„è‡ªå®šä¹‰æ–­è¨€ã€‚ç”±<code>RouteDefinitionLocator</code> beanså®šä¹‰çš„æ–­è¨€ä½¿ç”¨é€»è¾‘ <code>and</code>ç»„åˆã€‚é€šè¿‡ä½¿ç”¨fluent Java APIï¼Œå¯ä»¥åœ¨ <code>Predicate</code>ç±»ä¸Šä½¿ç”¨ <code>and()</code>ã€<code>or()</code> ã€ <code>negate()</code>è¿ç®—ç¬¦ã€‚</p> <h2 id="_8-2-discoveryclient-route-definition-locator"><a href="#_8-2-discoveryclient-route-definition-locator" class="header-anchor">#</a> 8.2 DiscoveryClient Route Definition Locator</h2> <p>å¯ä»¥å°†ç½‘å…³é…ç½®ä¸ºåŸºäºä½¿ç”¨å…¼å®¹<code>DiscoveryClient</code>æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„æœåŠ¡æ¥åˆ›å»ºè·¯ç”±ã€‚</p> <p>è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·è®¾ç½®<code>spring.cloud.gateway.discovery.locator.enabled=true</code>ï¼Œå¹¶ç¡®ä¿<code>DiscoveryClient</code>å®ç°ä½äºclasspathä¸Šå¹¶å·²å¯ç”¨ï¼ˆå¦‚netflix eurekaã€consulæˆ–zookeeperï¼‰ã€‚</p> <h3 id="_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes"><a href="#_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes" class="header-anchor">#</a> 8.2.1 Configuring Predicates and Filters For DiscoveryClient Routes</h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘å…³ä¸ºé€šè¿‡<code>DiscoveryClient</code>åˆ›å»ºçš„è·¯ç”±å®šä¹‰å•ä¸ªæ–­è¨€å’Œè¿‡æ»¤å™¨ã€‚</p> <p>é»˜è®¤æ–­è¨€æ˜¯ä½¿ç”¨<code>/serviceId/**</code>å®šä¹‰çš„pathæ–­è¨€ï¼Œå…¶ä¸­<code>serviceId</code>æ˜¯<code>DiscoveryClient</code>ä¸­æœåŠ¡çš„IDã€‚</p> <p>é»˜è®¤è¿‡æ»¤å™¨æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>/serviceId/(?&lt;remaining&gt;.*)</code>å’Œæ›¿æ¢çš„<code>/${remaining}</code>è¿›è¡Œé‡å†™ã€‚è¿™åªæ˜¯åœ¨è¯·æ±‚è¢«å‘é€åˆ°ä¸‹æ¸¸ä¹‹å‰ä»è·¯å¾„ä¸­æˆªå–æ‰ service id ã€‚</p> <p>å¯ä»¥é€šè¿‡è®¾ç½®<code>spring.cloud.gateway.discovery.locator.predicates[x]</code> and <code>spring.cloud.gateway.discovery.locator.filters[y]</code>æ¥å®ç°è‡ªå®šä¹‰<code>DiscoveryClient</code>è·¯ç”±ä½¿ç”¨çš„æ–­è¨€and/orè¿‡æ»¤å™¨ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œå¦‚æœä½ æƒ³è¦ä¿ç•™è¿™ä¸ªåŠŸèƒ½ï¼Œä½ éœ€è¦ç¡®ä¿åŒ…æ‹¬ä¸Šé¢çš„é»˜è®¤æ–­è¨€å’Œè¿‡æ»¤å™¨ã€‚ä¸‹é¢æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚</p> <p><strong>application.properties.</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[0].name</span><span class="token punctuation">:</span> <span class="token attr-value">Path</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[0].args[pattern]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/'+serviceId+'/**'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[1].name</span><span class="token punctuation">:</span> <span class="token attr-value">Host</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[1].args[pattern]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'**.foo.com'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[0].name</span><span class="token punctuation">:</span> <span class="token attr-value">Hystrix</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[0].args[name]</span><span class="token punctuation">:</span> <span class="token attr-value">serviceId</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].name</span><span class="token punctuation">:</span> <span class="token attr-value">RewritePath</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].args[regexp]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/' + serviceId + '/(?&lt;remaining&gt;.*)'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].args[replacement]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/${remaining}'&quot;</span>
</code></pre></div><h1 id="_9-reactor-netty-access-logs"><a href="#_9-reactor-netty-access-logs" class="header-anchor">#</a> 9. Reactor Netty Access Logs</h1> <p>è®¾ç½® <code>-Dreactor.netty.http.server.accessLogEnabled=true</code> æ¥å¼€å¯Reactor Netty access logsï¼Œæ³¨æ„å¿…é¡»æ˜¯Java System Propertyè€Œä¸æ˜¯Spring Boot propertyã€‚</p> <p>logging æ¨¡å—ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®å•ç‹¬è¾“å‡ºä¸€ä¸ªaccess logæ–‡ä»¶ï¼Œä¸‹é¢æ˜¯logbackçš„é…ç½®ä¾‹å­ï¼š</p> <p><strong>logback.xml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code> &lt;appender name=&quot;accessLog&quot; class=&quot;ch.qos.logback.core.FileAppender&quot;<span class="token punctuation">&gt;</span>
        &lt;file<span class="token punctuation">&gt;</span>access_log.log&lt;/file<span class="token punctuation">&gt;</span>
        &lt;encoder<span class="token punctuation">&gt;</span>
            &lt;pattern<span class="token punctuation">&gt;</span>%msg%n&lt;/pattern<span class="token punctuation">&gt;</span>
        &lt;/encoder<span class="token punctuation">&gt;</span>
    &lt;/appender<span class="token punctuation">&gt;</span>
    &lt;appender name=&quot;async&quot; class=&quot;ch.qos.logback.classic.AsyncAppender&quot;<span class="token punctuation">&gt;</span>
        &lt;appender<span class="token punctuation">-</span>ref ref=&quot;accessLog&quot; /<span class="token punctuation">&gt;</span>
    &lt;/appender<span class="token punctuation">&gt;</span>

    &lt;logger name=&quot;reactor.netty.http.server.AccessLog&quot; level=&quot;INFO&quot; additivity=&quot;false&quot;<span class="token punctuation">&gt;</span>
        &lt;appender<span class="token punctuation">-</span>ref ref=&quot;async&quot;/<span class="token punctuation">&gt;</span>
    &lt;/logger<span class="token punctuation">&gt;</span>
</code></pre></div><h1 id="_10-cors-configuration"><a href="#_10-cors-configuration" class="header-anchor">#</a> 10. CORS Configuration</h1> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®ç½‘å…³æ¥æ§åˆ¶CORSè¡Œä¸ºï¼Œå…¨å±€CORSé…ç½®æ˜¯ <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" target="_blank" rel="noopener noreferrer">Spring Framework <code>CorsConfiguration</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¨¡å¼çš„URL MAPã€‚</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;http://docs.spring.io&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> GET
</code></pre></div><p>ä¾‹å­ä¸­å°†å…è®¸ä»docs.spring.ioå‘å‡ºçš„æ‰€æœ‰GETè¯·æ±‚è¿›è¡ŒCORSè¯·æ±‚ã€‚</p> <h1 id="_11-actuator-api"><a href="#_11-actuator-api" class="header-anchor">#</a> 11. Actuator API</h1> <p><code>/gateway</code>çš„actuatorç«¯ç‚¹å…è®¸ç›‘è§†Spring Cloud Gatewayåº”ç”¨ç¨‹åºå¹¶ä¸ä¹‹äº¤äº’ã€‚è¦è¿›è¡Œè¿œç¨‹è®¿é—®ï¼Œå¿…é¡»åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­æš´éœ²HTTPæˆ–JMX ç«¯å£ã€‚</p> <p><strong>application.properties.</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">management.endpoint.gateway.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true # default value</span>
<span class="token attr-name">management.endpoints.web.exposure.include</span><span class="token punctuation">=</span><span class="token attr-value">gateway</span>
</code></pre></div><h2 id="_11-1-retrieving-route-filters"><a href="#_11-1-retrieving-route-filters" class="header-anchor">#</a> 11.1 Retrieving route filters</h2> <h3 id="_11-1-1-global-filters"><a href="#_11-1-1-global-filters" class="header-anchor">#</a> 11.1.1 Global Filters</h3> <p>è¦æ£€ç´¢åº”ç”¨äºæ‰€æœ‰è·¯ç”±çš„ [global filters]ï¼Œè¯·getè¯·æ±‚ <code>/actuator/gateway/globalfilters</code>ã€‚è¿”å›çš„ç»“æœç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5&quot;</span><span class="token operator">:</span> <span class="token number">10100</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@4f6fd101&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@32d22650&quot;</span><span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.ForwardRoutingFilter@106459d9&quot;</span><span class="token operator">:</span> <span class="token number">2147483647</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.NettyRoutingFilter@1fbd5e0&quot;</span><span class="token operator">:</span> <span class="token number">2147483647</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.ForwardPathFilter@33a71d23&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@135064ea&quot;</span><span class="token operator">:</span> <span class="token number">2147483637</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@23c05889&quot;</span><span class="token operator">:</span> <span class="token number">2147483646</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿”å›ç»“æœåŒ…å«å·²å°±ç»ªçš„global filtersçš„è¯¦ç»†ä¿¡æ¯(å¦‚ <code>org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5</code>)ã€‚å¯¹äºæ¯ä¸ªglobal filtersï¼Œè¿”å›ç»“æœå­—ç¬¦ä¸²å¯¹åº”è¿‡æ»¤å™¨é“¾ä¸­çš„ç›¸åº”é¡ºåºã€‚</p> <h3 id="_11-1-2-route-filters"><a href="#_11-1-2-route-filters" class="header-anchor">#</a> 11.1.2 Route Filters</h3> <p>è¦æ£€ç´¢åº”ç”¨äºè·¯ç”±çš„ [GatewayFilter factories] ï¼Œè¯·getè¯·æ±‚<code>/actuator/gateway/routefilters</code>ã€‚è¿”å›ç»“æœç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;[AddRequestHeaderGatewayFilterFactory@570ed9c configClass = AbstractNameValueGatewayFilterFactory.NameValueConfig]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[SaveSessionGatewayFilterFactory@4449b273 configClass = Object]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿”å›ç»“æœåŒ…å«åº”ç”¨äºæ‰€æœ‰è·¯ç”±çš„GatewayFilterçš„è¯¦ç»†ä¿¡æ¯ã€‚æ˜¾ç¤ºæ¯ä¸ªå·¥å‚æä¾›å­—ç¬¦ä¸²æ ¼å¼çš„ç›¸åº”å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ <code>[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]</code>ï¼‰ã€‚è¯·æ³¨æ„ï¼Œ<code>null</code>å€¼æ˜¯ç”±äºendpoint controllerå®ç°ä¸å®Œæ•´é€ æˆçš„ï¼Œå› ä¸ºå®ƒå°è¯•åœ¨filter chainä¸­è®¾ç½®å¯¹è±¡çš„é¡ºåºï¼Œè¿™ä¸é€‚ç”¨äºGatewayFilterå·¥å‚å¯¹è±¡ã€‚</p> <h2 id="_11-2-refreshing-the-route-cache"><a href="#_11-2-refreshing-the-route-cache" class="header-anchor">#</a> 11.2 Refreshing the route cache</h2> <p>å¦‚æœè¦æ¸…ç†è·¯ç”±çš„ç¼“å­˜ï¼Œè¯·POSTè¯·æ±‚<code>/actuator/gateway/refresh</code>ã€‚è¯¥è¯·æ±‚å°†è¿”å›ä¸€ä¸ªæ²¡æœ‰bodyçš„200è¿”å›ç ã€‚</p> <h2 id="_11-3-retrieving-the-routes-defined-in-the-gateway"><a href="#_11-3-retrieving-the-routes-defined-in-the-gateway" class="header-anchor">#</a> 11.3 Retrieving the routes defined in the gateway</h2> <p>è¦æ£€ç´¢ç½‘å…³ä¸­å®šä¹‰çš„è·¯ç”±ï¼Œå‘é€GETè¯·æ±‚<code>/actuator/gateway/routes</code>ï¼Œè¿”å›ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;route_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;first_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;route_object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;predicate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@1e9d7e7d&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;OrderedGatewayFilter{delegate=org.springframework.cloud.gateway.filter.factory.PreserveHostHeaderGatewayFilterFactory$$Lambda$436/674480275@6631ef72, order=0}&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;route_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;second_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;route_object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;predicate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@cd8d298&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>è¿”å›ç»“æœä¸­åŒ…å«ç½‘å…³ä¸­æ‰€æœ‰å®šä¹‰çš„è·¯ç”±ä¿¡æ¯ï¼Œä¸‹é¢è¡¨æ ¼ä¸­æè¿°äº†è¿”å›ç»“æœä¿¡æ¯ï¼š</p> <table><thead><tr><th style="text-align:left;">Path</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>route_id</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The route ID.</td></tr> <tr><td style="text-align:left;"><code>route_object.predicate</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">The route predicate.</td></tr> <tr><td style="text-align:left;"><code>route_object.filters</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The <a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories" target="_blank" rel="noopener noreferrer"><code>GatewayFilter</code> factories<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> applied to the route.</td></tr> <tr><td style="text-align:left;"><code>order</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">The route order.</td></tr></tbody></table> <h2 id="_11-4-retrieving-information-about-a-particular-route"><a href="#_11-4-retrieving-information-about-a-particular-route" class="header-anchor">#</a> 11.4 Retrieving information about a particular route</h2> <p>è¦è·å–å•ä¸ªè·¯ç”±çš„ä¿¡æ¯ï¼Œå‘é€GETè¯·æ±‚ <code>/actuator/gateway/routes/{id}</code> (å¦‚ï¼š <code>/actuator/gateway/routes/first_route</code>)ï¼Œè¿”å›ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;first_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;predicates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;_genkey_0&quot;</span><span class="token operator">:</span><span class="token string">&quot;/first&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.uri-destination.org&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>ä¸‹é¢è¡¨æ ¼ä¸­æè¿°äº†è¿”å›ç»“æœä¿¡æ¯ï¼š</p> <table><thead><tr><th style="text-align:left;">Path</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>id</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The route ID.</td></tr> <tr><td style="text-align:left;"><code>predicates</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The collection of route predicates. Each item defines the name and the arguments of a given predicate.</td></tr> <tr><td style="text-align:left;"><code>filters</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The collection of filters applied to the route.</td></tr> <tr><td style="text-align:left;"><code>uri</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The destination URI of the route.</td></tr> <tr><td style="text-align:left;"><code>order</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">The route order.</td></tr></tbody></table> <h2 id="_11-5-creating-and-deleting-a-particular-route"><a href="#_11-5-creating-and-deleting-a-particular-route" class="header-anchor">#</a> 11.5 Creating and deleting a particular route</h2> <p>è¦åˆ›å»ºä¸€ä¸ªè·¯ç”±ï¼Œå‘é€POSTè¯·æ±‚ <code>/gateway/routes/{id_route_to_create}</code>ï¼Œå‚æ•°ä¸ºJSONç»“æ„ï¼Œå…·ä½“å‚æ•°æ•°æ®ç»“æ„å‚è€ƒä¸Šé¢ç« èŠ‚ã€‚</p> <p>è¦åˆ é™¤ä¸€ä¸ªè·¯ç”±ï¼Œå‘é€ <code>DELETE</code>è¯·æ±‚ <code>/gateway/routes/{id_route_to_delete}</code>ã€‚</p> <h2 id="_11-6-recap-list-of-all-endpoints"><a href="#_11-6-recap-list-of-all-endpoints" class="header-anchor">#</a> 11.6 Recap: list of all endpoints</h2> <p>ä¸‹è¡¨æ€»ç»“äº†Spring Cloud Gateway actuator endpointsã€‚æ³¨æ„ï¼Œæ¯ä¸ªendpointéƒ½æ˜¯<code>/actuator/gateway</code>ä½œä¸ºåŸºæœ¬è·¯å¾„ã€‚</p> <table><thead><tr><th style="text-align:left;">ID</th> <th style="text-align:left;">HTTP Method</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>globalfilters</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of global filters applied to the routes.</td></tr> <tr><td style="text-align:left;"><code>routefilters</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of <code>GatewayFilter</code> factories applied to a particular route.</td></tr> <tr><td style="text-align:left;"><code>refresh</code></td> <td style="text-align:left;">POST</td> <td style="text-align:left;">Clears the routes cache.</td></tr> <tr><td style="text-align:left;"><code>routes</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of routes defined in the gateway.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays information about a particular route.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">POST</td> <td style="text-align:left;">Adds a new route to the gateway.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">DELETE</td> <td style="text-align:left;">Removes an existing route from the gateway.</td></tr></tbody></table> <h1 id="_12-developer-guide"><a href="#_12-developer-guide" class="header-anchor">#</a> 12. Developer Guide</h1> <p>TODO: overview of writing custom integrations</p> <h2 id="_12-1-writing-custom-route-predicate-factories"><a href="#_12-1-writing-custom-route-predicate-factories" class="header-anchor">#</a> 12.1 Writing Custom Route Predicate Factories</h2> <p>TODO: document writing Custom Route Predicate Factories</p> <h2 id="_12-2-writing-custom-gatewayfilter-factories"><a href="#_12-2-writing-custom-gatewayfilter-factories" class="header-anchor">#</a> 12.2 Writing Custom GatewayFilter Factories</h2> <p>å¦‚æœè¦è‡ªå®šä¹‰ä¸€ä¸ªGatewayFilterï¼Œéœ€è¦å®ç°<code>GatewayFilterFactory</code>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½ éœ€è¦é›†æˆçš„æŠ½è±¡ç±» <code>AbstractGatewayFilterFactory</code>ã€‚</p> <p><strong>PreGatewayFilterFactory.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PreGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PreGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// grab configuration from Config object</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//If you want to build a &quot;pre&quot; filter you need to manipulate the</span>
            <span class="token comment">//request before calling chain.filter</span>
            <span class="token class-name">ServerHttpRequest<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//use builder to manipulate the request</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token comment">//Put the configuration properties for your filter here</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostGatewayFilterFactory.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PostGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PostGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// grab configuration from Config object</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//Manipulate the response in some way</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token comment">//Put the configuration properties for your filter here</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_12-3-writing-custom-global-filters"><a href="#_12-3-writing-custom-global-filters" class="header-anchor">#</a> 12.3 Writing Custom Global Filters</h2> <p>TODO: document writing Custom Global Filters</p> <h2 id="_12-4-writing-custom-route-locators-and-writers"><a href="#_12-4-writing-custom-route-locators-and-writers" class="header-anchor">#</a> 12.4 Writing Custom Route Locators and Writers</h2> <p>TODO: document writing Custom Route Locators and Writers</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2022/02/09, 14:16:28</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f0610e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring Cloud Gateway é…ç½®å¤§å…¨</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/f0610e/" class="prev">Spring Cloud Gateway é…ç½®å¤§å…¨</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:785056500@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/heyuqiang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2019-2022
    <span>PigxCloud, Inc.</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.31569fb0.js" defer></script><script src="/assets/js/2.df69d635.js" defer></script><script src="/assets/js/120.b2f1f2eb.js" defer></script>
  </body>
</html>
