(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{556:function(s,a,t){"use strict";t.r(a);var e=t(29),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"centos7-离线安装mongodb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos7-离线安装mongodb"}},[s._v("#")]),s._v(" CentOS7 离线安装MongoDB")]),s._v(" "),t("p",[s._v("MongoDB 提供了 linux 各个发行版本 64 位的安装包，你可以在官网下载安装包。")]),s._v(" "),t("h2",{attrs:{id:"软件版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#软件版本"}},[s._v("#")]),s._v(" 软件版本")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("依赖")]),s._v(" "),t("th",[s._v("版本")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("操作系统")]),s._v(" "),t("td",[s._v("CentOS Linux release 7.6.1810 (Core)")])]),s._v(" "),t("tr",[t("td",[s._v("MongoDB")]),s._v(" "),t("td",[s._v("4.4.2")])])])]),s._v(" "),t("h2",{attrs:{id:"安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[s._v("#")]),s._v(" 安装依赖 "),t("Badge",{attrs:{text:"非必须",type:"warning"}})],1),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libcurl openssl\n")])])]),t("h2",{attrs:{id:"源码下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#源码下载"}},[s._v("#")]),s._v(" 源码下载")]),s._v(" "),t("p",[s._v("前往"),t("a",{attrs:{href:"https://www.mongodb.com/download-center/community",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB官网"),t("OutboundLink")],1),s._v("下载所需的MongoDB版本，本次以当前最新版本"),t("code",[s._v("MongoDB 4.4.2")]),s._v("为例进行安装。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/2020-12-03_11-08-44.png",alt:"源码下载"}})]),s._v(" "),t("p",[s._v("点击"),t("code",[s._v("Download")]),s._v("按钮直接下载或使用wget下载")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.2.tgz\n")])])]),t("h2",{attrs:{id:"准备安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备安装"}},[s._v("#")]),s._v(" 准备安装")]),s._v(" "),t("p",[s._v("解压")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf mongodb-linux-x86_64-rhel70-4.4.2.tgz\n")])])]),t("p",[s._v("将解压包拷贝到指定目录")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" mongodb-linux-x86_64-rhel70-4.4.2 /usr/local/mongodb\n")])])]),t("p",[s._v("MongoDB 的可执行文件位于 bin 目录下，所以可以将其添加到 PATH 路径中：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export PATH=/usr/local/mongodb/bin:$PATH'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/profile  \n")])])]),t("p",[s._v("更新")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])])]),t("h2",{attrs:{id:"创建数据目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建数据目录"}},[s._v("#")]),s._v(" 创建数据目录")]),s._v(" "),t("p",[s._v("建立data文件夹，用于存放数据文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/mongodb/data/db\n")])])]),t("p",[s._v("建立logs文件夹，用于存放日志文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/mongodb/logs\n")])])]),t("p",[s._v("建立conf文件夹，用于存放配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/mongodb/conf\n")])])]),t("h2",{attrs:{id:"配置mongodb-conf文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置mongodb-conf文件"}},[s._v("#")]),s._v(" 配置"),t("code",[s._v("mongodb.conf")]),s._v("文件")]),s._v(" "),t("p",[s._v("进入conf目录，执行如下命令建立配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/local/mongodb/conf/mongodb.conf\n")])])]),t("p",[s._v("添加如下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("port=27017\ndbpath=/usr/local/mongodb/data/db\nlogpath=/usr/local/mongodb/logs/mongodb.log\nfork=true\nauth=true\nbind_ip = 0.0.0.0\n")])])]),t("p",[t("code",[s._v("mongodb.conf")]),s._v("文件描述如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("名称")]),s._v(" "),t("th",[s._v("描述")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("port")]),s._v(" "),t("td",[s._v("监听的端口")])]),s._v(" "),t("tr",[t("td",[s._v("dbpath")]),s._v(" "),t("td",[s._v("数据存放路径")])]),s._v(" "),t("tr",[t("td",[s._v("logpath")]),s._v(" "),t("td",[s._v("日志存放路径")])]),s._v(" "),t("tr",[t("td",[s._v("fork")]),s._v(" "),t("td",[s._v("是否启用后台运行 1. true启用后台运行 2. false禁止后台运行")])]),s._v(" "),t("tr",[t("td",[s._v("auth")]),s._v(" "),t("td",[s._v("是否需要验证登录权限登录（是否需要用户名密码）")])]),s._v(" "),t("tr",[t("td",[s._v("bind_ip")]),s._v(" "),t("td",[s._v("绑定IP地址，可以写成本机的IP也可以写成"),t("code",[s._v("0.0.0.0")]),s._v("，写成"),t("code",[s._v("0.0.0.0")]),s._v("的话就会监听所有的地址")])])])]),s._v(" "),t("h2",{attrs:{id:"配置开机自启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置开机自启动"}},[s._v("#")]),s._v(" 配置开机自启动")]),s._v(" "),t("p",[s._v("创建"),t("code",[s._v("mongodb.service")]),s._v("文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /lib/systemd/system/mongodb.service\n")])])]),t("p",[s._v("添加如下内容：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[Unit]\n \nDescription=mongodb\nAfter=network.target remote-fs.target nss-lookup.target\n \n[Service]\nType=forking\nExecStart=/usr/local/mongodb/bin/mongod -f /usr/local/mongodb/conf/mongodb.conf\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/usr/local/mongodb/bin/mongod --shutdown -f /usr/local/mongodb/conf/mongodb.conf\nPrivateTmp=true\n \n[Install]\nWantedBy=multi-user.target\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("其中ExecStart参数与ExecStop参数中的路径要和安装的路径一致")])]),s._v(" "),t("p",[s._v("重新加载服务配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl daemon-reload\n")])])]),t("p",[s._v("添加至开机启动")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mongodb.service\n")])])]),t("h2",{attrs:{id:"操作命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作命令"}},[s._v("#")]),s._v(" 操作命令")]),s._v(" "),t("p",[s._v("启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl start mongodb.service\n")])])]),t("p",[s._v("停止服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl stop mongodb.service\n")])])]),t("p",[s._v("重启服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl restart mongodb.service\n")])])]),t("p",[s._v("查看服务状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("systemctl status mongodb.service\n")])])]),t("h2",{attrs:{id:"添加防火墙例外"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加防火墙例外"}},[s._v("#")]),s._v(" 添加防火墙例外")]),s._v(" "),t("p",[s._v("使用root用户执行命令 开启27017 端口")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("firewall-cmd --zone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("/tcp --permanent\n")])])]),t("p",[s._v("重新加载")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("firewall-cmd --reload\n")])])]),t("h2",{attrs:{id:"创建管理账户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建管理账户"}},[s._v("#")]),s._v(" 创建管理账户")]),s._v(" "),t("p",[s._v("直接使用mongo命令进行连接，默认端口是27017")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mongo\n")])])]),t("p",[s._v("创建验证用户, 提示"),t("code",[s._v("rootpassword")]),s._v("替换成你自己的密码")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use admin\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(",pwd:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rootpassword"')]),s._v(",roles:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("role:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root"')]),s._v(",db:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("登录验证，提示"),t("code",[s._v("rootpassword")]),s._v("替换成你自己的密码")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mongo -u root -p rootpassword --authenticationDatabase admin\n")])])]),t("h2",{attrs:{id:"创建普通账户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建普通账户"}},[s._v("#")]),s._v(" 创建普通账户")]),s._v(" "),t("p",[s._v("使用用户管理账户登录认证，提示"),t("code",[s._v("rootpassword")]),s._v("替换成你自己的密码")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mongo\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use admin\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rootpassword'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("切换数据库（保持管理账户登录状态）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use ivoov\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("使用命令："),t("code",[s._v("use ivoov")]),s._v("切换数据库，如果数据库不存在则自动创建。")])]),s._v(" "),t("p",[s._v("建立普通账户（保持管理账户登录状态）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ivoov"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pwd"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ivoov.com"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"role"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"readWrite"')]),s._v(",\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ivoov"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("该操作创建了一个用户名为"),t("code",[s._v("ivoov")]),s._v(",密码为"),t("code",[s._v("ivoov.com")]),s._v(",所属数据库为"),t("code",[s._v("ivoovdb")]),s._v(" 并赋予"),t("strong",[s._v("读写权限")]),s._v("。")])]),s._v(" "),t("p",[s._v("普通用户登录")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" db.auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ivoov'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ivoov.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("完成")])])}),[],!1,null,null,null);a.default=r.exports}}]);