(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{672:function(t,_,v){"use strict";v.r(_);var a=v(29),i=Object(a.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"分布式认证实战"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#分布式认证实战"}},[t._v("#")]),t._v(" 分布式认证实战")]),t._v(" "),v("h2",{attrs:{id:"技术方案"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#技术方案"}},[t._v("#")]),t._v(" 技术方案")]),t._v(" "),v("p",[t._v("根据选型的分析，决定采用基于token的认证方式，它的优点是:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("适合统一认证的机制，客户端、一方应用、三方应用都遵循一致的认证机制。")])]),t._v(" "),v("li",[v("p",[t._v("token认证方式对第三方应用接入更适合，因为它更开放，可使用当前有流行的开放协议Oauth2.0、JWT等。")])]),t._v(" "),v("li",[v("p",[t._v("一般情况服务端无需存储会话信息，减轻了服务端的压力。")])])]),t._v(" "),v("p",[t._v("分布式系统认证技术方案见下图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"/img/2020-11-01_22-48-38.png",alt:"分布式系统认证技术方案"}})]),t._v(" "),v("p",[t._v("流程描述:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("(1)用户通过接入方(应用)登录，接入方采取OAuth2.0方式在统一认证服务(simplify-auth)中认证。")])]),t._v(" "),v("li",[v("p",[t._v("(2)认证服务(simplify-auth)调用验证该用户的身份是否合法，并获取用户权限信息。")])]),t._v(" "),v("li",[v("p",[t._v("(3)认证服务(simplify-auth)获取接入方权限信息，并验证接入方是否合法。")])]),t._v(" "),v("li",[v("p",[t._v("(4)若登录用户以及接入方都合法，认证服务生成jwt令牌返回给接入方，其中jwt中包含了用户权限及接入方权限。")])]),t._v(" "),v("li",[v("p",[t._v("(5)后续，接入方携带jwt令牌对API网关内的微服务资源进行访问。")])]),t._v(" "),v("li",[v("p",[t._v("(6)API网关对令牌解析、并验证接入方的权限是否能够访问本次请求的微服务。")])]),t._v(" "),v("li",[v("p",[t._v("(7)如果接入方的权限没问题，API网关将原请求header中附加解析后的明文Token，并将请求转发至微服务。")])]),t._v(" "),v("li",[v("p",[t._v("(8)微服务收到请求，明文token中包含登录用户的身份和权限信息。因此后续微服务自己可以干两件事:")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("1、用户授权拦截(看当前用户是否有权访问该资源)")])]),t._v(" "),v("li",[v("p",[t._v("2、将用户信息存储进当前线程上下文(有利于后续业务逻辑随时获取当前用户信息)")])])])])]),t._v(" "),v("p",[t._v("流程所涉及到UAA服务、API网关这三个组件职责如下:")]),t._v(" "),v("h2",{attrs:{id:"统一认证服务"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#统一认证服务"}},[t._v("#")]),t._v(" 统一认证服务")]),t._v(" "),v("p",[t._v("它承载了OAuth2.0接入方认证、登入用户的认证、授权以及生成令牌的职责，完成实际的用户认证、授权功能。")]),t._v(" "),v("h2",{attrs:{id:"api网关"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#api网关"}},[t._v("#")]),t._v(" API网关")]),t._v(" "),v("p",[t._v("作为系统的唯一入口，API网关为接入方提供定制的API集合，它可能还具有其它职责，如身份验证、监控、负载均 衡、缓存等。API网关方式的核心要点是，所有的接入方和消费端都通过统一的网关接入微服务，在网关层处理所 有的非业务功能。")])])}),[],!1,null,null,null);_.default=i.exports}}]);