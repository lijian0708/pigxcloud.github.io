(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{561:function(e,t,s){"use strict";s.r(t);var a=s(29),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"如何使用-tls-保护对-minio-服务器的访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用-tls-保护对-minio-服务器的访问"}},[e._v("#")]),e._v(" 如何使用 TLS 保护对 MinIO 服务器的访问")]),e._v(" "),s("p",[e._v("本指南解释了如何在 Linux 和 Windows 平台上使用 TLS 证书配置 MinIO Server。")]),e._v(" "),s("h2",{attrs:{id:"_1-安装minio服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装minio服务器"}},[e._v("#")]),e._v(" 1.安装MinIO服务器")]),e._v(" "),s("p",[e._v("使用"),s("RouterLink",{attrs:{to:"/12.MinIO/01.Minio服务器/"}},[e._v("MinIO 快速入门指南中")]),e._v("的说明安装 MinIO Server 。")],1),e._v(" "),s("h2",{attrs:{id:"_2-在-minio-中使用现有的密钥和证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-在-minio-中使用现有的密钥和证书"}},[e._v("#")]),e._v(" 2. 在 MinIO 中使用现有的密钥和证书")]),e._v(" "),s("p",[e._v("本节介绍如何使用从证书颁发机构 (CA) 获得的私钥和公共证书。如果尚未获取这些文件，请跳至"),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#generate-use-self-signed-keys-certificates",target:"_blank",rel:"noopener noreferrer"}},[e._v("3. 生成自签名证书"),s("OutboundLink")],1),e._v("或使用以下说明使用"),s("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Let's Encrypt"),s("OutboundLink")],1),e._v("生成它们："),s("a",{attrs:{href:"https://docs.min.io/docs/generate-let-s-encypt-certificate-using-concert-for-minio.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用 Certbot for MinIO 生成 Let's Encrypt 证书"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("将现有的私钥和公共证书复制到"),s("code",[e._v("certs")]),e._v("目录中。默认的 certs 目录是：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Linux：")]),e._v(" "),s("code",[e._v("${HOME}/.minio/certs")])]),e._v(" "),s("li",[s("strong",[e._v("视窗：")]),e._v(" "),s("code",[e._v("%%USERPROFILE%%\\.minio\\certs")])])]),e._v(" "),s("p",[s("strong",[e._v("笔记：")])]),e._v(" "),s("ul",[s("li",[e._v("可以使用"),s("code",[e._v("--certs-dir")]),e._v("命令行选项指定自定义证书目录的位置。")]),e._v(" "),s("li",[e._v("在"),s("code",[e._v("certs")]),e._v("目录中，私钥必须命名"),s("code",[e._v("private.key")]),e._v("，公钥必须命名"),s("code",[e._v("public.crt")]),e._v("。")]),e._v(" "),s("li",[e._v("由 CA 签署的证书包含有关颁发的身份（例如名称、到期时间、公钥）和任何中间证书的信息。不包括根 CA。")])]),e._v(" "),s("h2",{attrs:{id:"_3-使用-minio-生成和使用自签名密钥和证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-minio-生成和使用自签名密钥和证书"}},[e._v("#")]),e._v(" 3. 使用 MinIO 生成和使用自签名密钥和证书")]),e._v(" "),s("p",[e._v("本节介绍如何使用各种工具生成自签名证书：")]),e._v(" "),s("ul",[s("li",[e._v("3.1 "),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#using-go",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用certgen生成证书"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("3.2 "),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#using-open-ssl",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用 OpenSSL 生成证书"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("3.3 "),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#using-open-ssl-with-ip",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用OpenSSL（带IP地址）生成证书"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("3.4 "),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#using-gnu-tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用 GnuTLS (for Windows) 生成证书"),s("OutboundLink")],1)])]),e._v(" "),s("p",[s("strong",[e._v("说明：")])]),e._v(" "),s("ul",[s("li",[e._v("MinIO 在 Linux 和 Windows 上仅支持 PEM 格式的密钥和证书。")]),e._v(" "),s("li",[e._v("MinIO 目前不支持 PFX 证书。")])]),e._v(" "),s("h3",{attrs:{id:"_3-1certgen用于生成证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1certgen用于生成证书"}},[e._v("#")]),e._v(" 3.1"),s("code",[e._v("certgen")]),e._v("用于生成证书")]),e._v(" "),s("p",[e._v("下载"),s("a",{attrs:{href:"https://github.com/minio/certgen/releases/latest",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("certgen")]),s("OutboundLink")],1),e._v("适用于您的特定操作系统和平台。")]),e._v(" "),s("p",[s("code",[e._v("certgen")]),e._v("是一个简单的"),s("em",[e._v("Go")]),e._v("工具来生成自签名证书，并提供带有 DNS 和 IP 条目的 SAN 证书：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./certgen -ca -host "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"10.10.0.3,10.10.0.4,10.10.0.5"')]),e._v("\n")])])]),s("p",[e._v("应显示与此类似的响应：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("2018/11/21 10:16:18 wrote public.crt\n2018/11/21 10:16:18 wrote private.key\n")])])]),s("h3",{attrs:{id:"_3-2-使用-openssl-生成证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用-openssl-生成证书"}},[e._v("#")]),e._v(" 3.2 使用 OpenSSL 生成证书")]),e._v(" "),s("p",[e._v("使用以下方法之一生成证书"),s("code",[e._v("openssl")]),e._v("：")]),e._v(" "),s("ul",[s("li",[e._v("3.2.1"),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#generate-private-key-with-ecdsa",target:"_blank",rel:"noopener noreferrer"}},[e._v("用ECDSA生成私钥"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("3.2.2"),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#generate-private-key-with-rsa",target:"_blank",rel:"noopener noreferrer"}},[e._v("用RSA生成私钥"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("3.2.3"),s("a",{attrs:{href:"https://docs.min.io/docs/how-to-secure-access-to-minio-server-with-tls.html#generate-a-self-signed-certificate",target:"_blank",rel:"noopener noreferrer"}},[e._v("生成自签名证书"),s("OutboundLink")],1)])]),e._v(" "),s("h4",{attrs:{id:"_3-2-1-使用-ecdsa-生成私钥。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-使用-ecdsa-生成私钥。"}},[e._v("#")]),e._v(" 3.2.1 使用 ECDSA 生成私钥。")]),e._v(" "),s("p",[e._v("使用以下命令生成带有 ECDSA 的私钥：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl ecparam -genkey -name prime256v1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" openssl ec -out private.key\n")])])]),s("p",[e._v("应显示与此类似的响应：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("read EC key\nwriting EC key\n")])])]),s("p",[e._v("或者，使用以下命令生成受密码保护的私有 ECDSA 密钥：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl ecparam -genkey -name prime256v1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" openssl ec -aes256 -out private.key -passout pass:PASSWORD\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),s("p",[e._v("目前不支持 NIST 曲线 P-384 和 P-521。")])]),e._v(" "),s("h4",{attrs:{id:"_3-2-2-使用-rsa-生成私钥。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-使用-rsa-生成私钥。"}},[e._v("#")]),e._v(" 3.2.2 使用 RSA 生成私钥。")]),e._v(" "),s("p",[e._v("使用以下命令生成带有 RSA 的私钥：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl genrsa -out private.key "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v("\n")])])]),s("p",[e._v("应显示与此类似的响应：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Generating RSA private key, 2048 bit long modulus\n............................................+++\n...........+++\ne is 65537 (0x10001)\n")])])]),s("p",[e._v("或者，使用以下命令生成受密码保护的私有 RSA 密钥：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl genrsa -aes256 -passout pass:PASSWORD -out private.key "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v("\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),s("p",[e._v("使用受密码保护的私钥时，必须"),s("code",[e._v("MINIO_CERT_PASSWD")]),e._v("使用以下命令通过环境变量提供密码：")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("MINIO_CERT_PASSWD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("PASSWORD"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("p",[e._v("私有加密密钥的默认 OpenSSL 格式是 PKCS-8，但 MinIO 仅支持 PKCS-1。可以使用以下命令将已使用 PKCS-8 格式化的 RSA 密钥转换为 PKCS-1：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl rsa -in private-pkcs8-key.key -aes256 -passout pass:PASSWORD -out private.key\n")])])]),s("h4",{attrs:{id:"_3-2-3-生成自签名证书。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-生成自签名证书。"}},[e._v("#")]),e._v(" 3.2.3 生成自签名证书。")]),e._v(" "),s("p",[e._v("创建一个以"),s("code",[e._v("openssl.conf")]),e._v("以下内容命名的文件。设置"),s("code",[e._v("IP.1")]),e._v("和/或"),s("code",[e._v("DNS.1")]),e._v("指向正确的 IP/DNS 地址：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[req]\ndistinguished_name = req_distinguished_name\nx509_extensions = v3_req\nprompt = no\n\n[req_distinguished_name]\nC = US\nST = VA\nL = Somewhere\nO = MyOrg\nOU = MyOU\nCN = MyServerName\n\n[v3_req]\nsubjectAltName = @alt_names\n\n[alt_names]\nIP.1 = 127.0.0.1\nDNS.1 = localhost\n")])])]),s("p",[s("code",[e._v("openssl")]),e._v("通过指定配置文件运行并在出现提示时输入密码：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("openssl req -new -x509 -nodes -days "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("730")]),e._v(" -key private.key -out public.crt -config openssl.conf\n")])])]),s("h3",{attrs:{id:"_3-3-使用-gnutls-for-windows-生成证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-使用-gnutls-for-windows-生成证书"}},[e._v("#")]),e._v(" 3.3 使用 GnuTLS (for Windows) 生成证书")]),e._v(" "),s("p",[e._v("本节介绍如何在 Windows 上使用 GnuTLS 生成证书。")]),e._v(" "),s("h4",{attrs:{id:"_3-3-1-安装和配置-gnutls。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-安装和配置-gnutls。"}},[e._v("#")]),e._v(" 3.3.1 安装和配置 GnuTLS。")]),e._v(" "),s("p",[e._v("从"),s("a",{attrs:{href:"http://www.gnutls.org/download.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),s("OutboundLink")],1),e._v("下载并解压 Windows 版本的 GnuTLS 。")]),e._v(" "),s("p",[e._v("使用 PowerShell 将提取的 GnuTLS 二进制文件的路径添加到系统路径：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("setx path "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"%path%;C:\\Users\\MyUser\\Downloads\\gnutls-3.4.9-w64'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[e._v("\\b")]),e._v('in"')]),e._v("\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),s("p",[e._v("可能需要重新启动 PowerShell 才能使此更改生效。")])]),e._v(" "),s("h4",{attrs:{id:"_3-3-2-生成私钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-生成私钥"}},[e._v("#")]),e._v(" 3.3.2 生成私钥：")]),e._v(" "),s("p",[e._v("运行以下命令生成私有"),s("code",[e._v(".key")]),e._v("文件：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("certtool.exe --generate-privkey --outfile private.key\n")])])]),s("p",[e._v("应显示与此类似的响应：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Generating a 3072 bit RSA private key...\n")])])]),s("h4",{attrs:{id:"_3-3-3-生成公共证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-生成公共证书"}},[e._v("#")]),e._v(" 3.3.3 生成公共证书：")]),e._v(" "),s("p",[e._v("创建一个"),s("code",[e._v("cert.cnf")]),e._v("使用以下内容调用的文件。此文件包含使用"),s("code",[e._v("certtool.exe")]),e._v("以下命令生成证书所需的所有信息：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# X.509 Certificate options\n#\n# DN options\n\n# The organization of the subject.\norganization = "Example Inc."\n\n# The organizational unit of the subject.\n#unit = "sleeping dept."\n\n# The state of the certificate owner.\nstate = "Example"\n\n# The country of the subject. Two letter code.\ncountry = "EX"\n\n# The common name of the certificate owner.\ncn = "Sally Certowner"\n\n# In how many days, counting from today, this certificate will expire.\nexpiration_days = 365\n\n# X.509 v3 extensions\n\n# DNS name(s) of the server\ndns_name = "localhost"\n\n# (Optional) Server IP address\nip_address = "127.0.0.1"\n\n# Whether this certificate will be used for a TLS server\ntls_www_server\n')])])]),s("p",[e._v("运行"),s("code",[e._v("certtool.exe")]),e._v("并指定配置文件生成证书：")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("certtool.exe --generate-self-signed --load-privkey private.key --template cert.cnf --outfile public.crt\n")])])]),s("h2",{attrs:{id:"_4-安装来自第三方-ca-的证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装来自第三方-ca-的证书"}},[e._v("#")]),e._v(" 4. 安装来自第三方 CA 的证书")]),e._v(" "),s("p",[e._v("MinIO 可以连接到其他服务器，包括 MinIO 节点或其他服务器类型，例如 NAT 和 Redis。如果这些服务器使用未在已知 CA 注册的证书，请将这些证书置于以下 MinIO 配置路径之一下，以将这些证书的信任添加到 MinIO 服务器：")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Linux：")]),e._v(" "),s("code",[e._v("~/.minio/certs/CAs/")])]),e._v(" "),s("li",[s("strong",[e._v("Windods")]),e._v("："),s("code",[e._v("C:\\Users\\<Username>\\.minio\\certs\\CAs")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);