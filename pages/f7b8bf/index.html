<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud Gateway 中文官网文档 | Java全栈</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="🚀有道无术，术尚可求，有术无道，止于术">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.9b63dc7f.css" as="style"><link rel="preload" href="/assets/js/app.31569fb0.js" as="script"><link rel="preload" href="/assets/js/2.df69d635.js" as="script"><link rel="preload" href="/assets/js/120.b2f1f2eb.js" as="script"><link rel="prefetch" href="/assets/js/10.788e911f.js"><link rel="prefetch" href="/assets/js/100.5869e407.js"><link rel="prefetch" href="/assets/js/101.4735f8c8.js"><link rel="prefetch" href="/assets/js/102.0afc9257.js"><link rel="prefetch" href="/assets/js/103.deaaedc9.js"><link rel="prefetch" href="/assets/js/104.e5de9bfa.js"><link rel="prefetch" href="/assets/js/105.04f52d11.js"><link rel="prefetch" href="/assets/js/106.a0c4adf4.js"><link rel="prefetch" href="/assets/js/107.72cf41ff.js"><link rel="prefetch" href="/assets/js/108.2185b4f1.js"><link rel="prefetch" href="/assets/js/109.a1966f5b.js"><link rel="prefetch" href="/assets/js/11.76e4b896.js"><link rel="prefetch" href="/assets/js/110.f0666616.js"><link rel="prefetch" href="/assets/js/111.2d52e7dc.js"><link rel="prefetch" href="/assets/js/112.7705a466.js"><link rel="prefetch" href="/assets/js/113.2f1ab226.js"><link rel="prefetch" href="/assets/js/114.4aa4d6ae.js"><link rel="prefetch" href="/assets/js/115.4a9765c7.js"><link rel="prefetch" href="/assets/js/116.31d2b63f.js"><link rel="prefetch" href="/assets/js/117.d2af2299.js"><link rel="prefetch" href="/assets/js/118.70b7c00b.js"><link rel="prefetch" href="/assets/js/119.50227395.js"><link rel="prefetch" href="/assets/js/12.88aeacb8.js"><link rel="prefetch" href="/assets/js/121.e9e3e5bf.js"><link rel="prefetch" href="/assets/js/122.8821ca4c.js"><link rel="prefetch" href="/assets/js/123.5c481679.js"><link rel="prefetch" href="/assets/js/124.90aefb34.js"><link rel="prefetch" href="/assets/js/125.3c2d8a2e.js"><link rel="prefetch" href="/assets/js/126.ca38566c.js"><link rel="prefetch" href="/assets/js/127.74131025.js"><link rel="prefetch" href="/assets/js/128.da48cef5.js"><link rel="prefetch" href="/assets/js/129.3122af0d.js"><link rel="prefetch" href="/assets/js/13.ef864632.js"><link rel="prefetch" href="/assets/js/130.1e22d289.js"><link rel="prefetch" href="/assets/js/131.706af342.js"><link rel="prefetch" href="/assets/js/132.50c671ee.js"><link rel="prefetch" href="/assets/js/133.db98fa8a.js"><link rel="prefetch" href="/assets/js/134.7fe8cf44.js"><link rel="prefetch" href="/assets/js/135.6219a109.js"><link rel="prefetch" href="/assets/js/136.27f3f774.js"><link rel="prefetch" href="/assets/js/137.b4e57291.js"><link rel="prefetch" href="/assets/js/138.82aaf97d.js"><link rel="prefetch" href="/assets/js/139.cab10f5a.js"><link rel="prefetch" href="/assets/js/14.ddfa3e6b.js"><link rel="prefetch" href="/assets/js/140.4b42a53f.js"><link rel="prefetch" href="/assets/js/141.ba14455a.js"><link rel="prefetch" href="/assets/js/142.4acedada.js"><link rel="prefetch" href="/assets/js/143.e89a5e92.js"><link rel="prefetch" href="/assets/js/144.27ae0dda.js"><link rel="prefetch" href="/assets/js/145.6bbfb61f.js"><link rel="prefetch" href="/assets/js/146.55df497b.js"><link rel="prefetch" href="/assets/js/147.40936f4a.js"><link rel="prefetch" href="/assets/js/148.4be699c3.js"><link rel="prefetch" href="/assets/js/149.fc77592a.js"><link rel="prefetch" href="/assets/js/15.68f8ce44.js"><link rel="prefetch" href="/assets/js/150.e7fb1666.js"><link rel="prefetch" href="/assets/js/151.40ff52a0.js"><link rel="prefetch" href="/assets/js/152.fda432cf.js"><link rel="prefetch" href="/assets/js/153.1b165d6b.js"><link rel="prefetch" href="/assets/js/154.3bb5bcb3.js"><link rel="prefetch" href="/assets/js/155.6cd504f2.js"><link rel="prefetch" href="/assets/js/156.b1ff07fd.js"><link rel="prefetch" href="/assets/js/157.57a6101a.js"><link rel="prefetch" href="/assets/js/158.0a18c4db.js"><link rel="prefetch" href="/assets/js/159.89815b25.js"><link rel="prefetch" href="/assets/js/16.aff0328f.js"><link rel="prefetch" href="/assets/js/160.9a45fd99.js"><link rel="prefetch" href="/assets/js/161.82e463d5.js"><link rel="prefetch" href="/assets/js/162.5a06785b.js"><link rel="prefetch" href="/assets/js/163.08555c19.js"><link rel="prefetch" href="/assets/js/164.9f890f94.js"><link rel="prefetch" href="/assets/js/165.2e875427.js"><link rel="prefetch" href="/assets/js/166.3f418177.js"><link rel="prefetch" href="/assets/js/167.06c2cc48.js"><link rel="prefetch" href="/assets/js/168.3e5efe52.js"><link rel="prefetch" href="/assets/js/169.637e7376.js"><link rel="prefetch" href="/assets/js/17.125748af.js"><link rel="prefetch" href="/assets/js/170.319e96c6.js"><link rel="prefetch" href="/assets/js/171.a09af050.js"><link rel="prefetch" href="/assets/js/172.23d78708.js"><link rel="prefetch" href="/assets/js/173.c057313f.js"><link rel="prefetch" href="/assets/js/174.8d168208.js"><link rel="prefetch" href="/assets/js/175.d81d3c21.js"><link rel="prefetch" href="/assets/js/176.8ba38854.js"><link rel="prefetch" href="/assets/js/177.620927ce.js"><link rel="prefetch" href="/assets/js/178.3c001e58.js"><link rel="prefetch" href="/assets/js/179.0acd475a.js"><link rel="prefetch" href="/assets/js/18.fa6cd919.js"><link rel="prefetch" href="/assets/js/180.e910d853.js"><link rel="prefetch" href="/assets/js/181.7798460e.js"><link rel="prefetch" href="/assets/js/182.3c1fc210.js"><link rel="prefetch" href="/assets/js/183.8cc80600.js"><link rel="prefetch" href="/assets/js/184.fff56765.js"><link rel="prefetch" href="/assets/js/185.c63f91e5.js"><link rel="prefetch" href="/assets/js/186.7870decd.js"><link rel="prefetch" href="/assets/js/187.3cb205f3.js"><link rel="prefetch" href="/assets/js/188.3215c6b1.js"><link rel="prefetch" href="/assets/js/189.5e324d91.js"><link rel="prefetch" href="/assets/js/19.4bac67a7.js"><link rel="prefetch" href="/assets/js/190.71194c3e.js"><link rel="prefetch" href="/assets/js/191.3d513d7f.js"><link rel="prefetch" href="/assets/js/192.66f1b9c4.js"><link rel="prefetch" href="/assets/js/193.cfe9beef.js"><link rel="prefetch" href="/assets/js/194.d54494f6.js"><link rel="prefetch" href="/assets/js/195.91f8acc9.js"><link rel="prefetch" href="/assets/js/196.a727b0fb.js"><link rel="prefetch" href="/assets/js/197.dcd6487d.js"><link rel="prefetch" href="/assets/js/198.4734520f.js"><link rel="prefetch" href="/assets/js/199.4946dc06.js"><link rel="prefetch" href="/assets/js/20.c78801f0.js"><link rel="prefetch" href="/assets/js/200.72242046.js"><link rel="prefetch" href="/assets/js/201.87f62686.js"><link rel="prefetch" href="/assets/js/202.38ace3e6.js"><link rel="prefetch" href="/assets/js/203.2827a086.js"><link rel="prefetch" href="/assets/js/204.4c8342e0.js"><link rel="prefetch" href="/assets/js/205.e1de7f41.js"><link rel="prefetch" href="/assets/js/206.94f84999.js"><link rel="prefetch" href="/assets/js/207.95ca2dd7.js"><link rel="prefetch" href="/assets/js/208.f293b55a.js"><link rel="prefetch" href="/assets/js/209.056b496b.js"><link rel="prefetch" href="/assets/js/21.64cc6926.js"><link rel="prefetch" href="/assets/js/210.7f232344.js"><link rel="prefetch" href="/assets/js/211.748e6034.js"><link rel="prefetch" href="/assets/js/212.06e705a7.js"><link rel="prefetch" href="/assets/js/213.a9f317f4.js"><link rel="prefetch" href="/assets/js/214.65b257a7.js"><link rel="prefetch" href="/assets/js/215.1260a609.js"><link rel="prefetch" href="/assets/js/216.c1b39ca2.js"><link rel="prefetch" href="/assets/js/217.084bb897.js"><link rel="prefetch" href="/assets/js/218.02aa4cd9.js"><link rel="prefetch" href="/assets/js/219.35339213.js"><link rel="prefetch" href="/assets/js/22.cacbe2f9.js"><link rel="prefetch" href="/assets/js/220.1c043025.js"><link rel="prefetch" href="/assets/js/221.af0028af.js"><link rel="prefetch" href="/assets/js/222.43ea3237.js"><link rel="prefetch" href="/assets/js/223.8c59c2c8.js"><link rel="prefetch" href="/assets/js/224.ceff003f.js"><link rel="prefetch" href="/assets/js/225.d7aa9f36.js"><link rel="prefetch" href="/assets/js/226.7d7574e8.js"><link rel="prefetch" href="/assets/js/227.3786dac4.js"><link rel="prefetch" href="/assets/js/228.67433714.js"><link rel="prefetch" href="/assets/js/229.874cf521.js"><link rel="prefetch" href="/assets/js/23.70f001e8.js"><link rel="prefetch" href="/assets/js/230.63255993.js"><link rel="prefetch" href="/assets/js/231.2771635e.js"><link rel="prefetch" href="/assets/js/232.1a846631.js"><link rel="prefetch" href="/assets/js/233.7950c15f.js"><link rel="prefetch" href="/assets/js/234.9c9d2947.js"><link rel="prefetch" href="/assets/js/235.3423e660.js"><link rel="prefetch" href="/assets/js/236.2d15acb2.js"><link rel="prefetch" href="/assets/js/237.5e3e145a.js"><link rel="prefetch" href="/assets/js/238.ffb20d88.js"><link rel="prefetch" href="/assets/js/239.2d0bd5a9.js"><link rel="prefetch" href="/assets/js/24.e4a1dc80.js"><link rel="prefetch" href="/assets/js/240.987df996.js"><link rel="prefetch" href="/assets/js/241.9e67aa11.js"><link rel="prefetch" href="/assets/js/242.20c57ba1.js"><link rel="prefetch" href="/assets/js/243.b3b4e01f.js"><link rel="prefetch" href="/assets/js/25.607f30bb.js"><link rel="prefetch" href="/assets/js/26.60c54e7d.js"><link rel="prefetch" href="/assets/js/27.48c44b2e.js"><link rel="prefetch" href="/assets/js/28.eb44c0ba.js"><link rel="prefetch" href="/assets/js/29.3f35baff.js"><link rel="prefetch" href="/assets/js/3.c76bdb66.js"><link rel="prefetch" href="/assets/js/30.5ceb6f39.js"><link rel="prefetch" href="/assets/js/31.df68a33c.js"><link rel="prefetch" href="/assets/js/32.0870e048.js"><link rel="prefetch" href="/assets/js/33.3b446daa.js"><link rel="prefetch" href="/assets/js/34.fd564325.js"><link rel="prefetch" href="/assets/js/35.0e1dceb3.js"><link rel="prefetch" href="/assets/js/36.6ea040e9.js"><link rel="prefetch" href="/assets/js/37.d0f64292.js"><link rel="prefetch" href="/assets/js/38.da592564.js"><link rel="prefetch" href="/assets/js/39.f2413731.js"><link rel="prefetch" href="/assets/js/4.ce850d9b.js"><link rel="prefetch" href="/assets/js/40.7c003d2a.js"><link rel="prefetch" href="/assets/js/41.61dee31e.js"><link rel="prefetch" href="/assets/js/42.dc1cfeb4.js"><link rel="prefetch" href="/assets/js/43.3fe14024.js"><link rel="prefetch" href="/assets/js/44.b66c9969.js"><link rel="prefetch" href="/assets/js/45.281f7712.js"><link rel="prefetch" href="/assets/js/46.fb40bb01.js"><link rel="prefetch" href="/assets/js/47.311785d3.js"><link rel="prefetch" href="/assets/js/48.0070f89f.js"><link rel="prefetch" href="/assets/js/49.0a752342.js"><link rel="prefetch" href="/assets/js/5.1faa936b.js"><link rel="prefetch" href="/assets/js/50.d46282a9.js"><link rel="prefetch" href="/assets/js/51.5a52f209.js"><link rel="prefetch" href="/assets/js/52.1ec82ee7.js"><link rel="prefetch" href="/assets/js/53.01e08d71.js"><link rel="prefetch" href="/assets/js/54.0ef033a3.js"><link rel="prefetch" href="/assets/js/55.602b8614.js"><link rel="prefetch" href="/assets/js/56.3a886341.js"><link rel="prefetch" href="/assets/js/57.feae1a28.js"><link rel="prefetch" href="/assets/js/58.6d2f12be.js"><link rel="prefetch" href="/assets/js/59.9325c1da.js"><link rel="prefetch" href="/assets/js/6.5a088ba5.js"><link rel="prefetch" href="/assets/js/60.a265bf7c.js"><link rel="prefetch" href="/assets/js/61.30146ded.js"><link rel="prefetch" href="/assets/js/62.662b760a.js"><link rel="prefetch" href="/assets/js/63.5d59c7f0.js"><link rel="prefetch" href="/assets/js/64.faabd330.js"><link rel="prefetch" href="/assets/js/65.9ced9383.js"><link rel="prefetch" href="/assets/js/66.2ff8ca8d.js"><link rel="prefetch" href="/assets/js/67.9000451e.js"><link rel="prefetch" href="/assets/js/68.c63a2ef0.js"><link rel="prefetch" href="/assets/js/69.8c8e119e.js"><link rel="prefetch" href="/assets/js/7.8f4bed74.js"><link rel="prefetch" href="/assets/js/70.de3ec280.js"><link rel="prefetch" href="/assets/js/71.0009b157.js"><link rel="prefetch" href="/assets/js/72.31a06f9d.js"><link rel="prefetch" href="/assets/js/73.e84721d3.js"><link rel="prefetch" href="/assets/js/74.8da44d3d.js"><link rel="prefetch" href="/assets/js/75.0c64e4b0.js"><link rel="prefetch" href="/assets/js/76.3db2aba9.js"><link rel="prefetch" href="/assets/js/77.b00b1560.js"><link rel="prefetch" href="/assets/js/78.53a1c343.js"><link rel="prefetch" href="/assets/js/79.1218161f.js"><link rel="prefetch" href="/assets/js/8.b1937d38.js"><link rel="prefetch" href="/assets/js/80.b85cb7a2.js"><link rel="prefetch" href="/assets/js/81.d4f058f7.js"><link rel="prefetch" href="/assets/js/82.bd0f843c.js"><link rel="prefetch" href="/assets/js/83.b6f1d5c6.js"><link rel="prefetch" href="/assets/js/84.e3469377.js"><link rel="prefetch" href="/assets/js/85.1f3e7bd0.js"><link rel="prefetch" href="/assets/js/86.179e9bc8.js"><link rel="prefetch" href="/assets/js/87.9c3f44b4.js"><link rel="prefetch" href="/assets/js/88.79659ee4.js"><link rel="prefetch" href="/assets/js/89.bea5895d.js"><link rel="prefetch" href="/assets/js/9.ebe72a00.js"><link rel="prefetch" href="/assets/js/90.a7bf2270.js"><link rel="prefetch" href="/assets/js/91.82f3a339.js"><link rel="prefetch" href="/assets/js/92.89864afc.js"><link rel="prefetch" href="/assets/js/93.6a775a5a.js"><link rel="prefetch" href="/assets/js/94.dede140a.js"><link rel="prefetch" href="/assets/js/95.e182e5da.js"><link rel="prefetch" href="/assets/js/96.bca74f0c.js"><link rel="prefetch" href="/assets/js/97.0b7a1a08.js"><link rel="prefetch" href="/assets/js/98.33ae82c8.js"><link rel="prefetch" href="/assets/js/99.4f690b51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b63dc7f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Java全栈" class="logo"> <span class="site-name can-hide">Java全栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><!----> <span class="title" style="display:;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/250f21/" class="nav-link">基础设施即服务</a></li><li class="dropdown-subitem"><a href="/pages/f04654/" class="nav-link">平台即服务</a></li><li class="dropdown-subitem"><a href="/pages/58bcba/" class="nav-link">微服务解决复杂问题</a></li><li class="dropdown-subitem"><a href="/pages/b05793/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/1946f3/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li><li class="dropdown-item"><h4>高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/aeaf26/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/059418/" class="nav-link">Kubernetes</a></li></ul></li><li class="dropdown-item"><h4>专题</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fbef9a/" class="nav-link">Spring Security OAuth2</a></li><li class="dropdown-subitem"><a href="/pages/72ccd6/" class="nav-link">企业级 DevOps CI/CD实践</a></li><li class="dropdown-subitem"><a href="/pages/d49c54/" class="nav-link">Simplify Docs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线文档" class="dropdown-title"><!----> <span class="title" style="display:;">在线文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Element - 网站快速成型工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://lodash.com/docs/#defaultsDeep" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lodash Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://zh.nuxtjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js - Vue.js 通用应用框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuex.vuejs.org/zh/api/#vuex-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.vuepress.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>后端文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ifeve.com/google-guava/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google Guava官方教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><!----> <span class="title" style="display:;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://excalidraw.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线白板
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON 编辑器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD 表格生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON 表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线编码转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.processon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  流程图思维导图
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://excalidraw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  画图工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>开源镜像</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSX镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZURE镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Hub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">💖支持</a></div><div class="nav-item"><a href="https://www.pigcs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  返回旧版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><!----> <span class="title" style="display:;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/250f21/" class="nav-link">基础设施即服务</a></li><li class="dropdown-subitem"><a href="/pages/f04654/" class="nav-link">平台即服务</a></li><li class="dropdown-subitem"><a href="/pages/58bcba/" class="nav-link">微服务解决复杂问题</a></li><li class="dropdown-subitem"><a href="/pages/b05793/" class="nav-link">Spring Cloud</a></li><li class="dropdown-subitem"><a href="/pages/1946f3/" class="nav-link">Spring Cloud Alibaba</a></li></ul></li><li class="dropdown-item"><h4>高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/aeaf26/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/pages/059418/" class="nav-link">Kubernetes</a></li></ul></li><li class="dropdown-item"><h4>专题</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fbef9a/" class="nav-link">Spring Security OAuth2</a></li><li class="dropdown-subitem"><a href="/pages/72ccd6/" class="nav-link">企业级 DevOps CI/CD实践</a></li><li class="dropdown-subitem"><a href="/pages/d49c54/" class="nav-link">Simplify Docs</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线文档" class="dropdown-title"><!----> <span class="title" style="display:;">在线文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://element.eleme.cn/#/zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Element - 网站快速成型工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://lodash.com/docs/#defaultsDeep" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Lodash Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://zh.nuxtjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Nuxt.js - Vue.js 通用应用框架
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue CLI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vuex.vuejs.org/zh/api/#vuex-store" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.vuepress.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress 中文文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>后端文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://ifeve.com/google-guava/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google Guava官方教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><!----> <span class="title" style="display:;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://excalidraw.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线白板
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/jsoneditoronline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JSON 编辑器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tableconvert.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MD 表格生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CRON 表达式
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://tool.oschina.net/codeformat/html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码格式化
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cli.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二维码生成器
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://tool.chinaz.com/tools/native_ascii.aspx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线编码转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.processon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  流程图思维导图
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://excalidraw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  画图工具
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>开源镜像</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  OPSX镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://mirror.azure.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AZURE镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Docker Hub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/pages/1b12ed/" class="nav-link">💖支持</a></div><div class="nav-item"><a href="https://www.pigcs.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  返回旧版
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Cloud Gateway</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/aa8849/" class="sidebar-link">Spring Cloud 之 Gateway</a></li><li><a href="/pages/f0610e/" class="sidebar-link">Spring Cloud Gateway 配置大全</a></li><li><a href="/pages/f7b8bf/" aria-current="page" class="active sidebar-link">Spring Cloud Gateway 中文官网文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#文档版本-2-1-0" class="sidebar-link">文档版本 2.1.0</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_1-如何在工程中引用spring-cloud-gateway" class="sidebar-link">1. 如何在工程中引用Spring Cloud Gateway</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_2-词汇表" class="sidebar-link">2. 词汇表</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_3-如何工作的" class="sidebar-link">3. 如何工作的</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-路由断言factories" class="sidebar-link">4. 路由断言Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-1-after-路由断言-factory" class="sidebar-link">4.1 After 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-2-before-路由断言-factory" class="sidebar-link">4.2 Before 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-3-between-路由断言-factory" class="sidebar-link">4.3 Between 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-4-cookie-路由断言-factory" class="sidebar-link">4.4 Cookie 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-5-header-路由断言-factory" class="sidebar-link">4.5 Header  路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-6-host-路由断言-factory" class="sidebar-link">4.6 Host 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-7-method-路由断言-factory" class="sidebar-link">4.7 Method 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-8-path-路由断言-factory" class="sidebar-link">4.8 Path 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-9-query-路由断言-factory" class="sidebar-link">4.9 Query 路由断言 Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-10-remoteaddr-路由断言-factory" class="sidebar-link">4.10 RemoteAddr 路由断言 Factory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_4-10-1-修改远程地址的解析方式" class="sidebar-link">4.10.1 修改远程地址的解析方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-1-addrequestheader-gatewayfilter-factory" class="sidebar-link">5.1 AddRequestHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-2-addrequestparameter-gatewayfilter-factory" class="sidebar-link">5.2 AddRequestParameter GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-3-addresponseheader-gatewayfilter-factory" class="sidebar-link">5.3 AddResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-4-hystrix-gatewayfilter-factory" class="sidebar-link">5.4 Hystrix GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-5-fallbackheaders-gatewayfilter-factory" class="sidebar-link">5.5 FallbackHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-6-prefixpath-gatewayfilter-factory" class="sidebar-link">5.6 PrefixPath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-7-preservehostheader-gatewayfilter-factory" class="sidebar-link">5.7 PreserveHostHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-8-requestratelimiter-gatewayfilter-factory" class="sidebar-link">5.8 RequestRateLimiter GatewayFilter Factory</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-8-1-redis-ratelimiter" class="sidebar-link">5.8.1 Redis RateLimiter</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-9-redirectto-gatewayfilter-factory" class="sidebar-link">5.9 RedirectTo GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-10-removenonproxyheaders-gatewayfilter-factory" class="sidebar-link">5.10 RemoveNonProxyHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-11-removerequestheader-gatewayfilter-factory" class="sidebar-link">5.11 RemoveRequestHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-12-removeresponseheader-gatewayfilter-factory" class="sidebar-link">5.12 RemoveResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-13-rewritepath-gatewayfilter-factory" class="sidebar-link">5.13 RewritePath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-14-rewriteresponseheader-gatewayfilter-factory" class="sidebar-link">5.14 RewriteResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-15-savesession-gatewayfilter-factory" class="sidebar-link">5.15 SaveSession GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-16-secureheaders-gatewayfilter-factory" class="sidebar-link">5.16 SecureHeaders GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-17-setpath-gatewayfilter-factory" class="sidebar-link">5.17 SetPath GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-18-setresponseheader-gatewayfilter-factory" class="sidebar-link">5.18 SetResponseHeader GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-19-setstatus-gatewayfilter-factory" class="sidebar-link">5.19 SetStatus GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-20-stripprefix-gatewayfilter-factory" class="sidebar-link">5.20 StripPrefix GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-21-retry-gatewayfilter-factory" class="sidebar-link">5.21 Retry GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-22-requestsize-gatewayfilter-factory" class="sidebar-link">5.22 RequestSize GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-23-modify-request-body-gatewayfilter-factory" class="sidebar-link">5.23 Modify Request Body GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_5-24-modify-response-body-gatewayfilter-factory" class="sidebar-link">5.24 Modify Response Body GatewayFilter Factory</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-1-全局filter和gatewayfilter组合排序" class="sidebar-link">6.1 全局Filter和GatewayFilter组合排序</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-2-forward-routing-filter" class="sidebar-link">6.2 Forward Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-3-loadbalancerclient-filter" class="sidebar-link">6.3 LoadBalancerClient Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-4-netty-routing-filter" class="sidebar-link">6.4 Netty Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-5-netty-write-response-filter" class="sidebar-link">6.5 Netty Write Response Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-6-routetorequesturl-filter" class="sidebar-link">6.6 RouteToRequestUrl Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-7-websocket-routing-filter" class="sidebar-link">6.7 Websocket Routing Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-8-gateway-metrics-filter" class="sidebar-link">6.8 Gateway Metrics Filter</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_6-9-making-an-exchange-as-routed" class="sidebar-link">6.9 Making An Exchange As Routed</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_7-1-tls-握手" class="sidebar-link">7.1 TLS 握手</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-1-fluent-java-routes-api" class="sidebar-link">8.1 Fluent Java Routes API</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-2-discoveryclient-route-definition-locator" class="sidebar-link">8.2 DiscoveryClient Route Definition Locator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes" class="sidebar-link">8.2.1 Configuring Predicates and Filters For DiscoveryClient Routes</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-retrieving-route-filters" class="sidebar-link">11.1 Retrieving route filters</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-1-global-filters" class="sidebar-link">11.1.1 Global Filters</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-1-2-route-filters" class="sidebar-link">11.1.2 Route Filters</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-2-refreshing-the-route-cache" class="sidebar-link">11.2 Refreshing the route cache</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-3-retrieving-the-routes-defined-in-the-gateway" class="sidebar-link">11.3 Retrieving the routes defined in the gateway</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-4-retrieving-information-about-a-particular-route" class="sidebar-link">11.4 Retrieving information about a particular route</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-5-creating-and-deleting-a-particular-route" class="sidebar-link">11.5 Creating and deleting a particular route</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_11-6-recap-list-of-all-endpoints" class="sidebar-link">11.6 Recap: list of all endpoints</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-1-writing-custom-route-predicate-factories" class="sidebar-link">12.1 Writing Custom Route Predicate Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-2-writing-custom-gatewayfilter-factories" class="sidebar-link">12.2 Writing Custom GatewayFilter Factories</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-3-writing-custom-global-filters" class="sidebar-link">12.3 Writing Custom Global Filters</a></li><li class="sidebar-sub-header"><a href="/pages/f7b8bf/#_12-4-writing-custom-route-locators-and-writers" class="sidebar-link">12.4 Writing Custom Route Locators and Writers</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><span data-v-0c557b5e>Spring Cloud Gateway</span></li><li data-v-0c557b5e><span data-v-0c557b5e>Spring Cloud Gateway</span></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/heyuqiang" target="_blank" title="作者" class="beLink" data-v-0c557b5e>heyuqiang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-02-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Spring Cloud Gateway 中文官网文档<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="spring-cloud-gateway-中文官网文档"><a href="#spring-cloud-gateway-中文官网文档" class="header-anchor">#</a> Spring Cloud Gateway 中文官网文档</h1> <h2 id="文档版本-2-1-0"><a href="#文档版本-2-1-0" class="header-anchor">#</a> 文档版本 2.1.0</h2> <p><strong>目录</strong></p> <div class="language- extra-class"><pre class="language-text"><code>1. How to Include Spring Cloud Gateway
2. Glossary
3. How It Works
4. Route Predicate Factories
5. GatewayFilter Factories
6. Global Filters
7. TLS / SSL
8. Configuration
9. Reactor Netty Access Logs
10. CORS Configuration
11. Actuator API
12. Developer Guide
</code></pre></div><p>该项目提供了一个建立在Spring Ecosystem之上的<a href="https://cloud.tencent.com/product/apigateway?from=10680" target="_blank" rel="noopener noreferrer">API网关<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，包括：Spring 5，Spring Boot 2和Project Reactor。Spring Cloud Gateway旨在提供一种简单而有效的方式来对API进行路由，并为他们提供切面，例如：安全性，监控/指标 和弹性等。</p> <h2 id="_1-如何在工程中引用spring-cloud-gateway"><a href="#_1-如何在工程中引用spring-cloud-gateway" class="header-anchor">#</a> 1. 如何在工程中引用Spring Cloud Gateway</h2> <p>要在项目中引入Spring Cloud Gateway，需要引用 group  <code>org.springframework.cloud</code> 和 artifact id为<code>spring-cloud-starter-gateway</code> starter。最新的Spring Cloud Release 构建信息，请参阅<a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud Project page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>如果应用了该starter，但由于某种原因不希望启用网关，请进行设置<code>spring.cloud.gateway.enabled=false</code>。</p> <blockquote><p>重要 Spring Cloud Gateway依赖Spring Boot和Spring Webflux提供的Netty runtime。它不能在传统的Servlet容器中工作或构建为WAR</p></blockquote> <h2 id="_2-词汇表"><a href="#_2-词汇表" class="header-anchor">#</a> 2. 词汇表</h2> <ul><li><strong>Route 路由</strong>：gateway的基本构建模块。它由ID、目标URI、断言集合和过滤器集合组成。如果聚合断言结果为真，则匹配到该路由。</li> <li><strong>Predicate 断言</strong>：这是一个<a href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html" target="_blank" rel="noopener noreferrer">Java 8 Function Predicate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。输入类型是<a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html" target="_blank" rel="noopener noreferrer"> Spring Framework <code>ServerWebExchange</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这允许开发人员可以匹配来自HTTP请求的任何内容，例如Header或参数。</li> <li><strong>Filter 过滤器</strong>：这些是使用特定工厂构建的<a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html" target="_blank" rel="noopener noreferrer"> Spring Framework<code>GatewayFilter</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实例。所以可以在返回请求之前或之后修改请求和响应的内容。</li></ul> <h2 id="_3-如何工作的"><a href="#_3-如何工作的" class="header-anchor">#</a> 3. 如何工作的</h2> <p><img src="/img/spring_cloud_gateway_diagram.png" alt="img"></p> <p>Spring Cloud Gateway Diagram</p> <p>客户端向Spring Cloud Gateway发出请求。如果Gateway Handler Mapping确定请求与路由匹配，则将其发送到Gateway Web Handler。此handler通过特定于该请求的过滤器链处理请求。图中filters被虚线划分的原因是filters可以在发送代理请求之前或之后执行逻辑。先执行所有“pre filter”逻辑，然后进行请求代理。在请求代理执行完后，执行“post filter”逻辑。</p> <blockquote><p>注意 HTTP和HTTPS URI默认端口设置是80和443。</p></blockquote> <h2 id="_4-路由断言factories"><a href="#_4-路由断言factories" class="header-anchor">#</a> 4. 路由断言Factories</h2> <p>Spring Cloud Gateway将路由作为Spring WebFlux <code>HandlerMapping</code>基础结构的一部分进行匹配。Spring Cloud Gateway包含许多内置的路由断言Factories。这些断言都匹配HTTP请求的不同属性。多个路由断言Factories可以通过 <code>and</code> 组合使用。</p> <h2 id="_4-1-after-路由断言-factory"><a href="#_4-1-after-路由断言-factory" class="header-anchor">#</a> 4.1 After 路由断言 Factory</h2> <p>After Route Predicate Factory采用一个参数——日期时间。在该日期时间之后发生的请求都将被匹配。</p> <p><strong>application.yml</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> after_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> After=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-2-before-路由断言-factory"><a href="#_4-2-before-路由断言-factory" class="header-anchor">#</a> 4.2 Before 路由断言 Factory</h2> <p>Before Route Predicate Factory采用一个参数——日期时间。在该日期时间之前发生的请求都将被匹配。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> before_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Before=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-3-between-路由断言-factory"><a href="#_4-3-between-路由断言-factory" class="header-anchor">#</a> 4.3 Between 路由断言 Factory</h2> <p>Between 路由断言 Factory有两个参数，datetime1和datetime2。在datetime1和datetime2之间的请求将被匹配。datetime2参数的实际时间必须在datetime1之后。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> between_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Between=2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>20T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span><span class="token punctuation">,</span> 2017<span class="token punctuation">-</span>01<span class="token punctuation">-</span>21T17<span class="token punctuation">:</span>42<span class="token punctuation">:</span>47.789<span class="token punctuation">-</span>07<span class="token punctuation">:</span>00<span class="token punctuation">[</span>America/Denver<span class="token punctuation">]</span>
</code></pre></div><h2 id="_4-4-cookie-路由断言-factory"><a href="#_4-4-cookie-路由断言-factory" class="header-anchor">#</a> 4.4 Cookie 路由断言 Factory</h2> <p>Cookie 路由断言 Factory有两个参数，cookie名称和正则表达式。请求包含次cookie名称且正则表达式为真的将会被匹配。</p> <p><strong>application.yml</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> cookie_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Cookie=chocolate<span class="token punctuation">,</span> ch.p
</code></pre></div><h2 id="_4-5-header-路由断言-factory"><a href="#_4-5-header-路由断言-factory" class="header-anchor">#</a> 4.5 Header  路由断言 Factory</h2> <p>Header 路由断言 Factory有两个参数，header名称和正则表达式。请求包含次header名称且正则表达式为真的将会被匹配。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
     <span class="token key atrule">routes</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> header_route
       <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
       <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+
</code></pre></div><h2 id="_4-6-host-路由断言-factory"><a href="#_4-6-host-路由断言-factory" class="header-anchor">#</a> 4.6 Host 路由断言 Factory</h2> <p>Host 路由断言 Factory包括一个参数：host name列表。使用Ant路径匹配规则，<code>.</code>作为分隔符。 <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Host=<span class="token important">**.somehost.org</span><span class="token punctuation">,</span><span class="token important">**.anotherhost.org</span>
</code></pre></div><h2 id="_4-7-method-路由断言-factory"><a href="#_4-7-method-路由断言-factory" class="header-anchor">#</a> 4.7 Method 路由断言 Factory</h2> <p>Method 路由断言 Factory只包含一个参数: 需要匹配的HTTP请求方式</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> method_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Method=GET
</code></pre></div><p>所有GET请求都将被路由</p> <h2 id="_4-8-path-路由断言-factory"><a href="#_4-8-path-路由断言-factory" class="header-anchor">#</a> 4.8 Path 路由断言 Factory</h2> <p>Path 路由断言 Factory 有2个参数: 一个Spring <code>PathMatcher</code>表达式列表和可选<code>matchOptionalTrailingSeparator</code>标识 .</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span><span class="token punctuation">,</span>/bar/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>例如: <code>/foo/1</code> or <code>/foo/bar</code> or <code>/bar/baz</code>的请求都将被匹配</p> <p>URI 模板变量 (如上例中的 <code>segment</code> ) 将以Map的方式保存于<code>ServerWebExchange.getAttributes()</code> key为<code>ServerWebExchangeUtils.URI_TEMPLATE_VARIABLES_ATTRIBUTE</code>. 这些值将在<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#gateway-route-filters" target="_blank" rel="noopener noreferrer">GatewayFilter Factories<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>使用</p> <p>可以使用以下方法来更方便地访问这些变量。</p> <div class="language-yml extra-class"><pre class="language-yml"><code>Map&lt;String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span> uriVariables = ServerWebExchangeUtils.getPathPredicateVariables(exchange);

String segment = uriVariables.get(&quot;segment&quot;);
</code></pre></div><h2 id="_4-9-query-路由断言-factory"><a href="#_4-9-query-路由断言-factory" class="header-anchor">#</a> 4.9 Query 路由断言 Factory</h2> <p>Query 路由断言 Factory 有2个参数: 必选项 <code>param</code> 和可选项 <code>regexp</code>.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Query=baz
</code></pre></div><p>则包含了请求参数 <code>baz</code>的都将被匹配。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> query_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Query=foo<span class="token punctuation">,</span> ba.
</code></pre></div><p>如果请求参数里包含<code>foo</code>参数，并且值匹配为<code>ba.</code> 表达式，则将会被路由，如：<code>bar</code> and <code>baz</code></p> <h2 id="_4-10-remoteaddr-路由断言-factory"><a href="#_4-10-remoteaddr-路由断言-factory" class="header-anchor">#</a> 4.10 RemoteAddr 路由断言 Factory</h2> <p>RemoteAddr 路由断言 Factory的参数为 一个CIDR符号（IPv4或IPv6）字符串的列表，最小值为1，例如192.168.0.1/16（其中192.168.0.1是IP地址并且16是子网掩码）。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> remoteaddr_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoteAddr=192.168.1.1/24
</code></pre></div><p>如果请求的remote address 为 <code>192.168.1.10</code>则将被路由</p> <h3 id="_4-10-1-修改远程地址的解析方式"><a href="#_4-10-1-修改远程地址的解析方式" class="header-anchor">#</a> 4.10.1 修改远程地址的解析方式</h3> <p>默认情况下，RemoteAddr 路由断言 Factory使用传入请求中的remote address。如果Spring Cloud Gateway位于代理层后面，则可能与实际客户端IP地址不匹配。</p> <p>可以通过设置自定义<code>RemoteAddressResolver</code>来自定义解析远程地址的方式。Spring Cloud Gateway网关附带一个非默认远程地址解析程序，它基于<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" target="_blank" rel="noopener noreferrer">X-Forwarded-For header<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <code>XForwardedRemoteAddressResolver</code>.</p> <p><code>XForwardedRemoteAddressResolver</code> 有两个静态构造函数方法，采用不同的安全方法：</p> <ol><li><code>XForwardedRemoteAddressResolver:：TrustAll</code>返回一个<code>RemoteAddressResolver</code>，它始终采用<code>X-Forwarded-for</code>头中找到的第一个IP地址。这种方法容易受到欺骗，因为恶意客户端可能会为解析程序接受的“x-forwarded-for”设置初始值。</li> <li><code>XForwardedRemoteAddressResolver:：MaxTrustedIndex</code>获取一个索引，该索引与在Spring Cloud网关前运行的受信任基础设施数量相关。例如，如果SpringCloudGateway只能通过haproxy访问，则应使用值1。如果在访问Spring Cloud Gateway之前需要两个受信任的基础架构跃点，那么应该使用2。</li></ol> <p>给定以下的header值：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">X-Forwarded-For</span><span class="token punctuation">:</span> 0.0.0.1<span class="token punctuation">,</span> 0.0.0.2<span class="token punctuation">,</span> 0.0.0.3
</code></pre></div><p>下面的` maxTrustedIndex值将生成以下远程地址:</p> <table><thead><tr><th style="text-align:left;"><code>maxTrustedIndex</code></th> <th style="text-align:left;">result</th></tr></thead> <tbody><tr><td style="text-align:left;">[<code>Integer.MIN_VALUE</code>,0]</td> <td style="text-align:left;">(invalid, <code>IllegalArgumentException</code> during initialization)</td></tr> <tr><td style="text-align:left;">1</td> <td style="text-align:left;">0.0.0.3</td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">0.0.0.2</td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">0.0.0.1</td></tr> <tr><td style="text-align:left;">[4, <code>Integer.MAX_VALUE</code>]</td> <td style="text-align:left;">0.0.0.1</td></tr></tbody></table> <p>Java 配置方式:</p> <p><strong>GatewayConfig.java</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RemoteAddressResolver</span> resolver <span class="token operator">=</span> <span class="token class-name">XForwardedRemoteAddressResolver</span>
    <span class="token punctuation">.</span><span class="token function">maxTrustedIndex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;direct-route&quot;</span><span class="token punctuation">,</span>
    r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span><span class="token string">&quot;10.1.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream1&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;proxied-route&quot;</span><span class="token punctuation">,</span>
    r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">remoteAddr</span><span class="token punctuation">(</span>resolver<span class="token punctuation">,</span>  <span class="token string">&quot;10.10.1.1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10.10.1.1/24&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://downstream2&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h1 id="_5-gatewayfilter-factories"><a href="#_5-gatewayfilter-factories" class="header-anchor">#</a> 5. GatewayFilter Factories</h1> <p>过滤器允许以某种方式修改传入的HTTP请求或返回的HTTP响应。过滤器的作用域是某些特定路由。Spring Cloud Gateway包括许多内置的 Filter工厂。</p> <p>注意：有关如何使用以下任何过滤器的更详细示例，请查看<a href="https://github.com/spring-cloud/spring-cloud-gateway/tree/master/spring-cloud-gateway-core/src/test/java/org/springframework/cloud/gateway/filter/factory" target="_blank" rel="noopener noreferrer">unit tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.。</p> <h2 id="_5-1-addrequestheader-gatewayfilter-factory"><a href="#_5-1-addrequestheader-gatewayfilter-factory" class="header-anchor">#</a> 5.1 AddRequestHeader GatewayFilter Factory</h2> <p>采用一对名称和值作为参数 <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>对于所有匹配的请求，这将向下游请求的头中添加 <code>x-request-foo:bar</code> header</p> <h2 id="_5-2-addrequestparameter-gatewayfilter-factory"><a href="#_5-2-addrequestparameter-gatewayfilter-factory" class="header-anchor">#</a> 5.2 AddRequestParameter GatewayFilter Factory</h2> <p>采用一对名称和值作为参数 <strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_parameter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddRequestParameter=foo<span class="token punctuation">,</span> bar
</code></pre></div><p>对于所有匹配的请求，这将向下游请求添加<code>foo=bar</code>查询字符串</p> <h2 id="_5-3-addresponseheader-gatewayfilter-factory"><a href="#_5-3-addresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.3 AddResponseHeader GatewayFilter Factory</h2> <p>采用一对名称和值作为参数</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> add_request_header_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>对于所有匹配的请求，这会将<code>x-response-foo:bar</code>头添加到下游响应的header中</p> <h2 id="_5-4-hystrix-gatewayfilter-factory"><a href="#_5-4-hystrix-gatewayfilter-factory" class="header-anchor">#</a> 5.4 Hystrix GatewayFilter Factory</h2> <p><a href="https://github.com/Netflix/Hystrix" target="_blank" rel="noopener noreferrer">Hystrix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是Netflix开源的断路器组件。Hystrix GatewayFilter允许你向网关路由引入断路器，保护你的服务不受级联故障的影响，并允许你在下游故障时提供fallback响应。</p> <p>要在项目中启用Hystrix网关过滤器，需要添加对 <code>spring-cloud-starter-netflix-hystrix</code>的依赖 <a href="https://cloud.spring.io/spring-cloud-netflix/" target="_blank" rel="noopener noreferrer">Spring Cloud Netflix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Hystrix GatewayFilter Factory 需要一个name参数，即<code>HystrixCommand</code>的名称。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> hystrix_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Hystrix=myCommandName
</code></pre></div><p>这将剩余的过滤器包装在命令名为“myCommandName”的<code>HystrixCommand</code>中。</p> <p>hystrix过滤器还可以接受可选的<code>fallbackUri</code> 参数。目前，仅支持<code>forward:</code> 预设的URI，如果调用fallback，则请求将转发到与URI匹配的控制器。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> hystrix_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//backing<span class="token punctuation">-</span>service<span class="token punctuation">:</span><span class="token number">8088</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/consumingserviceendpoint
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fallbackcmd
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/incaseoffailureusethis
        <span class="token punctuation">-</span> RewritePath=/consumingserviceendpoint<span class="token punctuation">,</span> /backingserviceendpoint
</code></pre></div><p>当调用hystrix fallback时，这将转发到<code>/incaseoffailureusethis</code> uri。注意，这个示例还演示了（可选）通过目标URI上的'lb`前缀,使用Spring Cloud Netflix Ribbon 客户端<a href="https://cloud.tencent.com/product/clb?from=10680" target="_blank" rel="noopener noreferrer">负载均衡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>主要场景是使用<code>fallbackUri</code> 到网关应用程序中的内部控制器或处理程序。但是，也可以将请求重新路由到外部应用程序中的控制器或处理程序，如：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ingredients
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=//ingredients/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/fallback
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9994</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/fallback
</code></pre></div><p>在本例中，gateway应用程序中没有 <code>fallback</code> 实现，但是另一个应用程序中有一个接口实现，注册为“<a href="http://localhost:9994/" target="_blank" rel="noopener noreferrer">http://localhost:9994<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>”。</p> <p>在将请求转发到fallback的情况下，Hystrix Gateway过滤还支持直接抛出<code>Throwable</code> 。它被作为<code>ServerWebExchangeUtils.HYSTRIX_EXECUTION_EXCEPTION_ATTR</code>属性添加到<code>ServerWebExchange</code>中，可以在处理网关应用程序中的fallback时使用。</p> <p>对于外部控制器/处理程序方案，可以添加带有异常详细信息的header。可以在 <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#fallback-headers" target="_blank" rel="noopener noreferrer">FallbackHeaders GatewayFilter Factory section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.中找到有关它的更多信息。</p> <p>hystrix配置参数（如 timeouts）可以使用全局默认值配置，也可以使用<a href="https://github.com/Netflix/Hystrix/wiki/Configuration" target="_blank" rel="noopener noreferrer">Hystrix wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中所述属性进行配置。</p> <p>要为上面的示例路由设置5秒超时，将使用以下配置：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">hystrix.command.fallbackcmd.execution.isolation.thread.timeoutInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre></div><h2 id="_5-5-fallbackheaders-gatewayfilter-factory"><a href="#_5-5-fallbackheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.5 FallbackHeaders GatewayFilter Factory</h2> <p><code>FallbackHeaders</code>允许在转发到外部应用程序中的<code>FallbackUri</code>的请求的header中添加Hystrix异常详细信息，如下所示：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ingredients
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=//ingredients/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hystrix
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> fetchIngredients
            <span class="token key atrule">fallbackUri</span><span class="token punctuation">:</span> forward<span class="token punctuation">:</span>/fallback
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> ingredients<span class="token punctuation">-</span>fallback
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9994</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/fallback
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FallbackHeaders
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">executionExceptionTypeHeaderName</span><span class="token punctuation">:</span> Test<span class="token punctuation">-</span>Header
</code></pre></div><p>在本例中，在运行<code>HystrixCommand</code>发生执行异常后，请求将被转发到 <code>localhost:9994</code>应用程序中的 <code>fallback</code>终端或程序。异常类型、消息（如果可用）cause exception类型和消息的头，将由<code>FallbackHeaders</code> filter添加到该请求中。</p> <p>通过设置下面列出的参数值及其默认值，可以在配置中覆盖headers的名称：</p> <ul><li><code>executionExceptionTypeHeaderName</code> (<code>&quot;Execution-Exception-Type&quot;</code>)</li> <li><code>executionExceptionMessageHeaderName</code> (<code>&quot;Execution-Exception-Message&quot;</code>)</li> <li><code>rootCauseExceptionTypeHeaderName</code> (<code>&quot;Root-Cause-Exception-Type&quot;</code>)</li> <li><code>rootCauseExceptionMessageHeaderName</code> (<code>&quot;Root-Cause-Exception-Message&quot;</code>)</li></ul> <p>Hystrix 如何实现的更多细节可以参考 <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html#hystrix" target="_blank" rel="noopener noreferrer">Hystrix GatewayFilter Factory section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="_5-6-prefixpath-gatewayfilter-factory"><a href="#_5-6-prefixpath-gatewayfilter-factory" class="header-anchor">#</a> 5.6 PrefixPath GatewayFilter Factory</h2> <p>PrefixPath GatewayFilter 只有一个 <code>prefix</code> 参数.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> PrefixPath=/mypath
</code></pre></div><p>这将给所有匹配请求的路径加前缀<code>/mypath</code>。因此，向<code>/hello</code>发送的请求将发送到<code>/mypath/hello</code>。</p> <h2 id="_5-7-preservehostheader-gatewayfilter-factory"><a href="#_5-7-preservehostheader-gatewayfilter-factory" class="header-anchor">#</a> 5.7 PreserveHostHeader GatewayFilter Factory</h2> <p>该filter没有参数。设置了该Filter后，GatewayFilter将不使用由HTTP客户端确定的host header ，而是发送原始host header 。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> preserve_host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> PreserveHostHeader
</code></pre></div><h2 id="_5-8-requestratelimiter-gatewayfilter-factory"><a href="#_5-8-requestratelimiter-gatewayfilter-factory" class="header-anchor">#</a> 5.8 RequestRateLimiter GatewayFilter Factory</h2> <p>RequestRateLimiter使用<code>RateLimiter</code>实现是否允许继续执行当前请求。如果不允许继续执行，则返回<code>HTTP 429 - Too Many Requests</code> （默认情况下）。</p> <p>这个过滤器可以配置一个可选的<code>keyResolver</code> 参数和rate limiter参数（见下文）。</p> <p><code>keyResolver</code> 是 <code>KeyResolver</code> 接口的实现类.在配置中，按名称使用SpEL引用bean。<code>#{@myKeyResolver}</code> 是引用名为'myKeyResolver'的bean的SpEL表达式。</p> <p><strong>KeyResolver.java.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code>public interface KeyResolver <span class="token punctuation">{</span>
    Mono&lt;String<span class="token punctuation">&gt;</span> resolve(ServerWebExchange exchange);
<span class="token punctuation">}</span>
</code></pre></div><p><code>KeyResolver</code>接口允许使用可插拔策略来派生限制请求的key。在未来的里程碑版本中，将有一些<code>KeyResolver</code>实现。</p> <p><code>KeyResolver</code>的默认实现是<code>PrincipalNameKeyResolver</code>，它从<code>ServerWebExchange</code>检索<code>Principal</code>并调用<code>Principal.getName()</code>。</p> <p>默认情况下，如果<code>KeyResolver</code> 没有获取到key，请求将被拒绝。此行为可以使用 <code>spring.cloud.gateway.filter.request-rate-limiter.deny-empty-key</code> (true or false) 和 <code>spring.cloud.gateway.filter.request-rate-limiter.empty-key-status-code</code>属性进行调整。</p> <blockquote><p>说明 无法通过&quot;shortcut&quot; 配置RequestRateLimiter。以下示例<em>无效</em></p></blockquote> <p><strong>application.properties.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># INVALID SHORTCUT CONFIGURATION</span>
spring.cloud.gateway.routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.filters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=RequestRateLimiter=2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">#{@userkeyresolver}</span>
</code></pre></div><h3 id="_5-8-1-redis-ratelimiter"><a href="#_5-8-1-redis-ratelimiter" class="header-anchor">#</a> 5.8.1 Redis RateLimiter</h3> <p>Redis的实现基于 <a href="https://stripe.com/blog/rate-limiters" target="_blank" rel="noopener noreferrer">Stripe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实现。它需要使用 <code>spring-boot-starter-data-redis-reactive</code> Spring Boot starter。</p> <p>使用的算法是<a href="https://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="noopener noreferrer">Token Bucket Algorithm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.。</p> <p><code>redis-rate-limiter.replenishRate</code>是你允许用户每秒执行多少请求，而丢弃任何请求。这是令牌桶的填充速率。</p> <p>``redis-rate-limiter.burstCapacity`是允许用户在一秒钟内执行的最大请求数。这是令牌桶可以保存的令牌数。将此值设置为零将阻止所有请求。</p> <p>稳定速率是通过在<code>replenishRate</code> 和 <code>burstCapacity</code>中设置相同的值来实现的。可通过设置<code>burstCapacity</code>高于<code>replenishRate</code>来允许临时突发流浪。在这种情况下，限流器需要在两次突发之间留出一段时间（根据<code>replenishRate</code>），因为连续两次突发将导致请求丢失 (<code>HTTP 429 - Too Many Requests</code>).。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">20</span>
</code></pre></div><p><strong>Config.java.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
KeyResolver userKeyResolver() <span class="token punctuation">{</span>
    return exchange <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Mono.just(exchange.getRequest().getQueryParams().getFirst(&quot;user&quot;));
<span class="token punctuation">}</span>
</code></pre></div><p>这定义了每个用户10个请求的限制。允许20个突发，但下一秒只有10个请求可用。<code>KeyResolver</code>是一个简单的获取<code>user</code>请求参数的工具（注意：不建议用于生产）。</p> <p>限流器也可以定义为<code>RateLimiter</code>接口的实现 bean。在配置中，按名称使用SpEL引用bean。<code>#{@myRateLimiter}</code>是引用名为'myRateLimiter'的bean的SpEL表达式。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> requestratelimiter_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">rate-limiter</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@myRateLimiter}&quot;</span>
            <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@userKeyResolver}&quot;</span>
</code></pre></div><h2 id="_5-9-redirectto-gatewayfilter-factory"><a href="#_5-9-redirectto-gatewayfilter-factory" class="header-anchor">#</a> 5.9 RedirectTo GatewayFilter Factory</h2> <p>该过滤器有一个 <code>status</code> 和一个 <code>url</code>参数。status是300类重定向HTTP代码，如301。该URL应为有效的URL，这将是 <code>Location</code> header的值。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> prefixpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RedirectTo=302<span class="token punctuation">,</span> http<span class="token punctuation">:</span>//acme.org
</code></pre></div><p>这将发送一个302状态码和一个<code>Location:http://acme.org</code> header来执行重定向。</p> <h2 id="_5-10-removenonproxyheaders-gatewayfilter-factory"><a href="#_5-10-removenonproxyheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.10 RemoveNonProxyHeaders GatewayFilter Factory</h2> <p>RemoveNonProxyHeaders GatewayFilter Factory 从转发请求中删除headers。删除的默认头列表来自 <a href="https://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-14#section-7.1.3" target="_blank" rel="noopener noreferrer">IETF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>The default removed headers are:</strong></p> <ul><li>Connection</li> <li>Keep-Alive</li> <li>Proxy-Authenticate</li> <li>Proxy-Authorization</li> <li>TE</li> <li>Trailer</li> <li>Transfer-Encoding</li> <li>Upgrade 要更改此设置，请将 <code>spring.cloud.gateway.filter.remove-non-proxy-headers.headers</code>属性设置为要删除的header名称。</li></ul> <h2 id="_5-11-removerequestheader-gatewayfilter-factory"><a href="#_5-11-removerequestheader-gatewayfilter-factory" class="header-anchor">#</a> 5.11 RemoveRequestHeader GatewayFilter Factory</h2> <p>有一个<code>name</code>参数. 这是要删除的header的名称。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removerequestheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoveRequestHeader=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Foo
</code></pre></div><p>这将在<code>X-Request-Foo</code> header被发送到下游之前删除它。</p> <h2 id="_5-12-removeresponseheader-gatewayfilter-factory"><a href="#_5-12-removeresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.12 RemoveResponseHeader GatewayFilter Factory</h2> <p>有一个<code>name</code>参数. 这是要删除的header的名称。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> removeresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RemoveResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo
</code></pre></div><p>这将在返回到网关client之前从响应中删除<code>x-response-foo</code>头。</p> <h2 id="_5-13-rewritepath-gatewayfilter-factory"><a href="#_5-13-rewritepath-gatewayfilter-factory" class="header-anchor">#</a> 5.13 RewritePath GatewayFilter Factory</h2> <p>包含一个 <code>regexp</code>正则表达式参数和一个 <code>replacement</code> 参数. 通过使用Java正则表达式灵活地重写请求路径。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RewritePath=/foo/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">&gt;</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /$\<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>对于请求路径<code>/foo/bar</code>，将在发出下游请求之前将路径设置为<code>/bar</code>。注意,由于YAML规范，请使用 <code>$\</code>替换 <code>$</code>。</p> <h2 id="_5-14-rewriteresponseheader-gatewayfilter-factory"><a href="#_5-14-rewriteresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.14 RewriteResponseHeader GatewayFilter Factory</h2> <p>包含 <code>name</code>, <code>regexp</code>和 <code>replacement</code> 参数.。通过使用Java正则表达式灵活地重写响应头的值。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewriteresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RewriteResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> <span class="token punctuation">,</span> password=<span class="token punctuation">[</span>^&amp;<span class="token punctuation">]</span>+<span class="token punctuation">,</span> password=<span class="token important">***</span>
</code></pre></div><p>对于一个<code>/42?user=ford&amp;password=omg!what&amp;flag=true</code>的header值，在做下游请求时将被设置为<code>/42?user=ford&amp;password=***&amp;flag=true</code>，由于YAML规范，请使用 <code>$\</code>替换 <code>$</code>。</p> <h2 id="_5-15-savesession-gatewayfilter-factory"><a href="#_5-15-savesession-gatewayfilter-factory" class="header-anchor">#</a> 5.15 SaveSession GatewayFilter Factory</h2> <p>SaveSession GatewayFilter Factory将调用转发到下游之<strong>前</strong>强制执行<code>WebSession::save</code> 操作。这在使用 <a href="https://projects.spring.io/spring-session/" target="_blank" rel="noopener noreferrer">Spring Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 之类时特别有用，需要确保会话状态在进行转发调用之前已保存。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> save_session
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SaveSession
</code></pre></div><p>如果你希望要将[Spring Security]（https://projects.spring.io/Spring Security/）与Spring Session集成,并确保安全详细信息已转发到远程的进程，这一点至关重要。</p> <h2 id="_5-16-secureheaders-gatewayfilter-factory"><a href="#_5-16-secureheaders-gatewayfilter-factory" class="header-anchor">#</a> 5.16 SecureHeaders GatewayFilter Factory</h2> <p>SecureHeaders GatewayFilter Factory 将许多headers添加到reccomedation处的响应中，从<a href="https://blog.appcanary.com/2017/http-security-headers.html" target="_blank" rel="noopener noreferrer">this blog post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>添加以下标题（使用默认值分配）:</strong></p> <ul><li><code>X-Xss-Protection:1; mode=block</code></li> <li><code>Strict-Transport-Security:max-age=631138519</code></li> <li><code>X-Frame-Options:DENY</code></li> <li><code>X-Content-Type-Options:nosniff</code></li> <li><code>Referrer-Policy:no-referrer</code></li> <li><code>Content-Security-Policy:default-src 'self' https:; font-src 'self' https: data:; img-src 'self' https: data:; object-src 'none'; script-src https:; style-src 'self' https: 'unsafe-inline'</code></li> <li><code>X-Download-Options:noopen</code></li> <li><code>X-Permitted-Cross-Domain-Policies:none</code></li></ul> <p>要更改默认值，请在<code>spring.cloud.gateway.filter.secure-headers</code> 命名空间中设置相应的属性：</p> <p><strong>Property to change:</strong></p> <ul><li><code>xss-protection-header</code></li> <li><code>strict-transport-security</code></li> <li><code>frame-options</code></li> <li><code>content-type-options</code></li> <li><code>referrer-policy</code></li> <li><code>content-security-policy</code></li> <li><code>download-options</code></li> <li><code>permitted-cross-domain-policies</code></li></ul> <h2 id="_5-17-setpath-gatewayfilter-factory"><a href="#_5-17-setpath-gatewayfilter-factory" class="header-anchor">#</a> 5.17 SetPath GatewayFilter Factory</h2> <p>SetPath GatewayFilter Factory 采用 <code>template</code>路径参数。它提供了一种通过允许路径的模板化segments来操作请求路径的简单方法。使用Spring Framework中的URI模板，允许多个匹配segments。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setpath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetPath=/<span class="token punctuation">{</span>segment<span class="token punctuation">}</span>
</code></pre></div><p>对于一个 <code>/foo/bar</code>请求，在做下游请求前，路径将被设置为<code>/bar</code></p> <h2 id="_5-18-setresponseheader-gatewayfilter-factory"><a href="#_5-18-setresponseheader-gatewayfilter-factory" class="header-anchor">#</a> 5.18 SetResponseHeader GatewayFilter Factory</h2> <p>SetResponseHeader GatewayFilter Factory 包括 <code>name</code> 和 <code>value</code> 参数.</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setresponseheader_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetResponseHeader=X<span class="token punctuation">-</span>Response<span class="token punctuation">-</span>Foo<span class="token punctuation">,</span> Bar
</code></pre></div><p>此GatewayFilter使用给定的名称替换所有header，而不是添加。因此，如果下游服务器响应为<code>X-Response-Foo:1234</code>，则会将其替换为<code>X-Response-Foo:Bar</code>,这是网关客户端将接收的内容。</p> <h2 id="_5-19-setstatus-gatewayfilter-factory"><a href="#_5-19-setstatus-gatewayfilter-factory" class="header-anchor">#</a> 5.19 SetStatus GatewayFilter Factory</h2> <p>SetStatus GatewayFilter Factory 包括唯一的 <code>status</code>参数.必须是一个可用的Spring <code>HttpStatus</code>。它可以是整数值<code>404</code>或字符串枚举<code>NOT_FOUND</code>。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusstring_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=BAD_REQUEST
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusint_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=401
</code></pre></div><p>在这个例子中，HTTP返回码将设置为401.</p> <h2 id="_5-20-stripprefix-gatewayfilter-factory"><a href="#_5-20-stripprefix-gatewayfilter-factory" class="header-anchor">#</a> 5.20 StripPrefix GatewayFilter Factory</h2> <p>StripPrefix GatewayFilter Factory 包括一个<code>parts</code>参数。 <code>parts</code>参数指示在将请求发送到下游之前，要从请求中去除的路径中的节数。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> nameRoot
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//nameservice
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/name/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> StripPrefix=2
</code></pre></div><p>当通过网关发出<code>/name/bar/foo</code>请求时，向<code>nameservice</code>发出的请求将是<code>http://nameservice/foo</code>。</p> <h2 id="_5-21-retry-gatewayfilter-factory"><a href="#_5-21-retry-gatewayfilter-factory" class="header-anchor">#</a> 5.21 Retry GatewayFilter Factory</h2> <p>Retry GatewayFilter Factory包括 <code>retries</code>, <code>statuses</code>, <code>methods</code>和 <code>series</code> 参数.</p> <ul><li><code>retries</code>: 应尝试的重试次数</li> <li><code>statuses</code>: 应该重试的HTTP状态代码，用<code>org.springframework.http.HttpStatus</code>标识</li> <li><code>methods</code>: 应该重试的HTTP方法，用 <code>org.springframework.http.HttpMethod</code>标识</li> <li><code>series</code>: 要重试的一系列状态码，用 <code>org.springframework.http.HttpStatus.Series</code>标识</li></ul> <p><strong>application.yml.</strong></p> <p>spring: cloud: gateway: routes: - id: retry_test uri: http://localhost:8080/flakey predicates: - Host=*.retry.com filters: - name: Retry args: retries: 3 statuses: BAD_GATEWAY</p> <blockquote><p>注意 retry filter 不支持body请求的重试，如通过body的POST 或 PUT请求</p> <p>注意 在使用带有前缀为 <code>forward:</code> 的<code>retry filter</code>时，应仔细编写目标端点，以便在出现错误时不会执行任何可能导致将响应发送到客户端并提交的操作。例如，如果目标端点是带注解的controller，则目标controller方法不应返回带有错误状态代码的<code>ResponseEntity</code>。相反，它应该抛出一个<code>Exception</code>，或者发出一个错误信号，例如通过<code>Mono.error(ex)</code> 返回值，重试过滤器可以配置为通过重试来处理。</p></blockquote> <h2 id="_5-22-requestsize-gatewayfilter-factory"><a href="#_5-22-requestsize-gatewayfilter-factory" class="header-anchor">#</a> 5.22 RequestSize GatewayFilter Factory</h2> <p>当请求大小大于允许的限制时，RequestSize GatewayFilter Factory可以限制请求不到达下游服务。过滤器以<code>RequestSize</code>作为参数，这是定义请求的允许大小限制(以字节为单位)。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> request_size_route
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/upload
      <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> Path=/upload
      <span class="token key atrule">filters</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestSize
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
          <span class="token key atrule">maxSize</span><span class="token punctuation">:</span> <span class="token number">5000000</span>
</code></pre></div><p>当请求因大小而被拒绝时， RequestSize GatewayFilter Factory 将响应状态设置为<code>413 Payload Too Large</code>，并带有额外的header <code>errorMessage</code> 。下面是一个 <code>errorMessage</code>的例子。</p> <div class="language- extra-class"><pre class="language-text"><code>errorMessage` : `Request size is larger than permissible limit. Request size is 6.0 MB where permissible limit is 5.0 MB
</code></pre></div><blockquote><p>注意 如果未在路由定义中作为filter参数提供，则默认请求大小将设置为5 MB。</p></blockquote> <h2 id="_5-23-modify-request-body-gatewayfilter-factory"><a href="#_5-23-modify-request-body-gatewayfilter-factory" class="header-anchor">#</a> 5.23 Modify Request Body GatewayFilter Factory</h2> <p>这个过滤器被定义为beta版本，将来API可能会改变。</p> <p>此过滤器可用于在请求主体被网关发送到下游之前对其进行修改。</p> <blockquote><p>注意 只能使用Java DSL配置此过滤器</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
public RouteLocator routes(RouteLocatorBuilder builder) <span class="token punctuation">{</span>
    return builder.routes()
        .route(&quot;rewrite_request_obj&quot;<span class="token punctuation">,</span> r <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> r.host(&quot;<span class="token important">*.rewriterequestobj.org&quot;)</span>
            .filters(f <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> f.prefixPath(&quot;/httpbin&quot;)
                .modifyRequestBody(String.class<span class="token punctuation">,</span> Hello.class<span class="token punctuation">,</span> MediaType.APPLICATION_JSON_VALUE<span class="token punctuation">,</span>
                    (exchange<span class="token punctuation">,</span> s) <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> return Mono.just(new Hello(s.toUpperCase())))).uri(uri))
        .build();
<span class="token punctuation">}</span>

static class Hello <span class="token punctuation">{</span>
    String message;

    public Hello() <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    public Hello(String message) <span class="token punctuation">{</span>
        this.message = message;
    <span class="token punctuation">}</span>

    public String getMessage() <span class="token punctuation">{</span>
        return message;
    <span class="token punctuation">}</span>

    public void setMessage(String message) <span class="token punctuation">{</span>
        this.message = message;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-24-modify-response-body-gatewayfilter-factory"><a href="#_5-24-modify-response-body-gatewayfilter-factory" class="header-anchor">#</a> 5.24 Modify Response Body GatewayFilter Factory</h2> <p>这个过滤器被定义为beta版本，将来API可能会改变。 此过滤器可用于在将响应正文发送回客户端之前对其进行修改。</p> <blockquote><p>注意 只能使用Java DSL配置此过滤器</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code>@Bean
public RouteLocator routes(RouteLocatorBuilder builder) <span class="token punctuation">{</span>
    return builder.routes()
        .route(&quot;rewrite_response_upper&quot;<span class="token punctuation">,</span> r <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> r.host(&quot;<span class="token important">*.rewriteresponseupper.org&quot;)</span>
            .filters(f <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> f.prefixPath(&quot;/httpbin&quot;)
                .modifyResponseBody(String.class<span class="token punctuation">,</span> String.class<span class="token punctuation">,</span>
                    (exchange<span class="token punctuation">,</span> s) <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Mono.just(s.toUpperCase()))).uri(uri)
        .build();
<span class="token punctuation">}</span>
</code></pre></div><h1 id="_6-global-filters"><a href="#_6-global-filters" class="header-anchor">#</a> 6. Global Filters</h1> <p><code>GlobalFilter</code>接口与<code>GatewayFilter</code>具有相同的签名。是有条件地应用于所有路由的特殊过滤器。（此接口和用法可能在将来的里程碑版本中发生更改）。</p> <h2 id="_6-1-全局filter和gatewayfilter组合排序"><a href="#_6-1-全局filter和gatewayfilter组合排序" class="header-anchor">#</a> 6.1 全局Filter和GatewayFilter组合排序</h2> <p>当请求进入（并与路由匹配）时，筛选Web Handler 会将<code>GlobalFilter</code>的所有实例和所有的<code>GatewayFilter</code>路由特定实例添加到 filter chain。filter组合的排序由<code>org.springframework.core.Ordered</code>接口决定，可以通过实现<code>getOrde()</code>方法或使用<code>@Order</code>注释来设置。</p> <p>由于Spring Cloud Gateway将用于执行过滤器逻辑区分为“前置”和“后置”阶段，具有最高优先级的过滤器将是“前置”阶段的第一个，而“后置”阶段的最后一个。</p> <p><strong>ExampleConfiguration.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;first pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;third post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;second pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;second post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">GlobalFilter</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;third pre filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;first post filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-2-forward-routing-filter"><a href="#_6-2-forward-routing-filter" class="header-anchor">#</a> 6.2 Forward Routing Filter</h2> <p><code>ForwardRoutingFilter</code>在exchange属性<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>中查找URI。如果URL有一个<code>forward</code>scheme (如 <code>forward:///localendpoint</code>)，它将使用Spring <code>DispatcherHandler</code> 来处理请求。请求URL的路径部分将被转发URL中的路径覆盖。未修改的原始URL将附加到 <code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR</code>属性中的列表中。</p> <h2 id="_6-3-loadbalancerclient-filter"><a href="#_6-3-loadbalancerclient-filter" class="header-anchor">#</a> 6.3 LoadBalancerClient Filter</h2> <p><code>LoadBalancerClientFilter</code>在exchange属性<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>中查找URI。如果URL有一个<code>lb</code>scheme (如 <code>lb://myservice</code>），它将使用Spring Cloud <code>LoadBalancerClient</code> 将名称（在前一个示例中为'myservice<code>）解析为实际主机和端口，并替换URI。未修改的原始URL将附加到</code>ServerWebExchangeUtils.GATEWAY_ORIGINAL_REQUEST_URL_ATTR<code>属性中的列表中。过滤器还将查看</code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR<code>属性，查看它是否等于</code>lb`，然后应用相同的规则。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> myRoute
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//service
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/service/<span class="token important">**</span>
</code></pre></div><blockquote><p>注意 默认情况下，如果一个服务实例在<code>LoadBalancer</code> 中没有发现，则返回503。可以通过设置<code>spring.cloud.gateway.loadbalancer.use404=true</code>来让网管返回404.</p> <p>注意</p></blockquote> <p>从<code>LoadBalancer</code>返回的<code>ServiceInstance</code>的<code>isSecure</code> 值将覆盖在对网关发出的请求中指定的scheme。例如，如果请求通过<code>HTTPS</code>进入网关，但<code>ServiceInstance</code>表示它不安全，则下游请求将通过<code>HTTP</code>协议。相反的情况也适用。但是，如果在网关配置中为路由指定了<code>GATEWAY_SCHEME_PREFIX_ATTR</code>，则前缀将被删除，并且路由URL生成的scheme将覆盖<code>ServiceInstance</code>配置。</p> <h2 id="_6-4-netty-routing-filter"><a href="#_6-4-netty-routing-filter" class="header-anchor">#</a> 6.4 Netty Routing Filter</h2> <p>如果位于 <code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>属性中的URL具有<code>http</code> 或<code>https</code> 模式，则会运行Netty Routing Filter。它使用Netty <code>HttpClient</code> 发出下游代理请求。响应放在 <code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchange属性中，以便在以后的过滤器中使用。（有一个实验阶段不需要Netty的相同的功能的Filter，<code>WebClientHttpRoutingFilter</code>）</p> <h2 id="_6-5-netty-write-response-filter"><a href="#_6-5-netty-write-response-filter" class="header-anchor">#</a> 6.5 Netty Write Response Filter</h2> <p>如果<code>ServerWebExchangeUtils.CLIENT_RESPONSE_ATTR</code> exchange属性中存在 Netty <code>HttpClientResponse</code>，则运行 <code>NettyWriteResponseFilter</code> 。它在其他所有过滤器完成后将代理响应写回网关客户端响应之后运行。（有一个不需要netty的实验性的<code>WebClientWriteResponseFilter</code>执行相同的功能）</p> <h2 id="_6-6-routetorequesturl-filter"><a href="#_6-6-routetorequesturl-filter" class="header-anchor">#</a> 6.6 RouteToRequestUrl Filter</h2> <p>如果<code>ServerWebExchangeUtils.GATEWAY_ROUTE_ATTR</code> exchange属性中存在<code>Route</code>对象，<code>RouteToRequestUrlFilter</code>将运行。它基于请求URI创建一个新的URI，使用<code>Route</code>对象的uri属性进行更新。新的URI被放置在<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code> exchange属性中。</p> <p>如果该URI有一个前缀scheme，例如<code>lb:ws://serviceid</code>，则会从该URI中剥离该 <code>lb</code> scheme，并将其放置在<code>ServerWebExchangeUtils.GATEWAY_SCHEME_PREFIX_ATTR</code>中，以便稍后在过滤器链中使用。</p> <h2 id="_6-7-websocket-routing-filter"><a href="#_6-7-websocket-routing-filter" class="header-anchor">#</a> 6.7 Websocket Routing Filter</h2> <p>如果<code>ServerWebExchangeUtils.GATEWAY_REQUEST_URL_ATTR</code>exchange属性中有 <code>ws</code> 、 <code>wss</code>scheme，则Websocket Routing Filter将被运行。它使用Spring Web Socket基础模块将Websocket转发到下游。</p> <p>URI前缀为<code>lb</code>的Websockets可以被负载均衡，如 <code>lb:ws://serviceid</code>.</p> <blockquote><p>注意 如果使用 <a href="https://github.com/sockjs" target="_blank" rel="noopener noreferrer">SockJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 作为普通HTTP的fallback，则应配置普通HTTP路由以及WebSocket路由。</p></blockquote> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token comment"># SockJS route</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_sockjs_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/websocket/info/<span class="token important">**</span>
      <span class="token comment"># Normwal Websocket route</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> websocket_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/websocket/<span class="token important">**</span>
</code></pre></div><h2 id="_6-8-gateway-metrics-filter"><a href="#_6-8-gateway-metrics-filter" class="header-anchor">#</a> 6.8 Gateway Metrics Filter</h2> <p>要启用网关指标，请将spring-boot-starter-actuator添加为项目依赖项。然后，默认情况下，只要属性<code>spring.cloud.gateway.metrics.enabled</code>未设置为<code>false</code>，网关指标过滤器就会运行。此过滤器添加名为“gateway.requests”的计时器指标，并带有以下标记：</p> <ul><li><code>routeId</code>: The route id</li> <li><code>routeUri</code>:  API 将被转发的URI</li> <li><code>outcome</code>: 结果分类依据 <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.Series.html" target="_blank" rel="noopener noreferrer">HttpStatus.Series<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>status</code>: 返回client的请求的Http Status</li></ul> <p>这些指标可以从<code>/actuator/metrics/gateway.requests</code>中获取，可以很容易地与Prometheus集成以创建<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/images/gateway-grafana-dashboard.jpeg" target="_blank" rel="noopener noreferrer">Grafana<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/gateway-grafana-dashboard.json" target="_blank" rel="noopener noreferrer">dashboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>注意 要将pometheus启用，需要添加 micrometer-registry-prometheus为项目依赖。</p></blockquote> <h2 id="_6-9-making-an-exchange-as-routed"><a href="#_6-9-making-an-exchange-as-routed" class="header-anchor">#</a> 6.9 Making An Exchange As Routed</h2> <p>网关路由<code>ServerWebExchange</code>之后，它将通过向Exchange属性添加<code>gatewayAlreadyRouted</code>，将该exchange标记为“routed”。一旦一个请求被标记为routed，其他路由过滤器将不会再次路由该请求，将跳过该过滤器。有一些方便的方法可以用来将exchange标记为routed，或者检查exchange是否已经routed。</p> <ul><li><code>ServerWebExchangeUtils.isAlreadyRouted</code> 有一个 <code>ServerWebExchange</code>对象并检查它是否已&quot;routed&quot;</li> <li><code>ServerWebExchangeUtils.setAlreadyRouted</code> 有一个 <code>ServerWebExchange</code> 对象并将其标记为&quot;routed&quot;</li></ul> <h1 id="_7-tls-ssl"><a href="#_7-tls-ssl" class="header-anchor">#</a> 7. TLS / SSL</h1> <p>网关可以通过常规的 Spring server configuration 来侦听HTTPS上的请求。例子：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">key-alias</span><span class="token punctuation">:</span> scg
    <span class="token key atrule">key-store-password</span><span class="token punctuation">:</span> scg1234
    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>scg<span class="token punctuation">-</span>keystore.p12
    <span class="token key atrule">key-store-type</span><span class="token punctuation">:</span> PKCS12
</code></pre></div><p>网关路由可以路由到HTTP和HTTPS后端。如果路由到HTTPS后端，则可以将网关配置为信任所有具有证书的下游服务：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">useInsecureTrustManager</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>不建议在生产环境使用不安全的信任管理器。对于生产部署，可以使用一组已知证书配置网关，这些证书可以通过以下方式进行配置：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">trustedX509Certificates</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> cert1.pem
          <span class="token punctuation">-</span> cert2.pem
</code></pre></div><p>如果Spring Cloud Gateway未配置受信任证书，则使用默认信任库（可以使用系统属性javax.net.ssl.trustStore覆盖）。</p> <h2 id="_7-1-tls-握手"><a href="#_7-1-tls-握手" class="header-anchor">#</a> 7.1 TLS 握手</h2> <p>网关维护一个用于路由到后端的client池。当通过HTTPS通信时，客户端启动一个TLS握手，其中可能会有很多超时。这些超时可以这样配置（显示默认值）：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpclient</span><span class="token punctuation">:</span>
        <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
          <span class="token key atrule">handshake-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">10000</span>
          <span class="token key atrule">close-notify-flush-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">3000</span>
          <span class="token key atrule">close-notify-read-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre></div><h1 id="_8-configuration"><a href="#_8-configuration" class="header-anchor">#</a> 8. Configuration</h1> <p>Spring Cloud Gateway的配置由<code>RouteDefinitionLocator</code>的集合驱动。</p> <p><strong>RouteDefinitionLocator.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RouteDefinitionLocator</span> <span class="token punctuation">{</span>
    <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RouteDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRouteDefinitions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，<code>PropertiesRouteDefinitionLocator</code>使用Spring Boot的<code>@ConfigurationProperties</code>机制加载属性。</p> <p>以下两个示例是等效的：</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatus_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SetStatus
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token number">401</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> setstatusshortcut_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> SetStatus=401
</code></pre></div><p>对于网关的大部分用法，配置文件方式是够用的，但一些生产用例更建议从外部源（如数据库）加载配置。未来的里程碑版本将有基于Spring Data Repositories （如Redis、<a href="https://cloud.tencent.com/product/mongodb?from=10680" target="_blank" rel="noopener noreferrer">MongoDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和Cassandra）的<code>RouteDefinitionLocator</code>实现。</p> <h2 id="_8-1-fluent-java-routes-api"><a href="#_8-1-fluent-java-routes-api" class="header-anchor">#</a> 8.1 Fluent Java Routes API</h2> <p>为了可以更简单在Java中配置，在<code>RouteLocatorBuilder</code> bean中定义了一个fluent API。</p> <p><strong>GatewaySampleApplication.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// static imports from GatewayFilters and RoutePredicates</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RouteLocator</span> <span class="token function">customRouteLocator</span><span class="token punctuation">(</span><span class="token class-name">RouteLocatorBuilder</span> builder<span class="token punctuation">,</span> <span class="token class-name">ThrottleGatewayFilterFactory</span> throttle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.abc.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/png&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span>
                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-TestHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/image/webp&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span>
                        f<span class="token punctuation">.</span><span class="token function">addResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-AnotherHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token string">&quot;**.throttle.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filters</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>throttle<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token number">10</span><span class="token punctuation">,</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://httpbin.org:80&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种样式还允许使用更多的自定义断言。由<code>RouteDefinitionLocator</code> beans定义的断言使用逻辑 <code>and</code>组合。通过使用fluent Java API，可以在 <code>Predicate</code>类上使用 <code>and()</code>、<code>or()</code> 、 <code>negate()</code>运算符。</p> <h2 id="_8-2-discoveryclient-route-definition-locator"><a href="#_8-2-discoveryclient-route-definition-locator" class="header-anchor">#</a> 8.2 DiscoveryClient Route Definition Locator</h2> <p>可以将网关配置为基于使用兼容<code>DiscoveryClient</code>注册中心注册的服务来创建路由。</p> <p>要启用此功能，请设置<code>spring.cloud.gateway.discovery.locator.enabled=true</code>，并确保<code>DiscoveryClient</code>实现位于classpath上并已启用（如netflix eureka、consul或zookeeper）。</p> <h3 id="_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes"><a href="#_8-2-1-configuring-predicates-and-filters-for-discoveryclient-routes" class="header-anchor">#</a> 8.2.1 Configuring Predicates and Filters For DiscoveryClient Routes</h3> <p>默认情况下，网关为通过<code>DiscoveryClient</code>创建的路由定义单个断言和过滤器。</p> <p>默认断言是使用<code>/serviceId/**</code>定义的path断言，其中<code>serviceId</code>是<code>DiscoveryClient</code>中服务的ID。</p> <p>默认过滤器是使用正则表达式 <code>/serviceId/(?&lt;remaining&gt;.*)</code>和替换的<code>/${remaining}</code>进行重写。这只是在请求被发送到下游之前从路径中截取掉 service id 。</p> <p>可以通过设置<code>spring.cloud.gateway.discovery.locator.predicates[x]</code> and <code>spring.cloud.gateway.discovery.locator.filters[y]</code>来实现自定义<code>DiscoveryClient</code>路由使用的断言and/or过滤器。当你这样做时，如果你想要保留这个功能，你需要确保包括上面的默认断言和过滤器。下面是这样一个例子。</p> <p><strong>application.properties.</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[0].name</span><span class="token punctuation">:</span> <span class="token attr-value">Path</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[0].args[pattern]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/'+serviceId+'/**'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[1].name</span><span class="token punctuation">:</span> <span class="token attr-value">Host</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.predicates[1].args[pattern]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'**.foo.com'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[0].name</span><span class="token punctuation">:</span> <span class="token attr-value">Hystrix</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[0].args[name]</span><span class="token punctuation">:</span> <span class="token attr-value">serviceId</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].name</span><span class="token punctuation">:</span> <span class="token attr-value">RewritePath</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].args[regexp]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/' + serviceId + '/(?&lt;remaining&gt;.*)'&quot;</span>
<span class="token attr-name">spring.cloud.gateway.discovery.locator.filters[1].args[replacement]</span><span class="token punctuation">:</span> <span class="token attr-value">&quot;'/${remaining}'&quot;</span>
</code></pre></div><h1 id="_9-reactor-netty-access-logs"><a href="#_9-reactor-netty-access-logs" class="header-anchor">#</a> 9. Reactor Netty Access Logs</h1> <p>设置 <code>-Dreactor.netty.http.server.accessLogEnabled=true</code> 来开启Reactor Netty access logs，注意必须是Java System Property而不是Spring Boot property。</p> <p>logging 模块也可以通过配置单独输出一个access log文件，下面是logback的配置例子：</p> <p><strong>logback.xml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code> &lt;appender name=&quot;accessLog&quot; class=&quot;ch.qos.logback.core.FileAppender&quot;<span class="token punctuation">&gt;</span>
        &lt;file<span class="token punctuation">&gt;</span>access_log.log&lt;/file<span class="token punctuation">&gt;</span>
        &lt;encoder<span class="token punctuation">&gt;</span>
            &lt;pattern<span class="token punctuation">&gt;</span>%msg%n&lt;/pattern<span class="token punctuation">&gt;</span>
        &lt;/encoder<span class="token punctuation">&gt;</span>
    &lt;/appender<span class="token punctuation">&gt;</span>
    &lt;appender name=&quot;async&quot; class=&quot;ch.qos.logback.classic.AsyncAppender&quot;<span class="token punctuation">&gt;</span>
        &lt;appender<span class="token punctuation">-</span>ref ref=&quot;accessLog&quot; /<span class="token punctuation">&gt;</span>
    &lt;/appender<span class="token punctuation">&gt;</span>

    &lt;logger name=&quot;reactor.netty.http.server.AccessLog&quot; level=&quot;INFO&quot; additivity=&quot;false&quot;<span class="token punctuation">&gt;</span>
        &lt;appender<span class="token punctuation">-</span>ref ref=&quot;async&quot;/<span class="token punctuation">&gt;</span>
    &lt;/logger<span class="token punctuation">&gt;</span>
</code></pre></div><h1 id="_10-cors-configuration"><a href="#_10-cors-configuration" class="header-anchor">#</a> 10. CORS Configuration</h1> <p>我们可以通过配置网关来控制CORS行为，全局CORS配置是 <a href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" target="_blank" rel="noopener noreferrer">Spring Framework <code>CorsConfiguration</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>模式的URL MAP。</p> <p><strong>application.yml.</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">corsConfigurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;http://docs.spring.io&quot;</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> GET
</code></pre></div><p>例子中将允许从docs.spring.io发出的所有GET请求进行CORS请求。</p> <h1 id="_11-actuator-api"><a href="#_11-actuator-api" class="header-anchor">#</a> 11. Actuator API</h1> <p><code>/gateway</code>的actuator端点允许监视Spring Cloud Gateway应用程序并与之交互。要进行远程访问，必须在应用程序属性中暴露HTTP或JMX 端口。</p> <p><strong>application.properties.</strong></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">management.endpoint.gateway.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true # default value</span>
<span class="token attr-name">management.endpoints.web.exposure.include</span><span class="token punctuation">=</span><span class="token attr-value">gateway</span>
</code></pre></div><h2 id="_11-1-retrieving-route-filters"><a href="#_11-1-retrieving-route-filters" class="header-anchor">#</a> 11.1 Retrieving route filters</h2> <h3 id="_11-1-1-global-filters"><a href="#_11-1-1-global-filters" class="header-anchor">#</a> 11.1.1 Global Filters</h3> <p>要检索应用于所有路由的 [global filters]，请get请求 <code>/actuator/gateway/globalfilters</code>。返回的结果类似于以下内容：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5&quot;</span><span class="token operator">:</span> <span class="token number">10100</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@4f6fd101&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@32d22650&quot;</span><span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.ForwardRoutingFilter@106459d9&quot;</span><span class="token operator">:</span> <span class="token number">2147483647</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.NettyRoutingFilter@1fbd5e0&quot;</span><span class="token operator">:</span> <span class="token number">2147483647</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.ForwardPathFilter@33a71d23&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@135064ea&quot;</span><span class="token operator">:</span> <span class="token number">2147483637</span><span class="token punctuation">,</span>
  <span class="token property">&quot;org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@23c05889&quot;</span><span class="token operator">:</span> <span class="token number">2147483646</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回结果包含已就绪的global filters的详细信息(如 <code>org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@77856cc5</code>)。对于每个global filters，返回结果字符串对应过滤器链中的相应顺序。</p> <h3 id="_11-1-2-route-filters"><a href="#_11-1-2-route-filters" class="header-anchor">#</a> 11.1.2 Route Filters</h3> <p>要检索应用于路由的 [GatewayFilter factories] ，请get请求<code>/actuator/gateway/routefilters</code>。返回结果类似于以下内容：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;[AddRequestHeaderGatewayFilterFactory@570ed9c configClass = AbstractNameValueGatewayFilterFactory.NameValueConfig]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;[SaveSessionGatewayFilterFactory@4449b273 configClass = Object]&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回结果包含应用于所有路由的GatewayFilter的详细信息。显示每个工厂提供字符串格式的相应对象（例如， <code>[SecureHeadersGatewayFilterFactory@fceab5d configClass = Object]</code>）。请注意，<code>null</code>值是由于endpoint controller实现不完整造成的，因为它尝试在filter chain中设置对象的顺序，这不适用于GatewayFilter工厂对象。</p> <h2 id="_11-2-refreshing-the-route-cache"><a href="#_11-2-refreshing-the-route-cache" class="header-anchor">#</a> 11.2 Refreshing the route cache</h2> <p>如果要清理路由的缓存，请POST请求<code>/actuator/gateway/refresh</code>。该请求将返回一个没有body的200返回码。</p> <h2 id="_11-3-retrieving-the-routes-defined-in-the-gateway"><a href="#_11-3-retrieving-the-routes-defined-in-the-gateway" class="header-anchor">#</a> 11.3 Retrieving the routes defined in the gateway</h2> <p>要检索网关中定义的路由，发送GET请求<code>/actuator/gateway/routes</code>，返回结果如下所示：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;route_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;first_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;route_object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;predicate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@1e9d7e7d&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;OrderedGatewayFilter{delegate=org.springframework.cloud.gateway.filter.factory.PreserveHostHeaderGatewayFilterFactory$$Lambda$436/674480275@6631ef72, order=0}&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;route_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;second_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;route_object&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;predicate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory$$Lambda$432/1736826640@cd8d298&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>返回结果中包含网关中所有定义的路由信息，下面表格中描述了返回结果信息：</p> <table><thead><tr><th style="text-align:left;">Path</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>route_id</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The route ID.</td></tr> <tr><td style="text-align:left;"><code>route_object.predicate</code></td> <td style="text-align:left;">Object</td> <td style="text-align:left;">The route predicate.</td></tr> <tr><td style="text-align:left;"><code>route_object.filters</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The <a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#gatewayfilter-factories" target="_blank" rel="noopener noreferrer"><code>GatewayFilter</code> factories<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> applied to the route.</td></tr> <tr><td style="text-align:left;"><code>order</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">The route order.</td></tr></tbody></table> <h2 id="_11-4-retrieving-information-about-a-particular-route"><a href="#_11-4-retrieving-information-about-a-particular-route" class="header-anchor">#</a> 11.4 Retrieving information about a particular route</h2> <p>要获取单个路由的信息，发送GET请求 <code>/actuator/gateway/routes/{id}</code> (如： <code>/actuator/gateway/routes/first_route</code>)，返回结果如下所示：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;first_route&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;predicates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;_genkey_0&quot;</span><span class="token operator">:</span><span class="token string">&quot;/first&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;filters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://www.uri-destination.org&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>下面表格中描述了返回结果信息：</p> <table><thead><tr><th style="text-align:left;">Path</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>id</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The route ID.</td></tr> <tr><td style="text-align:left;"><code>predicates</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The collection of route predicates. Each item defines the name and the arguments of a given predicate.</td></tr> <tr><td style="text-align:left;"><code>filters</code></td> <td style="text-align:left;">Array</td> <td style="text-align:left;">The collection of filters applied to the route.</td></tr> <tr><td style="text-align:left;"><code>uri</code></td> <td style="text-align:left;">String</td> <td style="text-align:left;">The destination URI of the route.</td></tr> <tr><td style="text-align:left;"><code>order</code></td> <td style="text-align:left;">Number</td> <td style="text-align:left;">The route order.</td></tr></tbody></table> <h2 id="_11-5-creating-and-deleting-a-particular-route"><a href="#_11-5-creating-and-deleting-a-particular-route" class="header-anchor">#</a> 11.5 Creating and deleting a particular route</h2> <p>要创建一个路由，发送POST请求 <code>/gateway/routes/{id_route_to_create}</code>，参数为JSON结构，具体参数数据结构参考上面章节。</p> <p>要删除一个路由，发送 <code>DELETE</code>请求 <code>/gateway/routes/{id_route_to_delete}</code>。</p> <h2 id="_11-6-recap-list-of-all-endpoints"><a href="#_11-6-recap-list-of-all-endpoints" class="header-anchor">#</a> 11.6 Recap: list of all endpoints</h2> <p>下表总结了Spring Cloud Gateway actuator endpoints。注意，每个endpoint都是<code>/actuator/gateway</code>作为基本路径。</p> <table><thead><tr><th style="text-align:left;">ID</th> <th style="text-align:left;">HTTP Method</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>globalfilters</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of global filters applied to the routes.</td></tr> <tr><td style="text-align:left;"><code>routefilters</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of <code>GatewayFilter</code> factories applied to a particular route.</td></tr> <tr><td style="text-align:left;"><code>refresh</code></td> <td style="text-align:left;">POST</td> <td style="text-align:left;">Clears the routes cache.</td></tr> <tr><td style="text-align:left;"><code>routes</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays the list of routes defined in the gateway.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">GET</td> <td style="text-align:left;">Displays information about a particular route.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">POST</td> <td style="text-align:left;">Adds a new route to the gateway.</td></tr> <tr><td style="text-align:left;"><code>routes/{id}</code></td> <td style="text-align:left;">DELETE</td> <td style="text-align:left;">Removes an existing route from the gateway.</td></tr></tbody></table> <h1 id="_12-developer-guide"><a href="#_12-developer-guide" class="header-anchor">#</a> 12. Developer Guide</h1> <p>TODO: overview of writing custom integrations</p> <h2 id="_12-1-writing-custom-route-predicate-factories"><a href="#_12-1-writing-custom-route-predicate-factories" class="header-anchor">#</a> 12.1 Writing Custom Route Predicate Factories</h2> <p>TODO: document writing Custom Route Predicate Factories</p> <h2 id="_12-2-writing-custom-gatewayfilter-factories"><a href="#_12-2-writing-custom-gatewayfilter-factories" class="header-anchor">#</a> 12.2 Writing Custom GatewayFilter Factories</h2> <p>如果要自定义一个GatewayFilter，需要实现<code>GatewayFilterFactory</code>。下面是一个你需要集成的抽象类 <code>AbstractGatewayFilterFactory</code>。</p> <p><strong>PreGatewayFilterFactory.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PreGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PreGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// grab configuration from Config object</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//If you want to build a &quot;pre&quot; filter you need to manipulate the</span>
            <span class="token comment">//request before calling chain.filter</span>
            <span class="token class-name">ServerHttpRequest<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//use builder to manipulate the request</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token comment">//Put the configuration properties for your filter here</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostGatewayFilterFactory.java.</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PostGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">PostGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// grab configuration from Config object</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//Manipulate the response in some way</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
        <span class="token comment">//Put the configuration properties for your filter here</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_12-3-writing-custom-global-filters"><a href="#_12-3-writing-custom-global-filters" class="header-anchor">#</a> 12.3 Writing Custom Global Filters</h2> <p>TODO: document writing Custom Global Filters</p> <h2 id="_12-4-writing-custom-route-locators-and-writers"><a href="#_12-4-writing-custom-route-locators-and-writers" class="header-anchor">#</a> 12.4 Writing Custom Route Locators and Writers</h2> <p>TODO: document writing Custom Route Locators and Writers</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/02/09, 14:16:28</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/f0610e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Spring Cloud Gateway 配置大全</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/f0610e/" class="prev">Spring Cloud Gateway 配置大全</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:785056500@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/heyuqiang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2022
    <span>PigxCloud, Inc.</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.31569fb0.js" defer></script><script src="/assets/js/2.df69d635.js" defer></script><script src="/assets/js/120.b2f1f2eb.js" defer></script>
  </body>
</html>
