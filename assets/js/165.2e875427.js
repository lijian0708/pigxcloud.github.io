(window.webpackJsonp=window.webpackJsonp||[]).push([[165],{633:function(s,t,e){"use strict";e.r(t);var a=e(29),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker-compose-入门"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-入门"}},[s._v("#")]),s._v(" Docker Compose 入门")]),s._v(" "),e("h2",{attrs:{id:"术语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[s._v("#")]),s._v(" 术语")]),s._v(" "),e("p",[s._v("首先介绍几个术语。")]),s._v(" "),e("ul",[e("li",[s._v("服务 ("),e("code",[s._v("service")]),s._v(")：一个应用容器，实际上可以运行多个相同镜像的实例。")]),s._v(" "),e("li",[s._v("项目 ("),e("code",[s._v("project")]),s._v(")：由一组关联的应用容器组成的一个完整业务单元。")])]),s._v(" "),e("p",[s._v("可见，一个项目可以由多个服务（容器）关联而成，"),e("code",[s._v("Compose")]),s._v(" 面向项目进行管理。")]),s._v(" "),e("h2",{attrs:{id:"场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[s._v("#")]),s._v(" 场景")]),s._v(" "),e("p",[s._v("在这个页面上，您构建了一个运行在 "),e("code",[s._v("Docker Compose")]),s._v(" 上的简单 Python web 应用程序。 该应用程序使用了 "),e("code",[s._v("Flask")]),s._v(" 框架，并在 "),e("code",[s._v("Redis")]),s._v(" 维护了一个点击计数器。 虽然示例使用 "),e("code",[s._v("Python")]),s._v("，但这里演示的概念应该是可以理解的，即使您不熟悉它。")]),s._v(" "),e("h2",{attrs:{id:"web-应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-应用"}},[s._v("#")]),s._v(" Web 应用")]),s._v(" "),e("h3",{attrs:{id:"第一步-设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一步-设置"}},[s._v("#")]),s._v(" 第一步: 设置")]),s._v(" "),e("p",[s._v("定义应用程序的依赖关系。")]),s._v(" "),e("p",[s._v("1.为项目创建一个目录:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" composetest\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" composetest\n")])])]),e("p",[s._v("2.在项目目录中创建一个名为 app.py 的文件")]),s._v(" "),e("div",{staticClass:"language-py extra-class"},[e("pre",{pre:!0,attrs:{class:"language-py"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" time\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" redis\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n\napp "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncache "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_hit_count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    retries "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cache"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("incr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" redis"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exceptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ConnectionError "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" exc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" retries "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" exc\n            retries "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sleep"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    count "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_hit_count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello World! I have been seen {} times.\\n'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),e("p",[s._v("在本例中，redis 是应用程序网络上 redis 容器的主机名。 我们使用 Redis 的默认端口，6379。")]),s._v(" "),e("h3",{attrs:{id:"第二步-创建一个-dockerfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二步-创建一个-dockerfile"}},[s._v("#")]),s._v(" 第二步: 创建一个 Dockerfile")]),s._v(" "),e("p",[s._v("在这个步骤中，您将编写一个 "),e("code",[s._v("Dockerfile")]),s._v(" 来构建一个 "),e("code",[s._v("Docker")]),s._v(" 映像。 映像包含 "),e("code",[s._v("Python")]),s._v(" 应用程序所需的所有依赖项，包括 "),e("code",[s._v("Python")]),s._v(" 本身。")]),s._v(" "),e("p",[s._v("在项目目录中，创建一个名为 "),e("code",[s._v("Dockerfile")]),s._v(" 的文件，并粘贴以下内容:")]),s._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" python:3.7-alpine")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /code")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_APP app.py")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" FLASK_RUN_HOST 0.0.0.0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apk add --no-cache gcc musl-dev linux-headers")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" requirements.txt requirements.txt")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pip install -r requirements.txt")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flask"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v("]")]),s._v("\n")])])]),e("h3",{attrs:{id:"第三步-在-compose-file中定义服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三步-在-compose-file中定义服务"}},[s._v("#")]),s._v(" 第三步: 在 Compose file中定义服务")]),s._v(" "),e("p",[s._v("在项目目录中创建一个名为 "),e("code",[s._v("docker-compose.yml")]),s._v(" 的文件，并粘贴以下内容:")]),s._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5000:5000"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis:alpine"')]),s._v("\n")])])]),e("p",[s._v("这个Compose file定义了两个服务: "),e("code",[s._v("web")]),s._v(" 和 "),e("code",[s._v("redis")]),s._v("。")]),s._v(" "),e("h4",{attrs:{id:"web-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-service"}},[s._v("#")]),s._v(" web service")]),s._v(" "),e("p",[s._v("网络服务这个网络服务使用了一个来自 Dockerfile 的工作目录图片。 然后将容器和主机绑定到公开端口5000。 此示例服务使用 Flask web 服务器的默认端口5000。")]),s._v(" "),e("h4",{attrs:{id:"redis-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-service"}},[s._v("#")]),s._v(" Redis service")]),s._v(" "),e("p",[s._v("Redis 服务使用从 Docker Hub 仓库提取的公共 Redis 镜像。")]),s._v(" "),e("h3",{attrs:{id:"第四步-用-compose-构建和运行你的应用程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第四步-用-compose-构建和运行你的应用程序"}},[s._v("#")]),s._v(" 第四步: 用 Compose 构建和运行你的应用程序")]),s._v(" "),e("p",[s._v("1.在项目目录中，通过运行 "),e("code",[s._v("docker-compose up")]),s._v(" 启动应用程序。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up\nCreating composetest_redis_1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nCreating composetest_web_1   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nAttaching to composetest_redis_1, composetest_web_1\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":C "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.313 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":C "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.313 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis version=5.0.8, bits=64, commit=00000000, modified=0, pid=1, just started")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":C "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.313 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 * Running "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("standalone, "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(".\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Server initialized")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.")]),s._v("\nredis_1  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":M "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" Mar "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":20:55.314 * Ready to accept connections\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  * Serving Flask app "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.py"')]),s._v("\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  * Environment: production\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    WARNING: This is a development server. Do not use it "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a production deployment.\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    Use a production WSGI server instead.\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  * Debug mode: off\nweb_1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  * Running on http://0.0.0.0:5000/ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),e("p",[s._v("Compose 会拉取 Redis 镜像，为您的代码构建一个镜像，并启动您定义的服务。 在这种情况下，代码在构建时静态地复制到镜像中。")]),s._v(" "),e("p",[s._v("2.在浏览器中输入 "),e("code",[s._v("http://localhost:5000/")]),s._v(" ，查看应用程序的运行情况。")]),s._v(" "),e("p",[s._v("你应该在浏览器中看到这样一条消息:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Hello World! I have been seen 1 times.\n")])])]),e("p",[s._v("每次刷新页面，计数就会加 1。")]),s._v(" "),e("p",[s._v("3.切换到另一个终端窗口，并键入 "),e("code",[s._v("docker image ls")]),s._v(" 列出本地映像。 此时列出的图像应该返回 "),e("code",[s._v("redis")]),s._v(" 和 "),e("code",[s._v("web")]),s._v("。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ncomposetest_web     latest              1253fe08c58d        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" hours ago         220MB\npython              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v("-alpine          7fbc871584eb        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" days ago          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),s._v(".8MB\nredis               alpine              5c5637d8a823        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" days ago          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".8MB\n")])])]),e("p",[s._v("4.停止应用程序，要么在第二个终端中从项目目录中运行 docker-compose down，要么在启动应用程序的原始终端中按 ctrl + c。")]),s._v(" "),e("h3",{attrs:{id:"第五步-尝试一些其他命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第五步-尝试一些其他命令"}},[s._v("#")]),s._v(" 第五步: 尝试一些其他命令")]),s._v(" "),e("p",[s._v("如果你想在后台运行你的服务，你可以通过"),e("code",[s._v("-d")]),s._v(" 标志(对于“分离”模式)来 "),e("code",[s._v("docker-compose up")]),s._v(" 和使用 "),e("code",[s._v("docker-compose ps")]),s._v(" 来查看当前运行的是什么:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\nStarting composetest_redis_1 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nStarting composetest_web_1   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n       Name                      Command               State           Ports         \n-------------------------------------------------------------------------------------\ncomposetest_redis_1   docker-entrypoint.sh redis "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".   Up      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp              \ncomposetest_web_1     flask run                        Up      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5000-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp\n")])])]),e("p",[s._v("如果使用"),e("code",[s._v("docker-compose up -d")]),s._v("命令启动服务时，当需要停止服务，需要执行：")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" stop\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);