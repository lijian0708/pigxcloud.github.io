(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{532:function(t,s,a){"use strict";a.r(s);var e=a(29),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"基于-docker-安装-gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于-docker-安装-gitlab"}},[t._v("#")]),t._v(" 基于 Docker 安装 GitLab")]),t._v(" "),a("h2",{attrs:{id:"使用-docker-compose-安装-gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-compose-安装-gitlab"}},[t._v("#")]),t._v(" 使用 docker-compose 安装 GitLab")]),t._v(" "),a("p",[t._v("使用 "),a("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Compose"),a("OutboundLink")],1),t._v(" 您可以轻松地配置、安装和升级基于 Docker 的 GitLab 安装。")]),t._v(" "),a("p",[t._v("1."),a("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装"),a("OutboundLink")],1),t._v(" Docker Compose")]),t._v(" "),a("p",[t._v("2.创建"),a("code",[t._v("docker-compose.yml")]),t._v("文件。"),a("a",{attrs:{href:"https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/docker/docker-compose.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方示例"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab/gitlab-ce:latest'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.199.179'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITLAB_OMNIBUS_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        external_url 'http://192.168.199.179'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'80:80'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'443:443'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'22:22'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/config:/etc/gitlab'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/logs:/var/log/gitlab'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/data:/var/opt/gitlab'")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("需要替换"),a("code",[t._v("192.168.199.179")]),t._v("为你自己的域名或者IP地址。")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("Linux主机开启"),a("code",[t._v("SSH")]),t._v("服务时，默认监听"),a("code",[t._v("22")]),t._v("端口，此时直接执行"),a("code",[t._v("docker-compose up")]),t._v("会报端口冲突，解决办法：修改主机"),a("code",[t._v("SSH")]),t._v("监听端口，或参考下面自定HTTP和SSH监听端口配置。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab/gitlab-ce:latest'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.199.179'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITLAB_OMNIBUS_CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n        external_url 'http://192.168.199.179:8080'\n        gitlab_rails['gitlab_shell_ssh_port'] = 2224\n        unicorn['port'] = 8888\n        nginx['listen_port'] = 8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8080:8080'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2224:22'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/config:/etc/gitlab'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/logs:/var/log/gitlab'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/usr/local/docker/gitlab/data:/var/opt/gitlab'")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("以上配置相当与使用"),a("code",[t._v("--publish 8080:8080 --publish 2224:22")]),t._v("。")]),t._v(" "),a("p",[t._v("由于"),a("code",[t._v("unicorn")]),t._v("（Ruby的服务器）默认监听"),a("code",[t._v("8080")]),t._v("端口，所以如果想使用"),a("code",[t._v("8080")]),t._v("端口，需要添加"),a("code",[t._v("unicorn['port'] = 8888")]),t._v("配置，如果使用非8080端口可以去掉该unicorn端口配置。")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("在ports配置中"),a("code",[t._v("- '2224:22'")]),t._v(",只修改主机对外开放端口"),a("code",[t._v("2224")]),t._v("即可，千万不要修改对应容器的"),a("code",[t._v("22")]),t._v("端口，否则SSH连接方式将无法认证成功。")])]),t._v(" "),a("p",[t._v("3.确保与"),a("code",[t._v("docker-compose.yml")]),t._v("在同一个目录中，并运行"),a("code",[t._v("docker-compose up -d")]),t._v("启动 GitLab")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("如果服务器配置较低，启动运行可能需要较长时间，请耐心等待")])]),t._v(" "),a("h2",{attrs:{id:"使用-docker-compose-升级-gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-compose-升级-gitlab"}},[t._v("#")]),t._v(" 使用 docker-compose 升级 GitLab")]),t._v(" "),a("p",[t._v("如果您使用"),a("code",[t._v("docker-compose")]),t._v("安装GitLab，那么您只需运行"),a("code",[t._v("docker-compose pull")]),t._v("和"),a("code",[t._v("docker-compose up -d")]),t._v("来下载新版本并升级GitLab实例。")]),t._v(" "),a("h2",{attrs:{id:"安装完成首次使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装完成首次使用"}},[t._v("#")]),t._v(" 安装完成首次使用")]),t._v(" "),a("ul",[a("li",[t._v("访问地址：http://192.168.199.179:8080")]),t._v(" "),a("li",[t._v("端口 8080 是因为我在配置中设置的外部访问地址为 8080，默认是 80")]),t._v(" "),a("li",[t._v("初始化安装完成后效果如下：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/c63ec1d72d0b4986b745dcc5b16632e9.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[t._v("设置管理员初始密码，这里的密码最好是 字母 + 数字 组合，并且 大于等于 8 位")]),t._v(" "),a("li",[t._v("配置完成后登录，管理员账号是 root")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/d14033a37bec4b80818322f47a31b13d.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[t._v("登录Gitlab，进入欢迎页面")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/237ffb2472574f179b8dbfce93231431.png",alt:"img"}})]),t._v(" "),a("ul",[a("li",[t._v("Gitlab版本")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/97d99d4bc8214c49aeb8899118c8f3e9.png",alt:"img"}})])])}),[],!1,null,null,null);s.default=r.exports}}]);