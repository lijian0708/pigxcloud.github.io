(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{698:function(t,a,s){"use strict";s.r(a);var e=s(29),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker-maven-plugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-maven-plugin"}},[t._v("#")]),t._v(" docker-maven-plugin"),s("Badge",{attrs:{text:"fabric8io",type:"success"}})],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("这是一个Maven插件，用于构建Docker映像和管理用于集成测试的容器。")])]),t._v(" "),s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[s("strong",[t._v("fabric8io")]),t._v("的插件不仅支持通过dockerfile和docker-compose文件进行docker镜像构造(build),镜像推送(push),还支持对容器操作(如run,stop,remove等),也就是说它可以实现对Docker从构建镜像到运行和推送完整的控制流程,这是它独树一帜的地方.")]),t._v(" "),s("p",[t._v("在众多docker-maven插件中,"),s("strong",[t._v("fabric8io")]),t._v("的docker-maven-plugin毫无疑问是最强大的.")]),t._v(" "),s("p",[t._v("现在网上相关的教程大多是使用spotify的,本人一开始也是用spotify,但发现使用起来很有局限性,然后就找其他的docker-maven插件,最终挖掘到了"),s("strong",[t._v("fabric8io")]),t._v("的插件.简单来说,spotify能做的事,"),s("strong",[t._v("fabric8io")]),t._v("都能做,而且"),s("strong",[t._v("fabric8io")]),t._v("选择更多,功能更多.")]),t._v(" "),s("h2",{attrs:{id:"fabric8io和spotify的对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fabric8io和spotify的对比"}},[t._v("#")]),t._v(" fabric8io和spotify的对比")]),t._v(" "),s("p",[t._v("下面用fabric8io和spotify代指其插件")]),t._v(" "),s("p",[t._v("首先,在对比之前,要先认识一个观点,不管使用哪一种docker插件来构造image,都比不上"),s("strong",[t._v("直接用Dockerfile编写简单")]),t._v(",而且可复用,不用学习不同插件不同的构造规则.这一点也在"),s("a",{attrs:{href:"https://github.com/spotify/docker-maven-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("spotify的github项目"),s("OutboundLink")],1),t._v("的README文档里有特别强调,为此他们还特地开发了一个"),s("a",{attrs:{href:"https://github.com/spotify/dockerfile-maven",target:"_blank",rel:"noopener noreferrer"}},[t._v("dockerfile-maven插件"),s("OutboundLink")],1),t._v(",这个插件强制要求使用Dockerfile,他们认为这才是正途,事实也是如此.")]),t._v(" "),s("p",[t._v('很多人选择用spotify是因为所谓"从Stars、文档易用性以及更新频率三个纬度考虑",那下面我们就先从这三者来做简单的对比.再对比功能.')]),t._v(" "),s("h3",{attrs:{id:"_1-stars"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-stars"}},[t._v("#")]),t._v(" 1 Stars")]),t._v(" "),s("p",[t._v("截至目前(2021年3月),各插件star数如下：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("fabric8io/dockerfile-maven 1.4K+")])]),t._v(" "),s("li",[t._v("spotify/dockerfile-maven 2.4+")]),t._v(" "),s("li",[t._v("spotify/docker-maven-plugin 2.5+ "),s("Badge",{attrs:{text:"已废弃",type:"error"}})],1)]),t._v(" "),s("h3",{attrs:{id:"_2-文档易用性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-文档易用性"}},[t._v("#")]),t._v(" 2 文档易用性")]),t._v(" "),s("p",[t._v("这里毫无疑问是spotify的文档更容易用,因为不管是docker-maven-plugin还是dockerfile-maven,spotify的所谓文档都只是放在对应github项目的首页,就是一份README的MarkDown文档而已,可读性很强,可以简单上手.相信这也是spotify插件拥有大量Stars的原因.")]),t._v(" "),s("p",[t._v('相比之下,fabric8io的github的README相当于什么都没写,就只是简单粗暴地给了用户手册的访问链接,虽然也有一个简单的"introlmd",但是对于构建项目没有太大的帮助,最后还是得来看用户手册')]),t._v(" "),s("p",[t._v("fabric8io的用户手册内容相当丰富,这也是因为它功能比较强大.所以这里见仁见智.另外,如果使用Dockerfile和docker-compose文件的话,其实可以避开大部分的配置,剩下的配置都是因为它额外的功能,所以其文档虽然复杂,但配置却可以很简单.")]),t._v(" "),s("h3",{attrs:{id:"_3-更新频率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-更新频率"}},[t._v("#")]),t._v(" 3 更新频率")]),t._v(" "),s("p",[t._v("截至目前,fabric8io最近一次更新推送是在2020年9月28日,spotify的项目则是2019年10月15日。")]),t._v(" "),s("h3",{attrs:{id:"_4-功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-功能"}},[t._v("#")]),t._v(" 4 功能")]),t._v(" "),s("p",[t._v("这才是要比较的重点，也是 fabric8io全面碾压spotify的地方")]),t._v(" "),s("h4",{attrs:{id:"_1-对dockerfile和docker-compose文件配置的支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-对dockerfile和docker-compose文件配置的支持"}},[t._v("#")]),t._v(" 1 对dockerfile和docker-compose文件配置的支持")]),t._v(" "),s("p",[t._v("截至到2019年1月。\nspotify才刚刚支持自定义dockerfile文件的位置，在这之前dockerfile必须安装一定的规则放置才行。对于docker-compose.yml文件的支持为零。")]),t._v(" "),s("p",[t._v("fabric8io很早就支持自定义dockerfile文件和docker-compose.yml文件的导入了。不过目前对docker-compose.yml版本不支持3.0及更新。对于我目前来说是够用了，以后希望会更新支持。")]),t._v(" "),s("p",[t._v("对于我这种喜欢把启动参数放在docker-compose文件的人来说，对docker-compose的支持很重要，而且这样就完全剥离了插件对docker构建和运行参数的繁琐配置了。")]),t._v(" "),s("h4",{attrs:{id:"_2-对docker容器的控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-对docker容器的控制"}},[t._v("#")]),t._v(" 2 对docker容器的控制")]),t._v(" "),s("p",[t._v("fabric8io的有两大功能:")]),t._v(" "),s("ol",[s("li",[t._v("构造并推送Docker镜像")]),t._v(" "),s("li",[t._v("启动和停止Docker容器")])]),t._v(" "),s("p",[t._v("也就是说通过fabric8io的docker插件,我们可以实现对Docker从构建镜像到运行和推送完整的控制流程")]),t._v(" "),s("p",[t._v("而包括spotify在内的其他插件则仅有第一部分功能,即构造并推送镜像,而没有实现对容器的控制.这也是我使用fabric8io而不使用spotify的最主要原因.")]),t._v(" "),s("h4",{attrs:{id:"_2-对远程docker主机的连接支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-对远程docker主机的连接支持"}},[t._v("#")]),t._v(" 2 对远程docker主机的连接支持")]),t._v(" "),s("p",[t._v("spotify只支持在本机docker的镜像build、tag、push，而fabric8io可以用于远程主机，这个时候要注意 dockerHost 项的配置。")]),t._v(" "),s("h2",{attrs:{id:"dockerhost-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerhost-配置"}},[t._v("#")]),t._v(" dockerHost 配置")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[s("strong",[t._v("dockerHost")]),t._v("的配置和docker官方的配置规则不太一样")])]),t._v(" "),s("h3",{attrs:{id:"_1-docker官方的监听配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker官方的监听配置"}},[t._v("#")]),t._v(" 1 docker官方的监听配置")]),t._v(" "),s("p",[t._v("docker可以配置三种不同类型的Socket请求："),s("code",[t._v("unix")]),t._v("，"),s("code",[t._v("tcp")]),t._v("，和 "),s("code",[t._v("fd")]),t._v("，其中 "),s("code",[t._v("fd")]),t._v(" 和 "),s("code",[t._v("unix")]),t._v(" 通常用于本机连接，"),s("code",[t._v("tcp")]),t._v(" 用于 ip 连接。三者在 "),s("code",[t._v("/etc/docker/daemon.json")]),t._v(" 的配置项为 "),s("code",[t._v("hosts")]),t._v("，需要注意不支持 "),s("code",[t._v("http(https)")])]),t._v(" "),s("h3",{attrs:{id:"_2-fabric8io-的主机配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-fabric8io-的主机配置"}},[t._v("#")]),t._v(" 2 fabric8io 的主机配置")]),t._v(" "),s("p",[t._v("fabric8io的 的"),s("code",[t._v("dockerHost")]),t._v("支持 tcp 和http（https）两种格式")]),t._v(" "),s("h4",{attrs:{id:"_1-tcp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-tcp"}},[t._v("#")]),t._v(" 1 tcp")]),t._v(" "),s("p",[t._v("如果使用tcp则只能使用 2375 和 2376端口，分别对应不加密验证和加密验证\n这个时候在url里配置其他端口是无效的。\n（也就是说，服务器设置了监听 tcp:///0.0.0.0:9999，fabric8io的插件设置 tcp:公网ip:9999，也是无效的，这个时候如果启用了ssl加密的话就只能一起用 2376）")]),t._v(" "),s("h4",{attrs:{id:"_2-http-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-http-https"}},[t._v("#")]),t._v(" 2 http/https")]),t._v(" "),s("p",[t._v("这个时候端口是可以自定义的\n即是说直接用 "),s("a",{attrs:{href:"http://xn--ip-xz4cq45o/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://公网ip"),s("OutboundLink")],1),t._v("（域名）:9999 即可。")]),t._v(" "),s("h4",{attrs:{id:"_3-端口报错的提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-端口报错的提示"}},[t._v("#")]),t._v(" 3 端口报错的提示")]),t._v(" "),s("p",[t._v("端口问题连接时会报错 ： "),s("code",[t._v("Cannot create docker access object")]),t._v(" "),s("code",[t._v("org.apache.http.ProtocolException: The server failed to respond with a valid HTTP response")])]),t._v(" "),s("h2",{attrs:{id:"fabric8io的docker-maven插件的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fabric8io的docker-maven插件的使用"}},[t._v("#")]),t._v(" fabric8io的docker-maven插件的使用")]),t._v(" "),s("h3",{attrs:{id:"_1-参考配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-参考配置"}},[t._v("#")]),t._v(" 1 参考配置")]),t._v(" "),s("p",[t._v("如果是想要快速启动,可以参考下面的配置")]),t._v(" "),s("p",[t._v("远程Docker的控制和配置可以看这一篇文章:"),s("a",{attrs:{href:"./Docker%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8TLS%E4%BF%9D%E6%8A%A4%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8BDocker%E6%9C%8D%E5%8A%A1"}},[t._v("Docker客户端使用TLS保护连接远程Docker服务")])]),t._v(" "),s("p",[t._v("下面使用Dockerfile完成docker镜像构建,使用docker-compose.yml完成docker容器启动参数控制")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("project")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://maven.apache.org/POM/4.0.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("modelVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("4.0.0"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("modelVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.plugin.version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("0.34.1"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.plugin.version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("https://10.17.1.101:2376"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("10.17.1.101"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.registry.namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("library"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.registry.namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.registry.username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.registry.username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("docker.registry.password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Harbor12345"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("docker.registry.password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.fabric8"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("docker-maven-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.plugin.version}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--全局配置--\x3e")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--远程docker主机地址,用于完成docker各项功能--\x3e")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dockerHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.host}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dockerHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--docker远程访问所需证书地址,如果docker远程主机没有启用TLS验证则不需要配证书--\x3e")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("certPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.basedir}/docker/ssh"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("certPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--registry地址,用于推送,拉取镜像--\x3e")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.registry}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("authConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.registry.username}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.registry.password}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("authConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("images")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--镜像名(含版本号)--\x3e")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${docker.registry}/${docker.registry.namespace}/${project.name}:${project.version}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--使用dockerFile文件--\x3e")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dockerFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.basedir}/Dockerfile"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dockerFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("images")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("project")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("可以看到,其实配置是相当简单清晰的,只要你确保Dockerfile和docker-compose.yml符合规范,能够使用,这个插件就可以代替你使用了,而你仅需要给它配置一些最基础的授权信息。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("如果配置启用TLS验证，Windows 10 系统需要将"),s("code",[t._v("ca.pem")]),t._v(","),s("code",[t._v("cert.pem")]),t._v(","),s("code",[t._v("key.pem")]),t._v("这三个文件复制到"),s("code",[t._v("C:\\Users\\${USER}\\.docker")]),t._v("目录下。")])]),t._v(" "),s("h3",{attrs:{id:"_2-mvn指令说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mvn指令说明"}},[t._v("#")]),t._v(" 2 mvn指令说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("maven指令")]),t._v(" "),s("th",[t._v("功能")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("docker:start")]),t._v(" "),s("td",[t._v("创建和启动容器")])]),t._v(" "),s("tr",[s("td",[t._v("docker:stop")]),t._v(" "),s("td",[t._v("停止并销毁容器")])]),t._v(" "),s("tr",[s("td",[t._v("docker:build")]),t._v(" "),s("td",[t._v("构建镜像")])]),t._v(" "),s("tr",[s("td",[t._v("docker:watch")]),t._v(" "),s("td",[t._v("自动进行重建和重启")])]),t._v(" "),s("tr",[s("td",[t._v("docker:push")]),t._v(" "),s("td",[t._v("将镜像推送到registry")])]),t._v(" "),s("tr",[s("td",[t._v("docker:remove")]),t._v(" "),s("td",[t._v("从本地docker主机删除镜像")])]),t._v(" "),s("tr",[s("td",[t._v("docker:logs")]),t._v(" "),s("td",[t._v("显示容器日志")])]),t._v(" "),s("tr",[s("td",[t._v("docker:source")]),t._v(" "),s("td",[t._v("将docker build archive附加到Maven项目")])]),t._v(" "),s("tr",[s("td",[t._v("docker:save")]),t._v(" "),s("td",[t._v("将镜像保存到文件")])]),t._v(" "),s("tr",[s("td",[t._v("docker:volume-create")]),t._v(" "),s("td",[t._v("创建卷以在容器之间共享数据")])]),t._v(" "),s("tr",[s("td",[t._v("docker:volume-remove")]),t._v(" "),s("td",[t._v("删除创建的卷")])])])]),t._v(" "),s("p",[t._v("注意,start和run是同义的,可以互相代替,另外,这里的stop和remove和在docker的不一样,docker的stop会保留容器,这里默认是停止并销毁(当然也可以在pom配置或mvn参数里指定keepContainer使其不销毁),但是我认为一般是不会用到暂停的,stop就是为了remove")]),t._v(" "),s("h3",{attrs:{id:"_3-指令实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-指令实践"}},[t._v("#")]),t._v(" 3 指令实践")]),t._v(" "),s("p",[t._v("这里我贴一下我常用的maven指令\n这样就可以完成从打包到容器运行的完整流程")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ mvn clean package docker:stop docker:remove docker:build docker:run \n")])])]),s("p",[t._v("不是每一次运行都要推送的,如果要的话可以单独调用docker:push")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ mvn docker:push\n")])])]),s("h3",{attrs:{id:"_4-注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-注意事项"}},[t._v("#")]),t._v(" 4 注意事项")]),t._v(" "),s("p",[t._v("docker:run 这里有个坑,docker:run是在前台执行,也就是说,它并不能像使用docker一下直接"),s("code",[t._v("docker start -d")]),t._v("来实现后台运行,所以如果是在命令行下启动的话,按Ctrl+C就直接退出了,方法是命令行下启动的时候使用如下指令包装成后台运行")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nohup")]),t._v(" mvn docker:run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" \n")])])]),s("p",[t._v("如果是用IDE控制的话就不用担心,因为IDE只是监控运行日志而已,IDE这里退出不影响其在远程服务器上的运行.")]),t._v(" "),s("p",[t._v("另外,docker:run之后的指令不会运行,因为run之后它会监控Java程序的控制台输出直到运行结束,而一般Java Web程序是作为服务器一直运行的,所以就导致docker:run后面的指令不执行\n解决方法有两个,第一,让docker:run放最后,第二,另外单独执行第二条mvn指令")]),t._v(" "),s("h2",{attrs:{id:"参考文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档:")]),t._v(" "),s("ul",[s("li",[t._v("github项目地址:"),s("a",{attrs:{href:"https://github.com/fabric8io/docker-maven-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/fabric8io/docker-maven-plugin"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("用户手册:"),s("a",{attrs:{href:"http://dmp.fabric8.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://dmp.fabric8.io/"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);