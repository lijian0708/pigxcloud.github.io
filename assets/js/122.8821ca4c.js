(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{590:function(t,a,e){"use strict";e.r(a);var s=e(29),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"服务注册与发现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务注册与发现"}},[t._v("#")]),t._v(" 服务注册与发现")]),t._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("p",[t._v("Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。")]),t._v(" "),e("p",[t._v("Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。")]),t._v(" "),e("h2",{attrs:{id:"什么是-nacos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-nacos"}},[t._v("#")]),t._v(" 什么是 Nacos")]),t._v(" "),e("p",[t._v("服务（Service）是 Nacos 世界的一等公民。Nacos 支持几乎所有主流类型的“服务”的发现、配置和管理：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes Service"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://grpc.io/docs/guides/concepts.html#service-definition",target:"_blank",rel:"noopener noreferrer"}},[t._v("gRPC"),e("OutboundLink")],1),t._v(" & "),e("a",{attrs:{href:"https://dubbo.incubator.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dubbo RPC Service"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://spring.io/understanding/REST",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud RESTful Service"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("Nacos 的关键特性包括:")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("服务发现和服务健康监测")])]),t._v(" "),e("p",[t._v("Nacos 支持基于 DNS 和基于 RPC 的服务发现。服务提供者使用 "),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/sdk.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("原生SDK"),e("OutboundLink")],1),t._v("、"),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/open-API.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenAPI"),e("OutboundLink")],1),t._v("、或一个"),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/other-language.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("独立的Agent TODO"),e("OutboundLink")],1),t._v("注册 Service 后，服务消费者可以使用"),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/xx",target:"_blank",rel:"noopener noreferrer"}},[t._v("DNS TODO"),e("OutboundLink")],1),t._v(" 或"),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/open-API.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP&API"),e("OutboundLink")],1),t._v("查找和发现服务。")]),t._v(" "),e("p",[t._v("Nacos 提供对服务的实时的健康检查，阻止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。Nacos 还提供了统一的健康检查仪表盘，帮助您根据健康状态管理服务的可用性及流量。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("动态配置服务")])]),t._v(" "),e("p",[t._v("动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。")]),t._v(" "),e("p",[t._v("动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。")]),t._v(" "),e("p",[t._v("配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。")]),t._v(" "),e("p",[t._v("Nacos 提供了一个简洁易用的UI ("),e("a",{attrs:{href:"http://console.nacos.io/nacos/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("控制台样例 Demo"),e("OutboundLink")],1),t._v(") 帮助您管理所有的服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助您更安全地在生产环境中管理配置变更和降低配置变更带来的风险。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("动态 DNS 服务")])]),t._v(" "),e("p",[t._v("动态 DNS 服务支持权重路由，让您更容易地实现中间层负载均衡、更灵活的路由策略、流量控制以及数据中心内网的简单DNS解析服务。动态DNS服务还能让您更容易地实现以 DNS 协议为基础的服务发现，以帮助您消除耦合到厂商私有服务发现 API 上的风险。")]),t._v(" "),e("p",[t._v("Nacos 提供了一些简单的 "),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/xx",target:"_blank",rel:"noopener noreferrer"}},[t._v("DNS APIs TODO"),e("OutboundLink")],1),t._v(" 帮助您管理服务的关联域名和可用的 IP:PORT 列表.")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("服务及其元数据管理")])]),t._v(" "),e("p",[t._v("Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。")])]),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/roadmap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("更多的特性列表 ..."),e("OutboundLink")],1)])])]),t._v(" "),e("h2",{attrs:{id:"nacos-地图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos-地图"}},[t._v("#")]),t._v(" Nacos 地图")]),t._v(" "),e("p",[t._v("一图看懂 Nacos，下面架构部分会详细介绍。 "),e("img",{attrs:{src:"/img/2020-05-07_19-45-48.jpg",alt:"nacos_map"}})]),t._v(" "),e("ul",[e("li",[t._v("特性大图：要从功能特性，非功能特性，全面介绍我们要解的问题域的特性诉求")]),t._v(" "),e("li",[t._v("架构大图：通过清晰架构，让您快速进入 Nacos 世界")]),t._v(" "),e("li",[t._v("业务大图：利用当前特性可以支持的业务场景，及其最佳实践")]),t._v(" "),e("li",[t._v("生态大图：系统梳理 Nacos 和主流技术生态的关系")]),t._v(" "),e("li",[t._v("优势大图：展示 Nacos 核心竞争力")]),t._v(" "),e("li",[t._v("战略大图：要从战略到战术层面讲 Nacos 的宏观优势")])]),t._v(" "),e("h2",{attrs:{id:"nacos-生态图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos-生态图"}},[t._v("#")]),t._v(" Nacos 生态图")]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/2020-05-07_19-45-49.png",alt:"nacos_landscape.png"}})]),t._v(" "),e("p",[t._v("如 Nacos 全景图所示，Nacos 无缝支持一些主流的开源生态，例如")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://nacos.io/en-us/docs/quick-start-spring-cloud.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/xx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apache Dubbo and Dubbo Mesh TODO"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/xx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes and CNCF TODO"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("p",[t._v("使用 Nacos 简化服务发现、配置管理、服务治理及管理的解决方案，让微服务的发现、管理、共享、组合更加容易。")]),t._v(" "),e("p",[t._v("关于如何在这些生态中使用 Nacos，请参考以下文档：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/use-nacos-with-springcloud.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos与Spring Cloud一起使用"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/use-nacos-with-kubernetes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos与Kubernetes一起使用"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/use-nacos-with-dubbo.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos与Dubbo一起使用"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/roadmap.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos与gRPC一起使用"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/use-nacos-with-istio.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos与Istio一起使用"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"nacos-docker-快速开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos-docker-快速开始"}},[t._v("#")]),t._v(" Nacos Docker 快速开始")]),t._v(" "),e("h3",{attrs:{id:"操作步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作步骤"}},[t._v("#")]),t._v(" 操作步骤")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Clone 项目")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/nacos-group/nacos-docker.git\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" nacos-docker\n")])])])]),t._v(" "),e("li",[e("p",[t._v("单机模式 Derby")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" -f example/standalone-derby.yaml up\n")])])])]),t._v(" "),e("li",[e("p",[t._v("单机模式 Mysql")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" -f example/standalone-mysql.yaml up\n")])])])]),t._v(" "),e("li",[e("p",[t._v("集群模式")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" -f example/cluster-hostname.yaml up \n")])])])]),t._v(" "),e("li",[e("p",[t._v("服务注册")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X POST "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&ip=20.18.7.10&port=8080'")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("服务发现")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X GET "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8848/nacos/v1/ns/instances?serviceName=nacos.naming.serviceName'")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("发布配置")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X POST "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&group=test&content=helloWorld"')]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("获取配置")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X GET "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&group=test"')]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Nacos 控制台")]),t._v(" "),e("p",[t._v("link："),e("a",{attrs:{href:"http://127.0.0.1:8848/nacos/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:8848/nacos/"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("默认账号密码为 "),e("strong",[t._v("nacos/nacos")])])])])]),t._v(" "),e("p",[t._v("登录页\n"),e("img",{attrs:{src:"/img/2020-05-07_23-35-13.png",alt:"Nacos Login"}})]),t._v(" "),e("p",[t._v("控制台\n"),e("img",{attrs:{src:"/img/2020-05-07_23-35-43.png",alt:"Nacos 控制台"}})]),t._v(" "),e("h3",{attrs:{id:"common-property-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#common-property-configuration"}},[t._v("#")]),t._v(" Common property configuration")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("name")]),t._v(" "),e("th",[t._v("description")]),t._v(" "),e("th",[t._v("option")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("MODE")]),t._v(" "),e("td",[t._v("cluster模式/standalone模式")]),t._v(" "),e("td",[t._v("cluster/standalone default "),e("strong",[t._v("cluster")])])]),t._v(" "),e("tr",[e("td",[t._v("NACOS_SERVERS")]),t._v(" "),e("td",[t._v("nacos cluster地址")]),t._v(" "),e("td",[t._v("eg. ip1,ip2,ip3")])]),t._v(" "),e("tr",[e("td",[t._v("PREFER_HOST_MODE")]),t._v(" "),e("td",[t._v("是否支持hostname")]),t._v(" "),e("td",[t._v("hostname/ip default "),e("strong",[t._v("ip")])])]),t._v(" "),e("tr",[e("td",[t._v("NACOS_SERVER_PORT")]),t._v(" "),e("td",[t._v("nacos服务器端口")]),t._v(" "),e("td",[t._v("default "),e("strong",[t._v("8848")])])]),t._v(" "),e("tr",[e("td",[t._v("NACOS_SERVER_IP")]),t._v(" "),e("td",[t._v("多网卡下的自定义nacos服务器IP")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("SPRING_DATASOURCE_PLATFORM")]),t._v(" "),e("td",[t._v("standalone 支持 mysql")]),t._v(" "),e("td",[t._v("mysql / empty default empty")])]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_MASTER_SERVICE_HOST")]),t._v(" "),e("td",[t._v("mysql 主节点host")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_MASTER_SERVICE_PORT")]),t._v(" "),e("td",[t._v("mysql 主节点端口")]),t._v(" "),e("td",[t._v("default : "),e("strong",[t._v("3306")])])]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_MASTER_SERVICE_DB_NAME")]),t._v(" "),e("td",[t._v("mysql 主节点数据库")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_MASTER_SERVICE_USER")]),t._v(" "),e("td",[t._v("数据库用户名")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_MASTER_SERVICE_PASSWORD")]),t._v(" "),e("td",[t._v("数据库密码")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_SLAVE_SERVICE_HOST")]),t._v(" "),e("td",[t._v("mysql从节点host")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_SLAVE_SERVICE_PORT")]),t._v(" "),e("td",[t._v("mysql从节点端口")]),t._v(" "),e("td",[t._v("default :3306")])]),t._v(" "),e("tr",[e("td",[t._v("MYSQL_DATABASE_NUM")]),t._v(" "),e("td",[t._v("数据库数量")]),t._v(" "),e("td",[t._v("default :2")])]),t._v(" "),e("tr",[e("td",[t._v("JVM_XMS")]),t._v(" "),e("td",[t._v("-Xms")]),t._v(" "),e("td",[t._v("default :2g")])]),t._v(" "),e("tr",[e("td",[t._v("JVM_XMX")]),t._v(" "),e("td",[t._v("-Xmx")]),t._v(" "),e("td",[t._v("default :2g")])]),t._v(" "),e("tr",[e("td",[t._v("JVM_XMN")]),t._v(" "),e("td",[t._v("-Xmn")]),t._v(" "),e("td",[t._v("default :1g")])]),t._v(" "),e("tr",[e("td",[t._v("JVM_MS")]),t._v(" "),e("td",[t._v("-XX:MetaspaceSize")]),t._v(" "),e("td",[t._v("default :128m")])]),t._v(" "),e("tr",[e("td",[t._v("JVM_MMS")]),t._v(" "),e("td",[t._v("-XX:MaxMetaspaceSize")]),t._v(" "),e("td",[t._v("default :320m")])]),t._v(" "),e("tr",[e("td",[t._v("NACOS_DEBUG")]),t._v(" "),e("td",[t._v("开启远程调试")]),t._v(" "),e("td",[t._v("y/n default :n")])]),t._v(" "),e("tr",[e("td",[t._v("TOMCAT_ACCESSLOG_ENABLED")]),t._v(" "),e("td",[t._v("server.tomcat.accesslog.enabled")]),t._v(" "),e("td",[t._v("default :false")])])])]),t._v(" "),e("h2",{attrs:{id:"nacos-grafana-prometheus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos-grafana-prometheus"}},[t._v("#")]),t._v(" Nacos + Grafana + Prometheus")]),t._v(" "),e("p",[t._v("参考："),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/monitor-guide.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos监控指南"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("Note")]),t._v(": grafana创建一个新数据源时，数据源地址必须是 "),e("strong",[e("a",{attrs:{href:"http://prometheus:9090/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://prometheus:9090"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"相关项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#相关项目"}},[t._v("#")]),t._v(" 相关项目")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/alibaba/nacos",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/nacos-group/nacos-docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nacos Docker"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);