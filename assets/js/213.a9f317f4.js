(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{682:function(t,s,a){"use strict";a.r(s);var n=a(29),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins构建maven项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins构建maven项目"}},[t._v("#")]),t._v(" Jenkins构建Maven项目")]),t._v(" "),a("h2",{attrs:{id:"jenkins构建的项目类型介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins构建的项目类型介绍"}},[t._v("#")]),t._v(" Jenkins构建的项目类型介绍")]),t._v(" "),a("p",[t._v("Jenkins中自动构建项目的类型有很多，常用的有以下三种:")]),t._v(" "),a("ul",[a("li",[t._v("自由风格软件项目(FreeStyle Project)")]),t._v(" "),a("li",[t._v("Maven项目(Maven Project)")]),t._v(" "),a("li",[t._v("流水线项目(Pipeline Project)")])]),t._v(" "),a("p",[t._v("每种类型的构建其实都可以完成一样的构建过程与结果，只是在操作方式、灵活度等方面有所区别，在 实际开发中可以根据自己的需求和习惯来选择。(PS:个人推荐使用流水线类型，因为灵活度非常高)")]),t._v(" "),a("h2",{attrs:{id:"自由风格项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自由风格项目构建"}},[t._v("#")]),t._v(" 自由风格项目构建")]),t._v(" "),a("p",[t._v("下面演示创建一个自由风格项目来完成项目的集成过程:")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("拉取代码->编译->打包->部署")])]),t._v(" "),a("h3",{attrs:{id:"拉取代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取代码"}},[t._v("#")]),t._v(" 拉取代码")]),t._v(" "),a("p",[t._v("1)创建项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_222155.jpg",alt:"创建项目"}})]),t._v(" "),a("p",[t._v("2)配置源码管理，从gitlab拉取代码")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_222827.jpg",alt:"拉取代码"}})]),t._v(" "),a("h3",{attrs:{id:"编译打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译打包"}},[t._v("#")]),t._v(" 编译打包")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("构建->添加构建步骤->执行 Shell")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始编译和打包"')]),t._v(" \nmvn clean package \n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"编译和打包结束"')]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"/img/2021-06-24_224352.jpg",alt:"编译打包 "}})]),t._v(" "),a("h3",{attrs:{id:"部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),a("p",[t._v("把项目部署到远程的Tomcat里面")]),t._v(" "),a("p",[t._v("1)安装 Deploy to container插件")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("Jenkins本身无法实现远程部署到Tomcat的功能，需要安装Deploy to container插件实现")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_225155.jpg",alt:"Deploy to container插件"}})]),t._v(" "),a("p",[t._v("2)添加Tomcat用户凭证 "),a("code",[t._v("jenkins-tomcat-deploy-creds")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_225744.jpg",alt:"添加Tomcat用户凭证"}})]),t._v(" "),a("p",[t._v("3)添加构建后操作")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_230028.jpg",alt:"添加构建后操作"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_230323.jpg",alt:"添加构建后操作"}})]),t._v(" "),a("p",[t._v('点击"立即构建"，开始构建过程')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[INFO] --- maven-compiler-plugin:3.8.0:testCompile (default-testCompile) @ web-demo ---\n[INFO] No sources to compile\n[INFO] \n[INFO] --- maven-surefire-plugin:2.22.1:test (default-test) @ web-demo ---\n[INFO] No tests to run.\n[INFO] \n[INFO] --- maven-war-plugin:3.2.2:war (default-war) @ web-demo ---\n[INFO] Packaging webapp\n[INFO] Assembling webapp [web-demo] in [/var/lib/jenkins/workspace/web-demo/target/web-demo]\n[INFO] Processing war project\n[INFO] Copying webapp resources [/var/lib/jenkins/workspace/web-demo/src/main/webapp]\n[INFO] Webapp assembled in [61 msecs]\n[INFO] Building war: /var/lib/jenkins/workspace/web-demo/target/web-demo.war\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  4.462 s\n[INFO] Finished at: 2021-06-24T23:05:22+08:00\n[INFO] ------------------------------------------------------------------------\n+ echo 编译和打包结束\n编译和打包结束\n[DeployPublisher][INFO] Attempting to deploy 1 war file(s)\n[DeployPublisher][INFO] Deploying /var/lib/jenkins/workspace/web-demo/target/web-demo.war to container Tomcat 9.x Remote with context null\n  [/var/lib/jenkins/workspace/web-demo/target/web-demo.war] is not deployed. Doing a fresh deployment.\n  Deploying [/var/lib/jenkins/workspace/web-demo/target/web-demo.war]\nFinished: SUCCESS\n")])])]),a("p",[t._v("4)部署成功后，访问项目 http://192.168.50.103:8080/web-demo/")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_230837.jpg",alt:"访问项目"}})]),t._v(" "),a("h3",{attrs:{id:"演示改动代码后的持续集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#演示改动代码后的持续集成"}},[t._v("#")]),t._v(" 演示改动代码后的持续集成")]),t._v(" "),a("p",[t._v("1)IDEA中源码修改并提交到gitlab")]),t._v(" "),a("p",[t._v("2)在Jenkins中项目重新构建")]),t._v(" "),a("p",[t._v("3)访问Tomcat")]),t._v(" "),a("h2",{attrs:{id:"maven项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maven项目构建"}},[t._v("#")]),t._v(" Maven项目构建")]),t._v(" "),a("p",[t._v("1)安装Maven Integration插件")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_232456.jpg",alt:"Maven Integration"}})]),t._v(" "),a("p",[t._v("2)创建Maven项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_232902.jpg",alt:"创建Maven项目"}})]),t._v(" "),a("p",[t._v('3)配置项目 拉取代码和远程部署的过程和自由风格项目一样，只是"构建"部分不同')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_233252.jpg",alt:"创建Maven项目"}})]),t._v(" "),a("h2",{attrs:{id:"pipeline流水线项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipeline流水线项目构建"}},[t._v("#")]),t._v(" Pipeline流水线项目构建"),a("Badge",{attrs:{text:"推荐",type:"success"}})],1),t._v(" "),a("h3",{attrs:{id:"pipeline简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipeline简介"}},[t._v("#")]),t._v(" Pipeline简介")]),t._v(" "),a("p",[t._v("1)概念")]),t._v(" "),a("p",[t._v("Pipeline，简单来说就是一套运行在 Jenkins 上的工作流框架，将原来独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂流程编排和可视化的工作。")]),t._v(" "),a("p",[t._v("2)使用Pipeline有以下好处(来自翻译自官方文档):")]),t._v(" "),a("ul",[a("li",[t._v("代码:Pipeline以代码的形式实现，通常被检入源代码控制，使团队能够编辑，审查和迭代其传送流程。")]),t._v(" "),a("li",[t._v("持久:无论是计划内的还是计划外的服务器重启，Pipeline都是可恢复的。")]),t._v(" "),a("li",[t._v("可停止:Pipeline可接 收交互式输入，以确定是否继续执行Pipeline。")]),t._v(" "),a("li",[t._v("多功能:Pipeline支持现实世界中复杂的持续交付要求。它支持fork/join、循环执行，并行执行任务的功能。")]),t._v(" "),a("li",[t._v("可扩展:Pipeline插件支持其DSL的自定义扩展 以及与其他插件集成的多个选项。")])]),t._v(" "),a("p",[t._v("3)如何创建 Jenkins Pipeline呢?")]),t._v(" "),a("ul",[a("li",[t._v("Pipeline 脚本是由 Groovy 语言实现的，但是我们没必要单独去学习 Groovy")]),t._v(" "),a("li",[t._v("Pipeline 支持两种语法:Declarative(声明式)和 Scripted Pipeline(脚本式)语法")]),t._v(" "),a("li",[t._v("Pipeline 也有两种创建方法:可以直接在 Jenkins 的 Web UI 界面中输入脚本;也可以通过创建一 个 Jenkinsfile 脚本文件放入项目源码库中(一般我们都推荐在 Jenkins 中直接从源代码控制(SCM) 中直接载入 Jenkinsfile Pipeline 这种方法)。")])]),t._v(" "),a("h2",{attrs:{id:"安装pipeline插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装pipeline插件"}},[t._v("#")]),t._v(" 安装Pipeline插件")]),t._v(" "),a("p",[t._v("插件管理->可选插件")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_234750.jpg",alt:"安装Pipeline插件"}})]),t._v(" "),a("p",[t._v("安装插件后，创建项目的时候多了“流水线”类型")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_235404.jpg",alt:"安装Pipeline插件"}})]),t._v(" "),a("h2",{attrs:{id:"pipeline语法快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipeline语法快速入门"}},[t._v("#")]),t._v(" Pipeline语法快速入门")]),t._v(" "),a("h3",{attrs:{id:"declarative声明式-pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#declarative声明式-pipeline"}},[t._v("#")]),t._v(" Declarative声明式-Pipeline")]),t._v(" "),a("p",[t._v("创建项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_235404.jpg",alt:"创建项目"}})]),t._v(" "),a("p",[t._v("流水线->选择HelloWorld模板")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-24_235743.jpg",alt:"流水线"}})]),t._v(" "),a("p",[t._v("生成内容如下:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("stages:代表整个流水线的所有执行阶段。通常stages只有1个，里面包含多个stage")]),t._v(" "),a("p",[t._v("stage:代表流水线中的某个阶段，可能出现n个。一般分为拉取代码，编译构建，部署等阶段。")]),t._v(" "),a("p",[t._v("steps:代表一个阶段内需要执行的逻辑。steps里面是shell脚本，git拉取代码，ssh远程发布等任意内容。 编写一个简单声明式Pipeline:")]),t._v(" "),a("p",[t._v("编写一个简单声明式Pipeline:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译构建'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Deoloy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'项目部署'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("点击构建，可以看到整个构建过程")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-25_000614.jpg",alt:"构建过程"}})]),t._v(" "),a("h3",{attrs:{id:"scripted-pipeline脚本式-pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scripted-pipeline脚本式-pipeline"}},[t._v("#")]),t._v(" Scripted Pipeline脚本式-Pipeline")]),t._v(" "),a("p",[t._v("创建项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_105001.jpg",alt:"创建项目"}})]),t._v(" "),a("p",[t._v('这次选择"Scripted Pipeline"')]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    def mvnHome\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Preparation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" // "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" display purposes\n        // Get some code from a GitHub repository\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/jglick/simple-maven-project-with-tests.git'")]),t._v("\n        // Get the Maven tool.\n        // ** NOTE: This "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'M3'")]),t._v(" Maven tool must be configured\n        // **       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the global configuration.\n        mvnHome "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'M3'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        // Run the maven build\n        withEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MVN_HOME='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$mvnHome")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isUnix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"$MVN_HOME/bin/mvn\" -Dmaven.test.failure.ignore clean package'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                bat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%MVN_HOME%'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\b"}},[t._v("\\b")]),t._v('in\\mvn"')]),t._v(" -Dmaven.test.failure.ignore clean package/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Results'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        junit "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'**/target/surefire-reports/TEST-*.xml'")]),t._v("\n        archiveArtifacts "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'target/*.jar'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("Node:节点，一个 Node 就是一个 Jenkins 节点，Master 或者 Agent，是执行 Step 的具体运行 环境，后续讲到Jenkins的Master-Slave架构的时候用到。")]),t._v(" "),a("li",[t._v("Stage:阶段，一个 Pipeline 可以划分为若干个 Stage，每个 Stage 代表一组操作，比如: Build、Test、Deploy，Stage 是一个逻辑分组的概念。")]),t._v(" "),a("li",[t._v("Step:步骤，Step 是最基本的操作单元，可以是打印一句话，也可以是构建一个 Docker 镜像， 由各类 Jenkins 插件提供，比如命令:sh ‘make’，就相当于我们平时 shell 终端中执行 make 命令 一样。")])]),t._v(" "),a("p",[t._v("编写一个简单的脚本式Pipeline")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    def mvnHome\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" // "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" display purposes\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译构建'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Deoloy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'项目部署'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("构建结果和声明式一样!")]),t._v(" "),a("p",[t._v("拉取代码")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),t._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'adf6d5d5-d16c-4665-b85b-ed720f9641ad'")]),t._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git@192.168.50.101:jack/web-demo.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("编译打包")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),t._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'adf6d5d5-d16c-4665-b85b-ed720f9641ad'")]),t._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git@192.168.50.101:jack/web-demo.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mvn clean package'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("部署")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),t._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'adf6d5d5-d16c-4665-b85b-ed720f9641ad'")]),t._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git@192.168.50.101:jack/web-demo.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mvn clean package'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Deoloy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                deploy adapters: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("tomcat9"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dd2801ae-50d3-472c-98ee-bfc1265fef97'")]),t._v(", path: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.50.103:8080'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", contextPath: null, war: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'target/*.war'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"pipeline-script-from-scm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipeline-script-from-scm"}},[t._v("#")]),t._v(" Pipeline Script from SCM")]),t._v(" "),a("p",[t._v("刚才我们都是直接在Jenkins的UI界面编写Pipeline代码，这样不方便脚本维护，建议把Pipeline脚本放在项目中(一起进行版本控制)")]),t._v(" "),a("p",[t._v("1)在项目根目录建立"),a("code",[t._v("Jenkinsfile")]),t._v("文件，把内容复制到该文件中")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_123921.png",alt:"Jenkinsfile"}})]),t._v(" "),a("p",[t._v("把"),a("code",[t._v("Jenkinsfile")]),t._v("上传到Gitlab")]),t._v(" "),a("p",[t._v("2)在项目中引用该文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-06-27_125619.jpg",alt:"Jenkinsfile"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);