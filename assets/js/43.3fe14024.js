(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{514:function(s,t,a){"use strict";a.r(t);var e=a(29),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"centos-7-安装-tigervnc-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos-7-安装-tigervnc-server"}},[s._v("#")]),s._v(" CentOS 7 安装 TigerVNC Server")]),s._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://tigervnc.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TigerVNC"),a("OutboundLink")],1),s._v("是一个高级的 VNC 远程访问的实现，基于第四代VNC，包含一个 JPEG 压缩加速器。支持 X.Org 和 X server。")]),s._v(" "),a("h2",{attrs:{id:"依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[s._v("#")]),s._v(" 依赖")]),s._v(" "),a("p",[s._v("TigerVNC依赖图形化桌面，如果使用最小安装版本的centos需要先安装图形化桌面GNOME的程序包。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum groupinstall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GNOME Desktop"')]),s._v("\n")])])]),a("p",[s._v("修改CentOS默认启动模式为图形化模式,以命令"),a("code",[s._v("systemctl get-default")]),s._v(" 可查看当前默认的模式为"),a("code",[s._v("multi-user.target")]),s._v("，即命令行模式")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl set-default graphical.target\n")])])]),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y tigervnc-server\n")])])]),a("h2",{attrs:{id:"配置-以root用户登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-以root用户登录"}},[s._v("#")]),s._v(" 配置（以root用户登录）")]),s._v(" "),a("p",[s._v("1.拷贝")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /lib/systemd/system/vncserver@.service /lib/systemd/system/vncserver@:1.service\n")])])]),a("p",[s._v("2.修改配置文件：（主要是修改root用户）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /lib/systemd/system/vncserver@:1.service\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[Unit]\nDescription=Remote desktop service (VNC)\nAfter=syslog.target network.target\n \n[Service]\nType=forking\nUser=root\n# Clean any existing files in /tmp/.X11-unix environment\nExecStartPre=/bin/sh -c '/usr/bin/vncserver -kill %i > /dev/null 2>&1 || :'\nExecStart=/sbin/runuser -l root -c \"/usr/bin/vncserver %i -geometry 1280x720 -SecurityTypes None\"\nPIDFile=/root/.vnc/%H%i.pid\nExecStop=/bin/sh -c '/usr/bin/vncserver -kill %i > /dev/null 2>&1 || :'\n \n[Install]\nWantedBy=multi-user.target\n")])])]),a("p",[s._v("3.加载配置：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl daemon-reload\n")])])]),a("p",[s._v("4.设置开机启动：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" vncserver@:1.service\n")])])]),a("h2",{attrs:{id:"防火墙设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙设置"}},[s._v("#")]),s._v(" 防火墙设置"),a("Badge",{attrs:{text:"非必须",type:"success"}})],1),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("由于我们初始的centos系统默认关闭了防火墙，所以可以跳过此步骤。")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 查看防火墙状态：\nfirewall-cmd --state\n \n# 关闭防火墙：\nsystemctl stop firewalld\nsystemctl disable firewalld\n \n# 或者开启防火墙添加5901端口（这里只开启一个端口，如有多个界面可以开启多个端口）：\nsystemctl start firewalld\nfirewall-cmd --permanent --zone=public --add-port=5901/tcp\n")])])]),a("h2",{attrs:{id:"设置vnc密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置vnc密码"}},[s._v("#")]),s._v(" 设置VNC密码")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("vncserver "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("\n")])])]),a("h2",{attrs:{id:"启动vnc-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动vnc-server"}},[s._v("#")]),s._v(" 启动VNC Server")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl restart vncserver@:1.service\n")])])]),a("h2",{attrs:{id:"systemctl启动异常解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemctl启动异常解决"}},[s._v("#")]),s._v(" systemctl启动异常解决")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start vncserver@:1.service")]),s._v("\nJob "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" vncserver@:1.service failed because the control process exited with error code.\n See "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemctl status vncserver@:1.service"')]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"journalctl -xe"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details.\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status vncserver@:1.service")]),s._v("\n● vncserver@:1.service - Remote desktop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VNC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/vncserver@:1.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset:\n disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: failed "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Result: exit-code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Fri "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-05-28 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 1min 55s ago\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5655")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin/runuser -l oracle -c /usr/bin/vncserver %i -geometry \n1280x720 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/FAILURE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5650")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/sh -c /usr/bin/vncserver -kill %i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting Remote desktop "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VNC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com runuser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5655")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": runuser: user oracle does not exist\nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": vncserver@:1.service: control process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Failed to start Remote desktop servic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Unit vncserver@:1.service entered fai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".e.\nJul "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":46:46 wyx.pc.com systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": vncserver@:1.service failed.\n")])])]),a("p",[s._v("如果启动过程中遇到异常，报错已经有进程存在，可以通过以下命令查看到")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -antulp | grep 5901")]),s._v("\ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5901            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5008")]),s._v("/Xvnc           \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::5901                 :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5008")]),s._v("/Xvnc           \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef | grep vnc")]),s._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5008")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":45 pts/0    00:00:00 /usr/bin/Xvnc :1 -auth /root/.Xauthority -\ndesktop wyx.pc.com:1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -fp catalogue:/etc/X11/fontpath.d -geometry 1024x768 -pn \n-rfbauth /root/.vnc/passwd -rfbport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5901")]),s._v(" -rfbwait "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\nroot      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5678")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1640")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 pts/0    00:00:00 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" --color"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto vnc\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);