(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{647:function(t,a,s){"use strict";s.r(a);var n=s(29),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"配置-kubeadm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubeadm"}},[t._v("#")]),t._v(" 配置 kubeadm")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("kubeadm已经进入GA阶段，其控制面初始化和加入节点步骤都支持大量可定制内容，因此kubeadm还提供了配置文件功能用于复杂定制。同时，kubeadm将配置文件以ConfigMap的形式保存到集群中，便于后续的查询和升级工作。"),s("code",[t._v("kubeadm config")]),t._v("子命令提供了对这一组功能的支持：")]),t._v(" "),s("ul",[s("li",[t._v("kubeadm config upload from-file：由配置文件上传到集群中生成ConfigMap。")]),t._v(" "),s("li",[t._v("kubeadm config upload from-flags：由配置参数生成ConfigMap。")]),t._v(" "),s("li",[t._v("kubeadm config view：查看当前集群中的配置值。")]),t._v(" "),s("li",[t._v("kubeadm config print init-defaults：输出kubeadm init默认参数文件的内容。")]),t._v(" "),s("li",[t._v("kubeadm config print join-defaults：输出kubeadm join默认参数文件的内容。")]),t._v(" "),s("li",[t._v("kubeadm config migrate：在新旧版本之间进行配置转换。")]),t._v(" "),s("li",[t._v("kubeadm config images list：列出所需的镜像列表。")]),t._v(" "),s("li",[t._v("kubeadm config images pull：拉取镜像到本地。")])]),t._v(" "),s("h2",{attrs:{id:"创建并修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建并修改配置"}},[t._v("#")]),t._v(" 创建并修改配置")]),t._v(" "),s("p",[t._v("导出配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm config print init-defaults "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" init-config.yaml\n")])])]),s("p",[t._v("修改配置为如下内容")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改为主节点 IP")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.169.199.101\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/dockershim.sock\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CoreDNS\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内不能访问 Google，修改为阿里云")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.aliyuncs.com/google_containers\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1.18.0\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置成 Calico 的默认网段")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSubnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.244.0.0/16"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("将上面的内容保存为"),s("code",[t._v("init-config.yaml")]),t._v("备用。")]),t._v(" "),s("h2",{attrs:{id:"查看和拉取镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看和拉取镜像"}},[t._v("#")]),t._v(" 查看和拉取镜像")]),t._v(" "),s("p",[t._v("查看所需镜像列表")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm config images list --config init-config.yaml\n")])])]),s("p",[t._v("拉取镜像")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubeadm config images pull --config init-config.yaml\n")])])]),s("p",[t._v("查看镜像")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n\nREPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE\nregistry.aliyuncs.com/google_containers/kube-proxy                v1.18.0             43940c34f24f        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" days ago         117MB\nregistry.aliyuncs.com/google_containers/kube-apiserver            v1.18.0             74060cea7f70        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" days ago         173MB\nregistry.aliyuncs.com/google_containers/kube-controller-manager   v1.18.0             d3e55153f52f        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" days ago         162MB\nregistry.aliyuncs.com/google_containers/kube-scheduler            v1.18.0             a31f78c7c8ce        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" days ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v(".3MB\nregistry.aliyuncs.com/google_containers/pause                     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.2")]),t._v("                 80d28bedfe5d        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" weeks ago         683kB\nregistry.aliyuncs.com/google_containers/coredns                   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.6")]),t._v(".7               67da37a9a360        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" months ago        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v(".8MB\nregistry.aliyuncs.com/google_containers/etcd                      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.4")]),t._v(".3-0             303ce5db0e90        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" months ago        288MB\n")])])]),s("p",[t._v("在镜像下载完成之后，就可以进行安装了。")])])}),[],!1,null,null,null);a.default=e.exports}}]);