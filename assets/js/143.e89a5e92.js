(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{611:function(s,t,a){"use strict";a.r(t);var n=a(29),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-镜像导入导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像导入导出"}},[s._v("#")]),s._v(" Docker 镜像导入导出")]),s._v(" "),a("p",[s._v("本文介绍Docker镜像的导入导出，用于迁移、备份、升级等场景，准备环境如下：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Ubuntu 18.04.5 LTS")])]),s._v(" "),a("li",[a("strong",[s._v("Docker 19.03.8")])])]),s._v(" "),a("h2",{attrs:{id:"导入导出命令介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入导出命令介绍"}},[s._v("#")]),s._v(" 导入导出命令介绍")]),s._v(" "),a("p",[s._v("涉及的命令有export、import、save、load")]),s._v(" "),a("h3",{attrs:{id:"save"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#save"}},[s._v("#")]),s._v(" save")]),s._v(" "),a("ul",[a("li",[s._v("命令\n"),a("code",[s._v("docker save [options] images [images...]")]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nSave one or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" images to a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("streamed to STDOUT by default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nOptions:\n  -o, --output string   Write to a file, instead of STDOUT\n")])])])]),s._v(" "),a("li",[s._v("示例\n"),a("code",[s._v("docker save -o nginx.tar nginx:latest")]),s._v("\n或\n"),a("code",[s._v("docker save > nginx.tar nginx:latest")]),s._v("\n其中-o和>表示输出到文件，"),a("code",[s._v("nginx.tar")]),s._v("为目标文件，"),a("code",[s._v("nginx:latest")]),s._v("是源镜像名（name:tag）")])]),s._v(" "),a("h3",{attrs:{id:"load"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#load"}},[s._v("#")]),s._v(" load")]),s._v(" "),a("ul",[a("li",[s._v("命令\n"),a("code",[s._v("docker load [options]")]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nLoad an image from a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive or STDIN\n\nOptions:\n  -i, --input string   Read from "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive file, instead of STDIN\n  -q, --quiet          Suppress the load output\n")])])])]),s._v(" "),a("li",[s._v("示例\n"),a("code",[s._v("docker load -i nginx.tar")]),s._v("\n或\n"),a("code",[s._v("docker load < nginx.tar")]),s._v("\n其中-i和<表示从文件输入。会成功导入镜像及相关元数据，包括tag信息")])]),s._v(" "),a("h3",{attrs:{id:"export"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#export"}},[s._v("#")]),s._v(" export")]),s._v(" "),a("ul",[a("li",[s._v("命令\n"),a("code",[s._v("docker export [options] container")]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nLoad an image from a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive or STDIN\n\nOptions:\n  -i, --input string   Read from "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive file, instead of STDIN\n  -q, --quiet          Suppress the load output\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" CONTAINER\n\nExport a container's filesystem as a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" archive\n\nOptions:\n  -o, --output string   Write to a file, instead of STDOUT\n")])])])]),s._v(" "),a("li",[s._v("示例\n"),a("code",[s._v("docker export -o nginx-test.tar nginx-test")]),s._v("\n其中-o表示输出到文件，"),a("code",[s._v("nginx-test.tar")]),s._v("为目标文件，"),a("code",[s._v("nginx-test")]),s._v("是源容器名（name）")])]),s._v(" "),a("h3",{attrs:{id:"import"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#import"}},[s._v("#")]),s._v(" import")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("命令\n"),a("code",[s._v("docker import [options] file|URL|- [REPOSITORY[:TAG]]")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" --help\n\nUsage:  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("URL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPOSITORY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nImport the contents from a tarball to create a filesystem image\n\nOptions:\n  -c, --change list       Apply Dockerfile instruction to the created image\n  -m, --message string    Set commit message "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" imported image\n      --platform string   Set platform "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" server is multi-platform capable\n")])])])]),s._v(" "),a("li",[a("p",[s._v("示例\n"),a("code",[s._v("docker import nginx-test.tar nginx:imp")]),s._v("\n或\n"),a("code",[s._v("cat nginx-test.tar | docker import - nginx:imp")])])])]),s._v(" "),a("h2",{attrs:{id:"区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#区别"}},[s._v("#")]),s._v(" 区别")]),s._v(" "),a("ul",[a("li",[s._v("export命令导出的tar文件略小于save命令导出的"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ll -al\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("802252")]),s._v("\ndrwxrwxr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" heyuqiang heyuqiang      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":50 ./\ndrwxrwxr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" heyuqiang heyuqiang      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":06 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rw------- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heyuqiang heyuqiang "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("136842240")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":45 nginx.tar\n-rw------- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heyuqiang heyuqiang "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135116800")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":50 nginx-test.tar\n")])])])]),s._v(" "),a("li",[s._v("export命令是从容器（container）中导出tar文件，而save命令则是从镜像（images）中导出")]),s._v(" "),a("li",[s._v("基于第二点，export导出的文件再import回去时，无法保留镜像所有历史（即每一层layer信息，不熟悉的可以去看Dockerfile），不能进行回滚操作；而save是依据镜像来的，所以导入时可以完整保留下每一层layer信息。如下图所示，"),a("code",[s._v("nginx:latest")]),s._v("是save导出load导入的，"),a("code",[s._v("nginx:imp")]),s._v("是export导出import导入的。"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" nginx:latest \nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n4bb46517cac3        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  CMD ["nginx" "-g" "daemon…   0B                  ')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  STOPSIGNAL SIGTERM           0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  EXPOSE 80                    0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  ENTRYPOINT ["/docker-entr…   0B                  ')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) COPY file:0fd5fca330dcd6a7…   1.04kB              ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) COPY file:1d0a4127e78a26c1…   1.96kB              ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) COPY file:e7e183879c35719c…   1.2kB               ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -x     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" addgroup --system -…   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".4MB              \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  ENV PKG_RELEASE=1~buster     0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  ENV NJS_VERSION=0.4.3        0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  ENV NGINX_VERSION=1.19.2     0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  LABEL maintainer=NGINX Do…   0B                  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#(nop)  CMD ["bash"]                 0B                  ')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("missing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         /bin/sh -c "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) ADD file:3af3091e7d2bb40bc…   69.2MB              ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" nginx:imp\nIMAGE               CREATED             CREATED BY          SIZE                COMMENT\nb6a847fedf23        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v(" seconds ago                          131MB               Imported from -\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"建议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建议"}},[s._v("#")]),s._v(" 建议")]),s._v(" "),a("p",[s._v("可以依据具体使用场景来选择命令")]),s._v(" "),a("ul",[a("li",[s._v("若是只想备份images，使用save、load即可")]),s._v(" "),a("li",[s._v("若是在启动容器后，容器内容有变化，需要备份，则使用export、import")])])])}),[],!1,null,null,null);t.default=e.exports}}]);