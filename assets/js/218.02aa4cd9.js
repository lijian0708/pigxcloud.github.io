(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{687:function(t,s,a){"use strict";a.r(s);var n=a(29),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins整合sonarqube实现代码审查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins整合sonarqube实现代码审查"}},[t._v("#")]),t._v(" Jenkins整合SonarQube实现代码审查")]),t._v(" "),a("h2",{attrs:{id:"流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流程图"}},[t._v("#")]),t._v(" 流程图")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-01_111131.png",alt:"流程图"}})]),t._v(" "),a("h2",{attrs:{id:"jenkins安装sonarqube-scanner插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins安装sonarqube-scanner插件"}},[t._v("#")]),t._v(" Jenkins安装SonarQube Scanner插件")]),t._v(" "),a("p",[t._v("Jenkins -> 系统管理 -> 插件管理 -> 可选插件")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-01_111623.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("h2",{attrs:{id:"sonarqube-生成token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sonarqube-生成token"}},[t._v("#")]),t._v(" SonarQube 生成token")]),t._v(" "),a("p",[t._v('点击右上角头像 -> My Account -> Security：Generate Tokens 点击 "Generate"')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_204404.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("p",[t._v('点击"Copy"安装复制')]),t._v(" "),a("p",[t._v("a691b0c2921eedb7f025a6f95a5147351a520b34")]),t._v(" "),a("h2",{attrs:{id:"jenkins-添加-sonarqube凭证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-添加-sonarqube凭证"}},[t._v("#")]),t._v(" Jenkins 添加 SonarQube凭证")]),t._v(" "),a("p",[t._v("Jenkins -> 系统管理 -> Manage Credentials -> 全局 -> 添加凭据")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_210110.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("h2",{attrs:{id:"jenkins-配置sonarqube"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-配置sonarqube"}},[t._v("#")]),t._v(" Jenkins 配置SonarQube")]),t._v(" "),a("p",[t._v("Jenkins -> 系统管理 -> 系统配置 -> SonarQube servers")]),t._v(" "),a("p",[t._v('点击"Add SonarQube"按钮，添加SonarQube servers')]),t._v(" "),a("ul",[a("li",[t._v("name：sonarqube-8.9.1")]),t._v(" "),a("li",[t._v("Server URL：http://10.17.10.104:9000/")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_210503.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("p",[t._v("系统管理 -> 全局工具配置 -> SonarQube Scanner")]),t._v(" "),a("ul",[a("li",[t._v("Name：sonarqube-scanner")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_210724.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("h2",{attrs:{id:"sonaqube关闭审查结果上传到scm功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sonaqube关闭审查结果上传到scm功能"}},[t._v("#")]),t._v(" SonaQube关闭审查结果上传到SCM功能")]),t._v(" "),a("p",[t._v("返回SonarQube，Administration -> SCM")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_211004.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("h2",{attrs:{id:"非流水线项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非流水线项目"}},[t._v("#")]),t._v(" 非流水线项目")]),t._v(" "),a("p",[t._v("在项目添加SonaQube代码审查")]),t._v(" "),a("p",[t._v("1）项目根目录下，创建sonar-project.properties文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_212130.png",alt:"SonarQube Scanner"}})]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# must be unique in a given SonarQube instance\nsonar.projectKey=web-project\n# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 9.8.1.\nsonar.projectName=web-project\nsonar.projectVersion=1.0\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.\n# This property is optional if sonar.modules is set.\nsonar.sources=.\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.source=1.8\nsonar.java.target=1.8\n# Encoding of the source code. Default is default system encoding\nsonar.sourceEncoding=UTF-8\n')])])]),a("p",[t._v('2）Jenkins新建任务，选择"构建一个自由风格的软件项目"')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_220213.png",alt:"新建任务"}})]),t._v(" "),a("p",[t._v("3）配置源码管理")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_220506.png",alt:"源码管理"}})]),t._v(" "),a("p",[t._v('4）添加构建步骤 "Execute SonarQube Scanner"')]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_220926.png",alt:"添加构建步骤"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_221205.png",alt:"添加构建步骤"}})]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v('配置完成，点击"立即构建"，构建完成后打开SonarQube可以查看构建结果')])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_221535.png",alt:"立即构建"}})]),t._v(" "),a("h2",{attrs:{id:"流水线项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流水线项目"}},[t._v("#")]),t._v(" 流水线项目"),a("Badge",{attrs:{text:"推荐",type:"success"}})],1),t._v(" "),a("p",[t._v("1）修改Jenkinsfile，加入SonarQube代码审查阶段")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),t._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b8994da1-c4c7-4d37-b12e-939363a42230'")]),t._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.50.100/demo/web-project.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mvn clean package'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sonarqube'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    scannerHome "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sonarqube-scanner'")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                withSonarQubeEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sonarqube-8.9.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${scannerHome}")]),t._v('/bin/sonar-scanner"')]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deploy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'项目部署'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    post "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            emailext body: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${FILE,path=\"email.html\"}'")]),t._v(", subject: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'构建通知:${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!'")]),t._v(", to: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'785056500@qq.com'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("3）到SonarQube的UI界面查看审查结果")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-04_221535.png",alt:"立即构建"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);