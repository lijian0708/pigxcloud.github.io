(window.webpackJsonp=window.webpackJsonp||[]).push([[219],{688:function(s,t,a){"use strict";a.r(t);var n=a(29),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"微服务持续集成-上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#微服务持续集成-上"}},[s._v("#")]),s._v(" 微服务持续集成(上)")]),s._v(" "),a("h2",{attrs:{id:"jenkins-docker-springcloud持续集成流程说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-docker-springcloud持续集成流程说明"}},[s._v("#")]),s._v(" Jenkins+Docker+SpringCloud持续集成流程说明")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-10_120836.png",alt:"持续集成流程"}})]),s._v(" "),a("p",[a("strong",[s._v("大致流程说明：")])]),s._v(" "),a("p",[s._v("1）开发人员每天把代码提交到Gitlab代码仓库")]),s._v(" "),a("p",[s._v("2）Jenkins从Gitlab中拉取项目源码，编译并打成jar包，然后构建成Docker镜像，将镜像上传到 Harbor私有仓库。")]),s._v(" "),a("p",[s._v("3）Jenkins发送SSH远程命令，让生产部署服务器到Harbor私有仓库拉取镜像到本地，然后创建容器。")]),s._v(" "),a("p",[s._v("4）最后，用户可以访问到容器")]),s._v(" "),a("h2",{attrs:{id:"服务列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务列表"}},[s._v("#")]),s._v(" 服务列表")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("服务器名称")]),s._v(" "),a("th",[s._v("IP地址")]),s._v(" "),a("th",[s._v("安装的软件")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("代码托管服务器")]),s._v(" "),a("td",[s._v("192.168.50.100")]),s._v(" "),a("td",[s._v("GitLab Community Edition 14.0.5")])]),s._v(" "),a("tr",[a("td",[s._v("持续集成服务器")]),s._v(" "),a("td",[s._v("192.168.50.101")]),s._v(" "),a("td",[s._v("Jenkins，Maven，Docker18.06.1-ce")])]),s._v(" "),a("tr",[a("td",[s._v("Docker仓库服务器")]),s._v(" "),a("td",[s._v("192.168.50.102")]),s._v(" "),a("td",[s._v("Docker18.06.1-ce，Harbor1.9.2")])]),s._v(" "),a("tr",[a("td",[s._v("生产部署服务器")]),s._v(" "),a("td",[s._v("192.168.50.103")]),s._v(" "),a("td",[s._v("Docker18.06.1-ce")])])])]),s._v(" "),a("h2",{attrs:{id:"harbor镜像仓库安装及使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harbor镜像仓库安装及使用"}},[s._v("#")]),s._v(" Harbor镜像仓库安装及使用")]),s._v(" "),a("p",[a("RouterLink",{attrs:{to:"/20.DevOps/registry/1096.html"}},[s._v("部署 Harbor 企业级Registry服务器")])],1),s._v(" "),a("h2",{attrs:{id:"项目代码上传到gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目代码上传到gitlab"}},[s._v("#")]),s._v(" 项目代码上传到Gitlab"),a("Badge",{attrs:{text:"待补充",type:"warning"}})],1),s._v(" "),a("p",[s._v("在IDEA操作即可，参考之前的步骤。包括后台微服务和前端web网站代码")]),s._v(" "),a("h2",{attrs:{id:"从gitlab拉取项目源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从gitlab拉取项目源码"}},[s._v("#")]),s._v(" 从Gitlab拉取项目源码")]),s._v(" "),a("p",[s._v("1）创建"),a("code",[s._v("Jenkinsfile")]),s._v("文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-gitlab-checkout-creds'")]),s._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git@192.168.50.100:ieooc/simplify.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn -B -DskipTests clean package'")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("2）拉取"),a("code",[s._v("Jenkinsfile")]),s._v("文件")]),s._v(" "),a("h2",{attrs:{id:"提交到sonarqube代码审查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提交到sonarqube代码审查"}},[s._v("#")]),s._v(" 提交到SonarQube代码审查")]),s._v(" "),a("p",[s._v("1）创建项目，并设置参数")]),s._v(" "),a("p",[s._v("创建"),a("code",[s._v("simplify")]),s._v("项目，添加两个参数")]),s._v(" "),a("p",[s._v("2）每个项目的根目录下添加"),a("code",[s._v("sonar-project.properties")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# must be unique in a given SonarQube instance")]),s._v("\nsonar.projectKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simplify\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this is the name and version displayed in the SonarQube UI.")]),s._v("\nsonar.projectName"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simplify\nsonar.projectVersion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This property is optional if sonar.modules is set.")]),s._v("\nsonar.sources"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".\nsonar.exclusions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("**/test/**,**/target/**\nsonar.java.binaries"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".\nsonar.java.source"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v("\nsonar.java.target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v("\nsonar.java.libraries"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("**/target/classes/**\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Encoding of the source code. Default is default system encoding")]),s._v("\nsonar.sourceEncoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("修改"),a("code",[s._v("sonar.projectKey")]),s._v("和"),a("code",[s._v("sonar.projectName")])])]),s._v(" "),a("p",[s._v("3）修改"),a("code",[s._v("Jenkinsfile")]),s._v("构建脚本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-gitlab-checkout-creds'")]),s._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git@192.168.50.100:ieooc/simplify.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn -B -DskipTests clean package'")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Code Quality'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    scannerHome "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tool "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sonarqube-scanner'")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                withSonarQubeEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sonarqube-8.9.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                        '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${scannerHome}")]),s._v("/bin/sonar-scanner\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n                '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"使用dockerfile编译、生成镜像-推送镜像到私服"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用dockerfile编译、生成镜像-推送镜像到私服"}},[s._v("#")]),s._v(" 使用Dockerfile编译、生成镜像，推送镜像到私服")]),s._v(" "),a("p",[s._v("1）"),a("RouterLink",{attrs:{to:"/20.DevOps/docker/1014.html"}},[s._v("Ubuntu 安装 Docker")])],1),s._v(" "),a("p",[s._v("2）"),a("RouterLink",{attrs:{to:"/20.DevOps/simplify/1142.html"}},[s._v("自己制作一个java11的docker镜像")])],1),s._v(" "),a("p",[s._v("3）"),a("RouterLink",{attrs:{to:"/20.DevOps/simplify/1145.html"}},[s._v("利用docker-maven-plugin插件构建Docker镜像")])],1),s._v(" "),a("p",[s._v("4）修改Jenkinsfile构建脚本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent any\n\n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-gitlab-checkout-creds'")]),s._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.50.100/simplify-cloud/simplify.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                // 编译并安装公共聚合模块\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn -f simplify-common clean install'")]),s._v("\n                // 编译构建docker镜像并推送至Harbor镜像私服\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn -f ${project_name} clean package docker:build docker:push'")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"拉取镜像和发布应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像和发布应用"}},[s._v("#")]),s._v(" 拉取镜像和发布应用")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-10_140139.png",alt:""}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("注意："),a("code",[s._v("192.168.50.103")]),s._v("服务已经安装Docker并启动")])]),s._v(" "),a("h2",{attrs:{id:"设置ssh通过密钥登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置ssh通过密钥登录"}},[s._v("#")]),s._v(" 设置SSH通过密钥登录")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("理论上只需要在生产服务器配置SSH密钥登录，最后拷贝Jenkins服务器上的公钥即可。")])]),s._v(" "),a("p",[s._v("1）生成密钥，并通过"),a("code",[s._v("-m PEM")]),s._v("指定格式"),a("Badge",{attrs:{text:"必须",type:"success"}})],1),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssh-keygen -m PEM -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])])]),a("p",[s._v("参数说明：")]),s._v(" "),a("ul",[a("li",[s._v("-m 参数指定密钥的格式，PEM是rsa之前使用的旧格式")]),s._v(" "),a("li",[s._v("-b 指定密钥长度。对于RSA密钥，最小要求768位，默认是2048位。")])]),s._v(" "),a("p",[s._v("查看密钥格式")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ubuntu@jenkins:~/.ssh$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" /home/ubuntu/.ssh/id_rsa\n-----BEGIN RSA PRIVATE KEY-----\nMIIJKQIBAAKCAgEAuL2pM5NMsPPR9LhvNbfjx1uVMSR8z98ID/s1qMQ5bYVbYTIg\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),a("p",[s._v("可以看到密钥的首行是：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("-----BEGIN RSA PRIVATE KEY-----\n")])])]),a("p",[s._v("而我们生成密钥时如果不指定格式，默认生成的密钥首行是：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("-----BEGIN OPENSSH PRIVATE KEY-----\n")])])]),a("p",[s._v("而 "),a("code",[s._v("Jenkins 2.289.1")]),s._v(" 版本在检验密钥时还不支持这种格式，会出现如下错误：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("jenkins.plugins.publish_over.BapPublisherException: Failed to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" SSH key. Message "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("invalid privatekey: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("B@60373f7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("键入以下命令，在服务器上安装公钥：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_rsa.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys\n")])])]),a("p",[s._v("如此便完成了公钥的安装。为了确保连接成功，请保证以下文件权限正确：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" ~/.ssh\n")])])]),a("p",[s._v("设置SSH，打开密钥登录功能")]),s._v(" "),a("p",[s._v("编辑 "),a("code",[s._v("vi /etc/ssh/sshd_config")]),s._v(" 文件，进行如下设置：")]),s._v(" "),a("p",[a("strong",[s._v("PubkeyAuthentication yes")])]),s._v(" "),a("p",[s._v("当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：")]),s._v(" "),a("p",[a("strong",[s._v("PasswordAuthentication no")])]),s._v(" "),a("p",[s._v("最后，将私钥文件 "),a("code",[s._v("id_rsa")]),s._v(" 下载到客户端机器上，重启 SSH 服务：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl restart sshd.service\n")])])]),a("p",[s._v("登录jenkins服务器，拷贝ssh公钥到生产服务器")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ubuntu@jenkins:~$ ssh-copy-id ubuntu@10.17.10.103\n")])])]),a("h2",{attrs:{id:"安装-publish-over-ssh-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-publish-over-ssh-插件"}},[s._v("#")]),s._v(" 安装 Publish Over SSH 插件")]),s._v(" "),a("p",[s._v("安装以下插件，可以实现远程发送Shell命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-10_142652.png",alt:""}})]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("在配置一下内容时，要首先在jenkins服务器上生成私钥，然后将公钥推送到生成服务器上。")])]),s._v(" "),a("p",[s._v("登录jenkins服务器，拷贝私钥文件"),a("code",[s._v("id_rsa")]),s._v("到jenkins工作目录。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切换root用户")]),s._v("\nubuntu@jenkins:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝私钥文件")]),s._v("\nroot@jenkins:/home/ubuntu"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /home/ubuntu/.ssh/id_rsa /var/lib/jenkins/.ssh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改私钥文件访问权限")]),s._v("\nroot@jenkins:/home/ubuntu"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown jenkins:jenkins /var/lib/jenkins/.ssh/id_rsa")]),s._v("\n")])])]),a("p",[s._v("系统管理 -> 系统配置 -> Publish over SSH")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_221209.png",alt:"配置私钥"}})]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Passphrase：")]),s._v(" 如果私钥设置了密码就是私钥的密码，私钥没设置密码可以不填")]),s._v(" "),a("li",[a("strong",[s._v("Path to key：")]),s._v(" 私钥的位置(实际文件所在位置"),a("code",[s._v("/var/lib/jenkins/.ssh/id_rsa")]),s._v(")")]),s._v(" "),a("li",[a("strong",[s._v("Key：")]),s._v(" 私钥的内容。如果此处填入了值，则以此处的值为准，会忽略掉Path to key的配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_223155.png",alt:"添加服务器"}})]),s._v(" "),a("p",[s._v("SSH Servers：服务器的配置")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("Name：")]),s._v(" 名称（自定义）")]),s._v(" "),a("li",[a("strong",[s._v("Hostname：")]),s._v(" 服务器地址")]),s._v(" "),a("li",[a("strong",[s._v("Username：")]),s._v(" 用户名")]),s._v(" "),a("li",[a("strong",[s._v("Remote Directory：")]),s._v(" 默认远程服务器的地址")])]),s._v(" "),a("h2",{attrs:{id:"修改jenkinsfile构建脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改jenkinsfile构建脚本"}},[s._v("#")]),s._v(" 修改Jenkinsfile构建脚本")]),s._v(" "),a("p",[s._v("生成远程调用模板代码")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_225219.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sshPublisher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("publishers: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sshPublisherDesc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("configName: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.17.10.107_deploy-simplify'")]),s._v(", transfers: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sshTransfer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cleanRemote: false, excludes: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", execCommand: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/ubuntu/jenkins_shell/deploy.sh '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_URL}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_PROJECT_NAME}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_name}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAG}")]),s._v('"')]),s._v(", execTimeout: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120000")]),s._v(", flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[, ]+'")]),s._v(", remoteDirectory: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", remoteDirectorySDF: false, removePrefix: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", sourceFiles: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("新增构建参数")]),s._v(" "),a("ul",[a("li",[s._v("项目模块名称")]),s._v(" "),a("li",[s._v("启动服务端口")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-08-03_165334.png",alt:""}})]),s._v(" "),a("p",[s._v("完整的"),a("code",[s._v("Jenkinsfile")]),s._v("内容日下：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent any\n    \n    environment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        HARBOR_URL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.17.10.110'")]),s._v("\n        HARBOR_PROJECT_NAME "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'library'")]),s._v("\n        TAG "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0-SNAPSHOT"')]),s._v("\n        HARBOR_COMMON_CREDS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" credentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-harbor-auth-creds'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Checkout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                checkout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$class")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),s._v(", branches: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*/master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", extensions: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", userRemoteConfigs: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b8994da1-c4c7-4d37-b12e-939363a42230'")]),s._v(", url: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.17.10.101/simplify-cloud/simplify.git'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Install'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                // Compile and "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" common modules\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn -f simplify-common clean install'")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"do test"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                // withCredentials"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("usernamePassword"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jenkins-harbor-auth-creds'")]),s._v(", passwordVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(", usernameVariable: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                //     // Harbor Login\n                //     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker login -u '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_username}")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_password}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_URL}")]),s._v('"')]),s._v("\n                // "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                // Harbor Login\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker login -u '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_COMMON_CREDS_USR}")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_COMMON_CREDS_PSW}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_URL}")]),s._v('"')]),s._v("\n                // Compile and build the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image and push it to the harbor image private server\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mvn -f '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_NAME}")]),s._v(' clean package docker:build docker:push"')]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Deploy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                sshPublisher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("publishers: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sshPublisherDesc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("configName: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.17.10.107_deploy-simplify'")]),s._v(", transfers: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sshTransfer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cleanRemote: false, excludes: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", execCommand: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/ubuntu/jenkins_shell/deploy.sh '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_URL}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_PROJECT_NAME}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_name}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${TAG}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_COMMON_CREDS_USR}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HARBOR_COMMON_CREDS_PSW}")]),s._v('"')]),s._v(", execTimeout: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120000")]),s._v(", flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[, ]+'")]),s._v(", remoteDirectory: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", remoteDirectorySDF: false, removePrefix: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(", sourceFiles: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"jenkins中pipeline没有docker执行权限解决办法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins中pipeline没有docker执行权限解决办法"}},[s._v("#")]),s._v(" Jenkins中Pipeline没有Docker执行权限解决办法")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/init.d/jenkins\n")])])]),a("p",[s._v("添加如下内容到脚本顶部")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_SOCKET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/docker.sock\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_GROUP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JENKINS_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jenkins\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -S "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_SOCKET}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_GID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stat")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%g'")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DOCKER_SOCKET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" -for -g "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_GID}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_GROUP}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -aG "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_GROUP}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JENKINS_USER}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start Jenkins service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" jenkins restart\n")])])]),a("h2",{attrs:{id:"指定jdk版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定jdk版本"}},[s._v("#")]),s._v(" 指定jdk版本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/init.d/jenkins\n")])])]),a("p",[s._v("添加如下内容到脚本顶部")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/lib/jvm/jdk1.8.0_291\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JRE_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/jre\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JRE_HOME}")]),s._v("/lib\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])])]),a("h2",{attrs:{id:"编写deploy-sh部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写deploy-sh部署脚本"}},[s._v("#")]),s._v(" 编写deploy.sh部署脚本")]),s._v(" "),a("p",[s._v("上传"),a("code",[s._v("deploy.sh")]),s._v("文件到"),a("code",[s._v("/opt/jenkins_shell")]),s._v("目录下，且文件至少有执行权限！")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("harbor_url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("harbor_project_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("project_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("harbor_username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$6")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("harbor_password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("image_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${harbor_url}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${harbor_project_name}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_name}")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tag}")]),s._v('"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("containerId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -w $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$containerId")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$containerId")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$containerId")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Container deleted successfully"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login -u "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${harbor_username}")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${harbor_password}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${harbor_url}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$image_name")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -itd -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${port}")]),s._v(" --name "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_name}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${image_name}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images -q -f "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dangling")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Deployment complete"')]),s._v("\n")])])]),a("p",[s._v("添加执行权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x deploy.sh \n")])])]),a("h2",{attrs:{id:"部署前端静态web网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署前端静态web网站"}},[s._v("#")]),s._v(" 部署前端静态web网站")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_230104.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"安装nginx服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx服务器"}},[s._v("#")]),s._v(" 安装Nginx服务器")]),s._v(" "),a("p",[s._v("关闭SELinux")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭selinux")]),s._v("\nsetenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭selinux")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#SELINUX=enforcing#SELINUX=disabled#g'")]),s._v(" /etc/selinux/config\n")])])]),a("p",[s._v("启动Nginx")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl enable nginx 设置开机启动\nsystemctl start nginx 启动\nsystemctl stop nginx 停止\nsystemctl restart nginx 重启\n")])])]),a("h2",{attrs:{id:"安装nodejs插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nodejs插件"}},[s._v("#")]),s._v(" 安装NodeJS插件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_230441.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"jenkins配置nodejs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins配置nodejs"}},[s._v("#")]),s._v(" Jenkins配置Nodejs")]),s._v(" "),a("p",[s._v("Manage Jenkins->Global Tool Configuration")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-11_230945.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"创建前端流水线项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建前端流水线项目"}},[s._v("#")]),s._v(" 创建前端流水线项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-01_124838.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-01_124904.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/2021-07-01_124922.jpg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"建立jenkinsfile构建脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建立jenkinsfile构建脚本"}},[s._v("#")]),s._v(" 建立Jenkinsfile构建脚本")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//gitlab的凭证\ndef git_auth = \"68f2087f-a034-4d39-a9ff-1f776dd3dfa8\"\nnode {\nstage('Checkout') {\ncheckout([$class: 'GitSCM', branches: [[name: '*/${branch}']],\ndoGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [],\nuserRemoteConfigs: [[credentialsId: \"${git_auth}\", url:\n'git@192.168.66.100:itheima_group/tensquare_front.git']]])\n} s\ntage('打包，部署网站') {\n//使用NodeJS的npm进行打包\nnodejs('nodejs12'){\nsh '''\nnpm install\nnpm run build\n'''\n} /\n/=====以下为远程调用进行项目部署========\nsshPublisher(publishers: [sshPublisherDesc(configName: 'master_server',\ntransfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '',\nexecTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes:\nfalse, patternSeparator: '[, ]+', remoteDirectory: '/usr/share/nginx/html',\nremoteDirectorySDF: false, removePrefix: 'dist', sourceFiles: 'dist/**')],\nusePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])\n}\n}\n")])])]),a("p",[s._v("完成后，访问：http://192.168.66.103:9090 进行测试。")])])}),[],!1,null,null,null);t.default=e.exports}}]);